<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>macOSにおける運用を続けていくためのsudo設定</title> <meta name="description" content="適切な権限管理や安定した運用、セキュリティの関係上、特定のコマンドのみsudoを許可したいということがあるかと思います。 コマンドの制限や文法チェックの方法などをまとめました。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="適切な権限管理や安定した運用、セキュリティの関係上、特定のコマンドのみsudoを許可したいということがあるかと思います。 コマンドの制限や文法チェックの方法などをまとめました。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2017-12-23-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="macOSにおける運用を続けていくためのsudo設定"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="macOSにおける運用を続けていくためのsudo設定"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="適切な権限管理や安定した運用、セキュリティの関係上、特定のコマンドのみsudoを許可したいということがあるかと思います。 コマンドの制限や文法チェックの方法などをまとめました。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2017-12-23-1"> <link rel="preload" as="style" href="/assets/bundle/app.55445db2fff8ddfed8c5.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.55445db2fff8ddfed8c5.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2017-12-23-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2017-12-23-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">macOSにおける運用を続けていくためのsudo設定</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2017-12-23</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/system-administration">system-administration </a> </div> </section> <article class="post-content"> <p>適切な権限管理や安定した運用、セキュリティの関係上、 特定のコマンドのみ <code class="language-plaintext highlighter-rouge">sudo</code> を許可したいということがあるかと思います。</p> <p>今回は <code class="language-plaintext highlighter-rouge">sudo</code> の設定方法とTipsを紹介していきます。</p> <ul id="markdown-toc"> <li><a href="#sudo%E3%81%AE%E8%A8%AD%E5%AE%9A" id="markdown-toc-sudoの設定">sudoの設定</a></li> <li> <a href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E5%88%B6%E9%99%90" id="markdown-toc-コマンドの制限">コマンドの制限</a> <ul> <li><a href="#%E6%9C%80%E5%88%9D%E3%81%AEall" id="markdown-toc-最初のall">最初のALL</a></li> <li><a href="#-%E5%86%85--%E3%81%AE%E5%B7%A6%E5%81%B4%E3%81%AEall" id="markdown-toc--内--の左側のall"><code class="language-plaintext highlighter-rouge">()</code> 内 <code class="language-plaintext highlighter-rouge">:</code> の左側のALL</a></li> <li><a href="#-%E5%86%85--%E3%81%AE%E5%8F%B3%E5%81%B4%E3%81%AEall" id="markdown-toc--内--の右側のall"><code class="language-plaintext highlighter-rouge">()</code> 内 <code class="language-plaintext highlighter-rouge">:</code> の右側のALL</a></li> <li><a href="#%E6%9C%80%E5%BE%8C%E3%81%AEall" id="markdown-toc-最後のall">最後のALL</a></li> </ul> </li> <li> <a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%88%86%E9%9B%A2" id="markdown-toc-ファイルの分離">ファイルの分離</a> <ul> <li><a href="#%E5%88%86%E9%9B%A2%E3%81%97%E3%81%9F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%A8%A9%E9%99%90" id="markdown-toc-分離したファイルの権限">分離したファイルの権限</a></li> </ul> </li> <li> <a href="#%E6%96%87%E6%B3%95%E3%82%A8%E3%83%A9%E3%83%BC" id="markdown-toc-文法エラー">文法エラー</a> <ul> <li><a href="#linux%E3%81%A7%E3%81%AE%E5%BE%A9%E6%97%A7%E6%96%B9%E6%B3%95" id="markdown-toc-linuxでの復旧方法">Linuxでの復旧方法</a></li> <li><a href="#macos%E3%81%A7%E3%81%AE%E5%BE%A9%E6%97%A7%E6%96%B9%E6%B3%95" id="markdown-toc-macosでの復旧方法">macOSでの復旧方法</a></li> </ul> </li> <li> <a href="#tips" id="markdown-toc-tips">Tips</a> <ul> <li><a href="#-%E3%81%8C%E5%90%AB%E3%81%BE%E3%82%8C%E3%82%8B%E6%96%87%E5%AD%97%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%81%84" id="markdown-toc--が含まれる文字を使用したい"><code class="language-plaintext highlighter-rouge">\</code> が含まれる文字を使用したい</a></li> <li><a href="#sudoers%E3%81%AE%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88" id="markdown-toc-sudoersのコメント">sudoersのコメント</a></li> <li><a href="#%E4%BA%8B%E5%89%8D%E3%81%AB%E6%96%87%E6%B3%95%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%97%E3%81%9F%E3%81%84" id="markdown-toc-事前に文法をチェックしたい">事前に文法をチェックしたい</a></li> </ul> </li> <li><a href="#%E3%81%BE%E3%81%A8%E3%82%81" id="markdown-toc-まとめ">まとめ</a></li> </ul> <h2 id="sudoの設定">sudoの設定</h2> <p><code class="language-plaintext highlighter-rouge">sudo</code> の設定は <code class="language-plaintext highlighter-rouge">/etc/sudoers</code> で記載された内容が反映されます。</p> <p>以下はmacOSのデフォルトの設定です。</p> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## sudoers file.</span>
<span class="c">##</span>
<span class="c">## This file MUST be edited with the 'visudo' command as root.</span>
<span class="c">## Failure to use 'visudo' may result in syntax or file permission errors</span>
<span class="c">## that prevent sudo from running.</span>
<span class="c">##</span>
<span class="c">## See the sudoers man page for the details on how to write a sudoers file.</span>
<span class="c">##</span>

<span class="c">##</span>
<span class="c">## Host alias specification</span>
<span class="c">##</span>
<span class="c">## Groups of machines. These may include host names (optionally with wildcards),</span>
<span class="c">## IP addresses, network numbers or netgroups.</span>
<span class="c"># Host_Alias	WEBSERVERS = www1, www2, www3</span>

<span class="c">##</span>
<span class="c">## User alias specification</span>
<span class="c">##</span>
<span class="c">## Groups of users.  These may consist of user names, uids, Unix groups,</span>
<span class="c">## or netgroups.</span>
<span class="c"># User_Alias	ADMINS = millert, dowdy, mikef</span>

<span class="c">##</span>
<span class="c">## Cmnd alias specification</span>
<span class="c">##</span>
<span class="c">## Groups of commands.  Often used to group related commands together.</span>
<span class="c"># Cmnd_Alias	PROCESSES = /usr/bin/nice, /bin/kill, /usr/bin/renice, \</span>
<span class="c"># 			    /usr/bin/pkill, /usr/bin/top</span>

<span class="c">##</span>
<span class="c">## Defaults specification</span>
<span class="c">##</span>

Defaults    env_reset
Defaults    env_keep += "BLOCKSIZE"
Defaults    env_keep += "COLORFGBG COLORTERM"
Defaults    env_keep += "__CF_USER_TEXT_ENCODING"
Defaults    env_keep += "CHARSET LANG LANGUAGE LC_ALL LC_COLLATE LC_CTYPE"
Defaults    env_keep += "LC_MESSAGES LC_MONETARY LC_NUMERIC LC_TIME"
Defaults    env_keep += "LINES COLUMNS"
Defaults    env_keep += "LSCOLORS"
Defaults    env_keep += "SSH_AUTH_SOCK"
Defaults    env_keep += "TZ"
Defaults    env_keep += "DISPLAY XAUTHORIZATION XAUTHORITY"
Defaults    env_keep += "EDITOR VISUAL"
Defaults    env_keep += "HOME MAIL"

Defaults    lecture_file = "/etc/sudo_lecture"

<span class="c">##</span>
<span class="c">## Runas alias specification</span>
<span class="c">##</span>

<span class="c">##</span>
<span class="c">## User privilege specification</span>
<span class="c">##</span>
root ALL=(ALL) <span class="ss">ALL</span>
<span class="err">%</span>admin  ALL=(ALL) <span class="ss">ALL</span>

<span class="c">## Uncomment to allow members of group wheel to execute any command</span>
<span class="c"># %wheel ALL=(ALL) ALL</span>

<span class="c">## Same thing without a password</span>
<span class="c"># %wheel ALL=(ALL) NOPASSWD: ALL</span>

<span class="c">## Uncomment to allow members of group sudo to execute any command</span>
<span class="c"># %sudo	ALL=(ALL) ALL</span>

<span class="c">## Uncomment to allow any user to run sudo if they know the password</span>
<span class="c">## of the user they are running the command as (root by default).</span>
<span class="c"># Defaults targetpw  # Ask for the password of the target user</span>
<span class="c"># ALL ALL=(ALL) ALL  # WARNING: only use this together with 'Defaults targetpw'</span>

<span class="c">## Read drop-in files from /private/etc/sudoers.d</span>
<span class="c">## (the '#' here does not indicate a comment)</span>
<span class="c">#includedir /private/etc/sudoers.d</span>
</code></pre></div></div> <p>この <code class="language-plaintext highlighter-rouge">sudoers</code> ファイルを書き換えることで設定を変更できます。</p> <h2 id="コマンドの制限">コマンドの制限</h2> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">【ユーザー名】</span> <span class="nc">ALL</span> = (ALL:ALL) <span class="ss">ALL</span>
<span class="err">%【グループ名】</span> <span class="nc">ALL</span> = (ALL:ALL) <span class="ss">ALL</span>
</code></pre></div></div> <p>のような書き方でユーザーまたはグループに応じて、 どのユーザーまたはグループまたはその両方として <code class="language-plaintext highlighter-rouge">sudo</code> を介し、コマンドを実行できるかの制限できます。</p> <p>たとえばXcodeにまつわるコマンド類を <strong>Example_Group</strong> グループに所属しているメンバーに <strong>root</strong> ユーザーでの実行許可を与えるとした場合、</p> <div class="language-apache highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cmnd_Alias XCODE_COMMANDS = /usr/bin/xcodebuild, /usr/bin/xcrun, /usr/bin/xcode-select

<span class="err">%</span>Example_Group ALL=(root) XCODE_COMMANDS
</code></pre></div></div> <p>とすることで設定できます。</p> <h3 id="最初のall">最初のALL</h3> <p>ホスト名に対する許可の項目です。ALLはすべてのホストを表しており、個別に指定できます。</p> <h3 id="-内--の左側のall"> <code class="language-plaintext highlighter-rouge">()</code> 内 <code class="language-plaintext highlighter-rouge">:</code> の左側のALL</h3> <p>ユーザーに対する許可の項目です。 ALLはすべてのユーザーを表しており、個別に指定できます。</p> <h3 id="-内--の右側のall"> <code class="language-plaintext highlighter-rouge">()</code> 内 <code class="language-plaintext highlighter-rouge">:</code> の右側のALL</h3> <p>グループに対する許可の項目です。 ALLはすべてのグループを表しており、個別に指定できます。 また、<code class="language-plaintext highlighter-rouge">:</code> なしの場合はユーザーのみを表し、グループは無視されます。</p> <h3 id="最後のall">最後のALL</h3> <p>コマンドに対する許可の項目です。ALLはすべてのコマンドを表しており、個別に指定できます。</p> <h2 id="ファイルの分離">ファイルの分離</h2> <p><code class="language-plaintext highlighter-rouge">/etc/sudoers</code> を編集することで <code class="language-plaintext highlighter-rouge">sudo</code> の設定ができますが、 煩雑になってしまう可能性もあるので、<code class="language-plaintext highlighter-rouge">sudoers</code> を直接編集することはオススメしません。 また、ファイルを分けてチェッカーを走らせること（後述参照）で、文法エラー防止にも役立ちます。</p> <p>ファイルの分離は、</p> <blockquote> <p><code class="language-plaintext highlighter-rouge">## Read drop-in files from /private/etc/sudoers.d</code></p> </blockquote> <p>とあるように、<code class="language-plaintext highlighter-rouge">/etc/sudoers.d</code> ディレクトリの中に設定ファイルを入れるとその内容も合わせて読み取ってくれます。</p> <h3 id="分離したファイルの権限">分離したファイルの権限</h3> <p>ファイルを分離した際に気を付けないといけないのが権限です。 <code class="language-plaintext highlighter-rouge">/etc/sudoers</code> は <code class="language-plaintext highlighter-rouge">440</code> です。<code class="language-plaintext highlighter-rouge">/etc/sudoers.d</code> 内に作成した設定ファイルも <code class="language-plaintext highlighter-rouge">440</code> に変更する必要があります。</p> <h2 id="文法エラー">文法エラー</h2> <p><code class="language-plaintext highlighter-rouge">sudoers</code> やincludeしたファイルで文法エラーになると <code class="language-plaintext highlighter-rouge">sudo</code> コマンドが使えなくなります。 これになると本当に絶望します。</p> <p>文法エラーになった瞬間は、「やばい、やらかした」と思うかもしれませんが、一応復旧方法はあります。</p> <h3 id="linuxでの復旧方法">Linuxでの復旧方法</h3> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkexec visudo
</code></pre></div></div> <p>をすることでsuper userとして <code class="language-plaintext highlighter-rouge">visudo</code> を実行でき、<code class="language-plaintext highlighter-rouge">sudoers</code> ファイルを変更できます。</p> <p>また、<code class="language-plaintext highlighter-rouge">-f</code> オプションを使用することで、<code class="language-plaintext highlighter-rouge">sudoers.d</code> のディレクトリ内部のファイルも変更できます。</p> <h3 id="macosでの復旧方法">macOSでの復旧方法</h3> <p>macOSには <code class="language-plaintext highlighter-rouge">pkexec</code> コマンドがないため詰んだと思ったのですが、GUIで解決させることができます。</p> <ol> <li>「Terminal.appで <code class="language-plaintext highlighter-rouge">open /etc</code> を入力」または「Finderで移動 &gt; フォルダへ移動 &gt; <code class="language-plaintext highlighter-rouge">/etc</code> を入力 &gt; 移動」します。 <a href="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_1.png" data-fancybox="images" data-caption="macOS で sudo が使えなくなった際の対応手順1"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="macOS で sudo が使えなくなった際の対応手順1" data-src="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_1.png" class="lazyload"></a> <a href="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_2.png" data-fancybox="images" data-caption="macOS で sudo が使えなくなった際の対応手順2"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="macOS で sudo が使えなくなった際の対応手順2" data-src="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_2.png" class="lazyload"></a> </li> <li>該当ファイルを右クリックして「情報を見る」を選択します。 <a href="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_3.png" data-fancybox="images" data-caption="macOS で sudo が使えなくなった際の対応手順3"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="macOS で sudo が使えなくなった際の対応手順3" data-src="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_3.png" class="lazyload"></a> </li> <li>鍵アイコンをクリックして、 everyoneの項目を <code class="language-plaintext highlighter-rouge">読み/書き</code> に変更します。 <a href="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_4.png" data-fancybox="images" data-caption="macOS で sudo が使えなくなった際の対応手順4"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="macOS で sudo が使えなくなった際の対応手順4" data-src="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_4.png" class="lazyload"></a> <a href="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_5.png" data-fancybox="images" data-caption="macOS で sudo が使えなくなった際の対応手順5"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="macOS で sudo が使えなくなった際の対応手順5" data-src="/assets/posts/post/2017-12-23-1/mac_sudo_syntax_error_recovery_5.png" class="lazyload"></a> </li> <li>該当ファイルをお好みのエディタで編集して文法エラーを編集してください。</li> <li>編集が終わったら2の手順でeveryoneを <code class="language-plaintext highlighter-rouge">アクセス不可</code> に戻して終了です。</li> </ol> <h2 id="tips">Tips</h2> <h3 id="-が含まれる文字を使用したい"> <code class="language-plaintext highlighter-rouge">\</code> が含まれる文字を使用したい</h3> <p><code class="language-plaintext highlighter-rouge">\</code> は設定ファイルを改行しても連続していることを表すために使用されるため、グループ名などに含まれる場合は <code class="language-plaintext highlighter-rouge">\</code> だと認識されません。 <code class="language-plaintext highlighter-rouge">\\</code> とすることで初めてエスケープされるので注意が必要です。</p> <h3 id="sudoersのコメント">sudoersのコメント</h3> <p><code class="language-plaintext highlighter-rouge">sudoers</code> は <code class="language-plaintext highlighter-rouge">#</code> 以降は、コメントとして扱われます。 しかし、<code class="language-plaintext highlighter-rouge">#includedir</code> の <code class="language-plaintext highlighter-rouge">#</code> はコメントではなく、C言語のようなディレクティブとして機能します。</p> <p>間違えやすいので、 コメントする際は <code class="language-plaintext highlighter-rouge">##</code> のように2以上連続で <code class="language-plaintext highlighter-rouge">#</code> を記載することをオススメします。</p> <h3 id="事前に文法をチェックしたい">事前に文法をチェックしたい</h3> <p>文法エラーになっても直せることがわかったものの、毎回リカバリ対応しているとtry &amp; errorが行いづらいです。 設定変更や文法チェックはぶっつけ本番ではなく事前にテストを行いたいです。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>visudo <span class="nt">-cs</span> <span class="nt">-f</span> ファイル名
</code></pre></div></div> <p>上記のコマンドを実行することで、文法をチェックが行え、<code class="language-plaintext highlighter-rouge">sudoers</code> の設定がスムーズになります。</p> <p>また、使用したいコマンドは常に変化していくので、運用に耐えうるためにCIを回しましょう。 そうすることで設定のチェックを自動化できます。</p> <h4 id="各オプション">各オプション</h4> <table> <thead> <tr> <th style="text-align: left">オプション</th> <th style="text-align: left">効果</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-c</code></td> <td style="text-align: left"> <code class="language-plaintext highlighter-rouge">sudoers</code> が問題ないかをチェックするためのモードをONにするための指定</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-s</code></td> <td style="text-align: left">strictモードをONにするための指定<br>権限のチェックもしてくれる</td> </tr> <tr> <td style="text-align: left"><code class="language-plaintext highlighter-rouge">-f</code></td> <td style="text-align: left">デフォルトで <code class="language-plaintext highlighter-rouge">/etc/sudoers</code> を参照するが、このオプションでほかのファイルを参照可能</td> </tr> </tbody> </table> <h2 id="まとめ">まとめ</h2> <p><code class="language-plaintext highlighter-rouge">sudo</code> の設定方法および設定ファイルの分離方法と、<code class="language-plaintext highlighter-rouge">sudo</code> におけるコマンドの制限の方法を説明しました。</p> <p>また、文法エラーの復旧方法と、そもそもぶっつけ本番で文法エラーにならないようなしくみについてお話しました。 CIガンガン回していきましょう。</p> <p>さらに詳しい情報に関しては <code class="language-plaintext highlighter-rouge">man visudo</code>、<code class="language-plaintext highlighter-rouge">man sudoers</code> を御覧ください。</p> </article> <section class="share"> <a href="//twitter.com/share?text=macOS%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E9%81%8B%E7%94%A8%E3%82%92%E7%B6%9A%E3%81%91%E3%81%A6%E3%81%84%E3%81%8F%E3%81%9F%E3%82%81%E3%81%AEsudo%E8%A8%AD%E5%AE%9A&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2017-12-23-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=macOS%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E9%81%8B%E7%94%A8%E3%82%92%E7%B6%9A%E3%81%91%E3%81%A6%E3%81%84%E3%81%8F%E3%81%9F%E3%82%81%E3%81%AEsudo%E8%A8%AD%E5%AE%9A&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2017-12-23-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=macOS%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E9%81%8B%E7%94%A8%E3%82%92%E7%B6%9A%E3%81%91%E3%81%A6%E3%81%84%E3%81%8F%E3%81%9F%E3%82%81%E3%81%AEsudo%E8%A8%AD%E5%AE%9A&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2017-12-23-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2017-12-23-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents related-posts"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">あわせて読みたい</div> <div class="sub-contents-main"> <li> <a href="/post/2025-12-14-1">クロスプラットフォームで動作するintunewinファイルの作成・解凍ツールを作った</a> <span class="post-date">- December 14, 2025</span> </li> <li> <a href="/post/2021-02-24-1">GitHub ActionsのRunner OSの情報を取得できるアクションを作った</a> <span class="post-date">- February 24, 2021</span> </li> <li> <a href="/post/2025-06-19-1">WWDC 2025で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- June 19, 2025</span> </li> <li> <a href="/post/2024-12-16-1">Installomatorでアプリケーションのインストールの進捗を表示する</a> <span class="post-date">- December 16, 2024</span> </li> <li> <a href="/post/2024-12-09-1">Installomatorのパラメータの紹介</a> <span class="post-date">- December 9, 2024</span> </li> </div> </div> </section> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/sudo">sudo</a> <a href="/tag/sudoers">sudoers</a> <a href="/tag/macos">macOS</a> <a href="/tag/linux">Linux</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.55445db2fff8ddfed8c5.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>