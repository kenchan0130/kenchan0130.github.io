<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>erase-installを使ってmacOSの初期化、OS再インストール、OSアップグレードを行う</title> <meta name="description" content="macOSのデバイスを組織の従業員に貸与する場合、デバイスのトラブルや退職などのタイミングでデバイスを管理者で受け入れ、そのデバイスの購入時期が一定期間以内の場合、廃棄せずに初期化を行い、新たな従業員へデバイスを貸与することがあります。 その際デバイスの管理者は、なるべく組織で許容しているOSおよびバーションにアップグレードしたいことがあります。 また、COVID-19の影響によりリモートで対応することも多い中、何か問題が起きた際にOSの再インストールや、OSのアップデートをエンドユーザーに行ってもらう必要があるかもしれません。 今回はこれら課題を解決する方法を紹介します。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="macOSのデバイスを組織の従業員に貸与する場合、デバイスのトラブルや退職などのタイミングでデバイスを管理者で受け入れ、そのデバイスの購入時期が一定期間以内の場合、廃棄せずに初期化を行い、新たな従業員へデバイスを貸与することがあります。 その際デバイスの管理者は、なるべく組織で許容しているOSおよびバーションにアップグレードしたいことがあります。 また、COVID-19の影響によりリモートで対応することも多い中、何か問題が起きた際にOSの再インストールや、OSのアップデートをエンドユーザーに行ってもらう必要があるかもしれません。 今回はこれら課題を解決する方法を紹介します。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2020-12-15-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="erase-installを使ってmacOSの初期化、OS再インストール、OSアップグレードを行う"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="erase-installを使ってmacOSの初期化、OS再インストール、OSアップグレードを行う"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="macOSのデバイスを組織の従業員に貸与する場合、デバイスのトラブルや退職などのタイミングでデバイスを管理者で受け入れ、そのデバイスの購入時期が一定期間以内の場合、廃棄せずに初期化を行い、新たな従業員へデバイスを貸与することがあります。 その際デバイスの管理者は、なるべく組織で許容しているOSおよびバーションにアップグレードしたいことがあります。 また、COVID-19の影響によりリモートで対応することも多い中、何か問題が起きた際にOSの再インストールや、OSのアップデートをエンドユーザーに行ってもらう必要があるかもしれません。 今回はこれら課題を解決する方法を紹介します。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2020-12-15-1"> <link rel="preload" as="style" href="/assets/bundle/app.55445db2fff8ddfed8c5.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.55445db2fff8ddfed8c5.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2020-12-15-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2020-12-15-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">erase-installを使ってmacOSの初期化、OS再インストール、OSアップグレードを行う</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2020-12-15</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/system-administration">system-administration </a> </div> </section> <article class="post-content"> <p>macOSのデバイスを組織の従業員に貸与する場合、デバイスのトラブルや退職などのタイミングでデバイスを管理者で受け入れ、そのデバイスの購入時期が一定期間以内の場合、廃棄せずに初期化を行い、新たな従業員へデバイスを貸与することがあります。</p> <p>その際デバイスの管理者は、なるべく組織で許容しているOSおよびバーションにアップグレードしたいことがあります。</p> <p>また、COVID-19の影響によりリモートで対応することも多い中、何か問題が起きた際にOSの再インストールや、OSのアップデートをエンドユーザーに行ってもらう必要があるかもしれません。</p> <p>今回はこれら課題を解決する方法を紹介します。</p> <p>この記事は<a href="https://adventar.org/calendars/5390" target="_blank" rel="noopener noreferrer">corp-engr 情シス Slack（コーポレートエンジニア x 情シス） Advent Calendar 2020</a>の15日目の記事でもあります。</p> <ul id="markdown-toc"> <li><a href="#%E5%BE%93%E6%9D%A5%E3%81%AE%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%8A%E3%82%88%E3%81%B3os%E5%86%8D%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%AE%E8%AA%B2%E9%A1%8C" id="markdown-toc-従来のデバイスの初期化およびos再インストールの課題">従来のデバイスの初期化およびOS再インストールの課題</a></li> <li><a href="#%E5%BE%93%E6%9D%A5%E3%81%AEos%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%AE%E8%AA%B2%E9%A1%8C" id="markdown-toc-従来のosアップグレードの課題">従来のOSアップグレードの課題</a></li> <li><a href="#erase-install%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" id="markdown-toc-erase-installについて">erase-installについて</a></li> <li> <a href="#%E8%AA%B2%E9%A1%8C%E3%81%AE%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95" id="markdown-toc-課題の解決方法">課題の解決方法</a> <ul> <li><a href="#%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E5%88%9D%E6%9C%9F%E5%8C%96%E3%81%8A%E3%82%88%E3%81%B3os%E5%86%8D%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%AE%E3%82%B1%E3%83%BC%E3%82%B9" id="markdown-toc-デバイス初期化およびos再インストールのケース">デバイス初期化およびOS再インストールのケース</a></li> <li><a href="#os%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%AE%E3%82%B1%E3%83%BC%E3%82%B9" id="markdown-toc-osアップグレードのケース">OSアップグレードのケース</a></li> </ul> </li> <li> <a href="#jamf-pro%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%81%8A%E5%8B%A7%E3%82%81%E3%81%AE%E8%A8%AD%E5%AE%9A%E6%96%B9%E6%B3%95" id="markdown-toc-jamf-proを使用したお勧めの設定方法">Jamf Proを使用したお勧めの設定方法</a> <ul> <li><a href="#%E5%88%9D%E6%9C%9F%E5%8C%96%E7%94%A8%E3%81%AE%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92self-service%E3%81%8B%E3%82%89%E5%AE%9F%E8%A1%8C%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B" id="markdown-toc-初期化用のポリシーをself-serviceから実行できるようにする">初期化用のポリシーをSelf Serviceから実行できるようにする</a></li> <li><a href="#os%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E7%94%A8%E3%81%AE%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B" id="markdown-toc-osアップグレード用のポリシーを用意する">OSアップグレード用のポリシーを用意する</a></li> </ul> </li> <li><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB" id="markdown-toc-終わりに">終わりに</a></li> </ul> <h2 id="従来のデバイスの初期化およびos再インストールの課題">従来のデバイスの初期化およびOS再インストールの課題</h2> <p>多くの場合、初期化およびデータは消さないOS再インストール作業は、</p> <ul> <li>Intel版 <ul> <li> <strong>⌘ + R</strong> <ul> <li>現在インストールされているOSの一番新しいOS</li> </ul> </li> <li> <strong>⌥ + ⌘ + R</strong> <ul> <li>デバイスと互換性があるうちで一番新しいOS</li> </ul> </li> <li> <strong>⇧ + ⌥ + ⌘ + R</strong> <ul> <li>工場出荷時のOSバーションまたは工場出荷時のOSバーションがサポートされていない場合はそれに一番近いサポートされているOS</li> </ul> </li> </ul> </li> <li>Silicon版 <ul> <li><strong>電源ボタン長押し</strong></li> </ul> </li> </ul> <p>などでリカバリーモードを介して行います。</p> <p>または、事前にUSBなどの外部記憶媒体にmacOSのインストーラを作成しておき、起動オプションで外部記憶媒体を指定し、</p> <ol> <li>ディスクの消去</li> <li>OSのインストール</li> </ol> <p>を行います。</p> <p>（Intel版のみ）ファームウェアのパスワードを設定している場合、リカバリーモードにはファームウェアのパスワードを入れないといけず面倒です。</p> <p>リカバリーモードの場合、</p> <ol> <li>FileVaultの暗号化の解除</li> <li>ディスクユーティリティでディスクの消去（フォーマット）</li> <li>インターネット経由でのOSのインストール</li> </ol> <p>の手順で初期化しますが、OSインストール中にインターネット接続が不安定となるとOSがインストールされず、インターネットリカバリーを行うこととなり、初期化に多くの工数を割かなければいけないこともあります。</p> <p>また、macOSインストーラを使用した場合、リカバリーモードのように不安定な作業にはならないものの、T2チップを搭載していると、外部起動を事前に有効にしておかなければ使用できません。 新しいOSが出た際には、そのたびにインストーラを作成するのもたいへんです。</p> <h2 id="従来のosアップグレードの課題">従来のOSアップグレードの課題</h2> <p>メジャーバーションアップの場合、[システム環境設定] &gt; [ソフトウェアアップデート]からアップグレードができます。</p> <p>管理者権限を与えていない場合、インストーラが起動したところでアップグレードできないため、何かしらアップグレードするための方法を用意する必要があります。</p> <p>それぞれ、エンドユーザーが自発的にアップグレードできます。しかし、ユーザーによってはまったくアップグレードを行わず、管理者が強制的にアップグレードを適用したいこともありますが、それにはスクリプトなどを用意する必要があります。</p> <h2 id="erase-installについて">erase-installについて</h2> <p><a href="https://github.com/grahampugh/erase-install" target="_blank" rel="noopener noreferrer">erase-install</a>はGraham Pugh氏が開発しているmacOSの初期化およびOSアップグレードが行えるスクリプトです。</p> <p>大まかな処理としては、以下のようなことを行っています。</p> <ol> <li>munkiが作成している<a href="https://github.com/munki/macadmin-scripts/blob/main/installinstallmacos.py" target="_blank" rel="noopener noreferrer">installinstallmacos.py</a>をforkしたものをGraham Pugh氏が一部改変したものをダウンロード</li> <li> <code class="language-plaintext highlighter-rouge">installinstallmacos.py</code>を実行し、最新バージョンのOSインストーラをダウンロード</li> <li>OSインストールを実行</li> </ol> <p><code class="language-plaintext highlighter-rouge">installinstallmacos.py</code>が特定のOSバーションやBuildの指定、Apple Seed Programを使用できるため、そのサポートや、<code class="language-plaintext highlighter-rouge">softwareupdate</code>のフルインストーラにも対応しています。</p> <p>Jamf Proがインストールされている場合は、Jamf Helperを使用してエンドユーザーに以下の内容を通知できます。</p> <ul> <li>ディスクスペースの不足</li> <li>OSインストーラのダウンロードの開始</li> <li>OSインストーラの実行前の確認ダイアログ</li> </ul> <h2 id="課題の解決方法">課題の解決方法</h2> <p>事前に現在インストール可能なOS一覧を確認しておき、対応すると良いでしょう。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2020-12-15 02:00 JST 現在の結果</span>
curl <span class="nt">-s</span> https://raw.githubusercontent.com/grahampugh/erase-install/master/erase-install.sh | <span class="nb">sudo </span>bash /dev/stdin <span class="nt">--list</span>

<span class="o">(</span>略<span class="o">)</span>

This Mac:
Model Identifier : MacBookPro16,2

Bridge ID        : J214kAP
Board ID         : Mac-5F9802EFE386AA28
OS Version       : 10.15.7
Build ID         : 19H2

 <span class="c">#  ProductID       Version    Build    Post Date   Title                          Notes/Warnings</span>
 1  001-15219       10.15.5    19F2200  2020-06-15  macOS Catalina                 Unsupported macOS version
 2  001-68446       10.15.7    19H15    2020-11-11  macOS Catalina
 3  001-04366       10.15.4    19E2269  2020-05-04  macOS Catalina                 Unsupported macOS version
 4  061-86291       10.15.3    19D2064  2020-03-23  macOS Catalina                 Unsupported macOS version
 5  041-91758       10.13.6    17G66    2019-10-19  macOS High Sierra              Unsupported macOS version
 6  001-57224       10.15.7    19H4     2020-10-27  macOS Catalina
 7  061-26589       10.14.6    18G103   2019-10-14  macOS Mojave                   Unsupported macOS version
 8  001-51042       10.15.7    19H2     2020-09-24  macOS Catalina
 9  001-36735       10.15.6    19G2006  2020-08-06  macOS Catalina                 Unsupported macOS version
10  001-83532       11.0.1     20B50    2020-11-19  macOS Big Sur
11  041-88800       10.14.4    18E2034  2019-10-23  macOS Mojave                   Unsupported macOS version
12  041-90855       10.13.5    17F66a   2019-10-23  Install macOS High Sierra Beta Unsupported macOS version
13  061-26578       10.14.5    18F2059  2019-10-14  macOS Mojave                   Unsupported macOS version
14  001-36801       10.15.6    19G2021  2020-08-12  macOS Catalina                 Unsupported macOS version
</code></pre></div></div> <h3 id="デバイス初期化およびos再インストールのケース">デバイス初期化およびOS再インストールのケース</h3> <p>最新バージョンで初期化を行う場合は、</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> https://raw.githubusercontent.com/grahampugh/erase-install/master/erase-install.sh | <span class="nb">sudo </span>bash /dev/stdin <span class="nt">--erase</span>
</code></pre></div></div> <p>OSの再インストールを行う場合は、</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> https://raw.githubusercontent.com/grahampugh/erase-install/master/erase-install.sh | <span class="nb">sudo </span>bash /dev/stdin <span class="nt">--reinstall</span> <span class="nt">--sameos</span>
</code></pre></div></div> <p>を実行します。実際には現在のメジャーバーションと一致する最新バージョンのOSをインストールしますが、往々にして現在のOSの最新バージョンにするケースが多いためこのようにしています。</p> <p>もし、指定したバーションにしたい場合は、<code class="language-plaintext highlighter-rouge">--os</code>オプションを使用してください。</p> <p>これにより、リカバリーモードやOSインストーラを使用せずとも初期化およびOSの再インストールが可能となります。</p> <h3 id="osアップグレードのケース">OSアップグレードのケース</h3> <p>最新バージョンにアップグレードする場合は、</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> https://raw.githubusercontent.com/grahampugh/erase-install/master/erase-install.sh | <span class="nb">sudo </span>bash /dev/stdin <span class="nt">--reinstall</span>
</code></pre></div></div> <p>バーションを指定したい場合は、</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># パッチバージョンまで指定</span>
curl <span class="nt">-s</span> https://raw.githubusercontent.com/grahampugh/erase-install/master/erase-install.sh | <span class="nb">sudo </span>bash /dev/stdin <span class="nt">--reinstall</span> <span class="nt">--os</span><span class="o">=</span><span class="s2">"11.0.1"</span>
<span class="c"># マイナーバージョンまで指定</span>
curl <span class="nt">-s</span> https://raw.githubusercontent.com/grahampugh/erase-install/master/erase-install.sh | <span class="nb">sudo </span>bash /dev/stdin <span class="nt">--reinstall</span> <span class="nt">--os</span><span class="o">=</span><span class="s2">"11.0"</span>
</code></pre></div></div> <p>を実行します。</p> <p>これにより、OSのアップグレードが可能です。</p> <h2 id="jamf-proを使用したお勧めの設定方法">Jamf Proを使用したお勧めの設定方法</h2> <p>上記はコマンドを使用しましたが、Jamf Proを使用されている場合、お勧めの設定方法があるので紹介します。</p> <p>事前に<a href="https://github.com/grahampugh/erase-install/releases" target="_blank" rel="noopener noreferrer">erase-installのリリース一覧</a>からから最新バージョンを選択し、Jamf ProサーバーのScriptに<code class="language-plaintext highlighter-rouge">erase-install.sh</code>を設定しておきます。</p> <h3 id="初期化用のポリシーをself-serviceから実行できるようにする">初期化用のポリシーをSelf Serviceから実行できるようにする</h3> <p>初期化用のポリシーをSelf Serviceから実行できるようにすることで、エンドユーザーやデバイス管理者がワンボタンでいつでも実行できます。</p> <h4 id="初期化用のポリシー設定">初期化用のポリシー設定</h4> <ol> <li>[コンピュータ] &gt; [ポリシー]から新規作成に進みます。</li> <li>Generalセクションで各値を設定します。 <ul> <li> <strong>表示名</strong>: <code class="language-plaintext highlighter-rouge">Erase and reinstall latest OS</code> <ul> <li>これは例ですが、分かりやすい名前をつけてください。</li> </ul> </li> <li> <strong>カテゴリ</strong>: <code class="language-plaintext highlighter-rouge">Admin</code> <ul> <li>カテゴリの設定は任意です。</li> </ul> </li> <li> <strong>実行頻度</strong>: <code class="language-plaintext highlighter-rouge">Ongoing</code> <ul> <li>トリガーはなしで、Self Serviceで実行するためOngoingで問題ないです。</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-12-15-1/create_erase_and_reinstall_latest_os_options_general.png" data-fancybox="images" data-caption="初期化および最新バージョンのOSインストールポリシー作成のオプションセクションのGeneral項目設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="初期化および最新バージョンのOSインストールポリシー作成のオプションセクションのGeneral項目設定" data-src="/assets/posts/post/2020-12-15-1/create_erase_and_reinstall_latest_os_options_general.png" class="lazyload"></a></p> </li> <li>次に、スクリプトの項目を選択し、登録したerase-installのスクリプトを追加します。</li> <li>パラメータ4とパラメータ5に値を設定します。 <ul> <li> <strong>パラメータ4</strong>: <code class="language-plaintext highlighter-rouge">--erase</code> </li> <li> <strong>パラメータ5</strong>: <code class="language-plaintext highlighter-rouge">--confirm</code> <ul> <li>confirmオプションを使用するとJamf Helperを使用してOSインストーラを実行する前に確認ダイアログを表示できます。</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-12-15-1/create_erase_and_reinstall_latest_os_options_script.png" data-fancybox="images" data-caption="初期化および最新バージョンのOSインストールポリシー作成のオプションセクションのスクリプト項目設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="初期化および最新バージョンのOSインストールポリシー作成のオプションセクションのスクリプト項目設定" data-src="/assets/posts/post/2020-12-15-1/create_erase_and_reinstall_latest_os_options_script.png" class="lazyload"></a></p> </li> <li>次に、Scopeセクションで実行を許可するスコープを絞ります。</li> <li> <p>最後に、Self Serviceセクションで「Self Service でポリシーを使用可能にする」を有効にします。</p> <p><a href="/assets/posts/post/2020-12-15-1/create_erase_and_reinstall_latest_os_self_service.png" data-fancybox="images" data-caption="初期化および最新バージョンのOSインストールポリシー作成のSelf ServiceセクションのSelf Service設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="初期化および最新バージョンのOSインストールポリシー作成のSelf ServiceセクションのSelf Service設定" data-src="/assets/posts/post/2020-12-15-1/create_erase_and_reinstall_latest_os_self_service.png" class="lazyload"></a></p> </li> <li>[保存]してポリシーの登録は完了です。</li> </ol> <h3 id="osアップグレード用のポリシーを用意する">OSアップグレード用のポリシーを用意する</h3> <p>OSアップグレードのポリシーを用意することで、デバイス管理者が強制的にポリシーを適用したり、Self Serviceを介してエンドユーザーに自由に実行してもらったりできます。</p> <h4 id="最新バージョンのosを事前にダウンロードするポリシーの設定">最新バージョンのOSを事前にダウンロードするポリシーの設定</h4> <p>OSインストーラは数GBと少々重たいので、事前にダウンロードするためのポリシーを作成します。</p> <ol> <li>[コンピュータ] &gt; [ポリシー]から新規作成に進みます。</li> <li>Generalセクションで各値を設定します。 <ul> <li> <strong>表示名</strong>: <code class="language-plaintext highlighter-rouge">Download latest OS installer</code> <ul> <li>これは例ですが、分かりやすい名前をつけてください。</li> </ul> </li> <li> <strong>カテゴリ</strong>: <code class="language-plaintext highlighter-rouge">OS Update</code> <ul> <li>カテゴリの設定は任意です。</li> </ul> </li> <li> <strong>実行頻度</strong>: <code class="language-plaintext highlighter-rouge">Ongoing</code> <ul> <li>トリガーはなしで、Self Serviceで実行するためOngoingで問題ないです。</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-12-15-1/create_download_latest_os_installer_options_general.png" data-fancybox="images" data-caption="OSインストーラダウンロード用のポリシー作成のオプションセクションのGeneral項目設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OSインストーラダウンロード用のポリシー作成のオプションセクションのGeneral項目設定" data-src="/assets/posts/post/2020-12-15-1/create_download_latest_os_installer_options_general.png" class="lazyload"></a></p> </li> <li>次に、スクリプトの項目を選択し、登録したerase-installのスクリプトを追加します。 <ul> <li>パラメータには何も設定しません。</li> </ul> <p><a href="/assets/posts/post/2020-12-15-1/create_download_latest_os_installer_options_script.png" data-fancybox="images" data-caption="OSインストーラダウンロード用のポリシー作成のオプションセクションのスクリプト項目設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OSインストーラダウンロード用のポリシー作成のオプションセクションのスクリプト項目設定" data-src="/assets/posts/post/2020-12-15-1/create_download_latest_os_installer_options_script.png" class="lazyload"></a></p> </li> <li>次に、Scopeセクションで実行を許可するスコープを絞ります。</li> <li> <p>最後に、Self Serviceセクションで「Self Service でポリシーを使用可能にする」を有効にします。</p> <p><a href="/assets/posts/post/2020-12-15-1/create_download_latest_os_installer_self_service.png" data-fancybox="images" data-caption="OSインストーラダウンロード用のポリシー作成のSelf ServiceセクションのSelf Service設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OSインストーラダウンロード用のポリシー作成のSelf ServiceセクションのSelf Service設定" data-src="/assets/posts/post/2020-12-15-1/create_download_latest_os_installer_self_service.png" class="lazyload"></a></p> </li> <li>[保存]してポリシーの登録は完了です。</li> </ol> <h4 id="osアップグレード用のポリシーの設定">OSアップグレード用のポリシーの設定</h4> <p>今回はSelf Serviceで実行できるようなポリシーを作成してみます。</p> <ol> <li>[コンピュータ] &gt; [ポリシー]から新規作成に進みます。</li> <li>Generalセクションで各値を設定します。 <ul> <li> <strong>表示名</strong>: <code class="language-plaintext highlighter-rouge">Upgrade latest OS</code> <ul> <li>これは例ですが、分かりやすい名前をつけてください。</li> </ul> </li> <li> <strong>カテゴリ</strong>: <code class="language-plaintext highlighter-rouge">OS Update</code> <ul> <li>カテゴリの設定は任意です。</li> </ul> </li> <li> <strong>実行頻度</strong>: <code class="language-plaintext highlighter-rouge">Ongoing</code> <ul> <li>トリガーはなしで、Self Serviceで実行するためOngoingで問題ないです。</li> </ul> </li> </ul> </li> </ol> <p><a href="/assets/posts/post/2020-12-15-1/create_upgrade_latest_os_options_general.png" data-fancybox="images" data-caption="OSアップグレード用のポリシー作成のオプションセクションのGeneral項目設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OSアップグレード用のポリシー作成のオプションセクションのGeneral項目設定" data-src="/assets/posts/post/2020-12-15-1/create_upgrade_latest_os_options_general.png" class="lazyload"></a></p> <ol> <li>次に、スクリプトの項目を選択し、登録したerase-installのスクリプトを追加します。</li> <li>パラメータ4とパラメータ5に値を設定します。 <ul> <li> <strong>パラメータ4</strong>: <code class="language-plaintext highlighter-rouge">--reinstall</code> </li> <li> <strong>パラメータ5</strong>: <code class="language-plaintext highlighter-rouge">--confirm</code> <ul> <li>confirmオプションを使用すると、Jamf Helperを使用してOSインストーラを実行する前に確認ダイアログを表示できます。</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-12-15-1/create_upgrade_latest_os_options_script.png" data-fancybox="images" data-caption="OSアップグレード用のポリシー作成のオプションセクションのスクリプト項目設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OSアップグレード用のポリシー作成のオプションセクションのスクリプト項目設定" data-src="/assets/posts/post/2020-12-15-1/create_upgrade_latest_os_options_script.png" class="lazyload"></a></p> </li> <li>次に、Scopeセクションで実行を許可するスコープを絞ります。</li> <li> <p>最後に、Self Serviceセクションで「Self Service でポリシーを使用可能にする」を有効にします。</p> <p><a href="/assets/posts/post/2020-12-15-1/create_upgrade_latest_os_self_service.png" data-fancybox="images" data-caption="OSアップグレード用のポリシー作成のSelf ServiceセクションのSelf Service設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OSアップグレード用のポリシー作成のSelf ServiceセクションのSelf Service設定" data-src="/assets/posts/post/2020-12-15-1/create_upgrade_latest_os_self_service.png" class="lazyload"></a></p> </li> <li>[保存]してポリシーの登録は完了です。</li> </ol> <p>今回は事前にOSインストーラをダウンロードするポリシーを作成していましたが、<code class="language-plaintext highlighter-rouge">--update</code>オプションを使用すると、もしそのインストーラが古い場合は新しいOSインストーラをダウンロードしてからインストールを実行します。 もし必要でしたらオプションを有効にしてください。</p> <h2 id="終わりに">終わりに</h2> <p>erase-installという名前が誤解を生みそうな名前ですが、初期化、OS再インストールおよびOSアップグレードが可能なスクリプトでした。</p> <p>紹介した以外にもいくつかオプションがあります。詳しくはerase-installの<a href="https://github.com/grahampugh/erase-install/blob/main/README.md" target="_blank" rel="noopener noreferrer">README</a>、または</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> https://raw.githubusercontent.com/grahampugh/erase-install/master/erase-install.sh | bash /dev/stdin <span class="nt">--help</span>
</code></pre></div></div> <p>を参照してください。</p> <p>このスクリプトはOSインストーラのシグネチャの検証をしていないので、理解したうえで使用してください。<sup id="fnref:issue-50"><a href="#fn:issue-50" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></p> <p>もし、OSアップグレードの際にOSインストーラーのシグネチャの確認をしたい場合や、ACアダプタからの給電がされているかの事前確認などをしたい場合は、<a href="https://github.com/kc9wwh/macOSUpgrade" target="_blank" rel="noopener noreferrer">macOSUpgrade</a>の使用を検討してみてください。</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:issue-50"> <p><a href="https://github.com/grahampugh/erase-install/issues/50" target="_blank" rel="noopener noreferrer">Signature verification of the os installer</a>のIssueを立てました。 <a href="#fnref:issue-50" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </article> <section class="share"> <a href="//twitter.com/share?text=erase-install%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6macOS%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96%E3%80%81OS%E5%86%8D%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%80%81OS%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%82%92%E8%A1%8C%E3%81%86&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-12-15-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=erase-install%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6macOS%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96%E3%80%81OS%E5%86%8D%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%80%81OS%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%82%92%E8%A1%8C%E3%81%86&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-12-15-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=erase-install%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6macOS%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96%E3%80%81OS%E5%86%8D%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%80%81OS%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%82%92%E8%A1%8C%E3%81%86&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-12-15-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2020-12-15-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents related-posts"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">あわせて読みたい</div> <div class="sub-contents-main"> <li> <a href="/post/2024-12-16-1">Installomatorでアプリケーションのインストールの進捗を表示する</a> <span class="post-date">- December 16, 2024</span> </li> <li> <a href="/post/2024-12-09-2">Installomatorでサポートされていないアプリケーションをインストールする</a> <span class="post-date">- December 9, 2024</span> </li> <li> <a href="/post/2022-02-26-1">管理視点におけるmacOSのSystem Extensionについて</a> <span class="post-date">- February 26, 2022</span> </li> <li> <a href="/post/2020-12-03-1">PPPCで付与できないmacOSのプライバシー保護機能にアクセス権を付与する</a> <span class="post-date">- December 3, 2020</span> </li> <li> <a href="/post/2020-11-04-1">macOSアプリケーションのアイコンを取得する</a> <span class="post-date">- November 4, 2020</span> </li> </div> </div> </section> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/jamf-pro">Jamf Pro</a> <a href="/tag/macos">macOS</a> <a href="/tag/macosupgrade">macOSUpgrade</a> <a href="/tag/erase-install">erase-install</a> <a href="/tag/script">Script</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.55445db2fff8ddfed8c5.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>