<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>IdPを介してMacにログインできるXCredsを検証してみた</title> <meta name="description" content="IdPを介してMacにログインできるツールとしては、Jamf社が開発しているJamf Connectが有名です。 しかし、Jamf Connectは有償であり、追加でJamf Connect用のJumpStartの費用がかかり、最小スロットが25ライセンスからであるため、導入のハードルが高い場合があります。 今回は、IdPを介してMacにログインできるXCredsを検証してみました。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="IdPを介してMacにログインできるツールとしては、Jamf社が開発しているJamf Connectが有名です。 しかし、Jamf Connectは有償であり、追加でJamf Connect用のJumpStartの費用がかかり、最小スロットが25ライセンスからであるため、導入のハードルが高い場合があります。 今回は、IdPを介してMacにログインできるXCredsを検証してみました。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2022-09-15-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="IdPを介してMacにログインできるXCredsを検証してみた"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="IdPを介してMacにログインできるXCredsを検証してみた"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="IdPを介してMacにログインできるツールとしては、Jamf社が開発しているJamf Connectが有名です。 しかし、Jamf Connectは有償であり、追加でJamf Connect用のJumpStartの費用がかかり、最小スロットが25ライセンスからであるため、導入のハードルが高い場合があります。 今回は、IdPを介してMacにログインできるXCredsを検証してみました。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2022-09-15-1"> <link rel="preload" as="style" href="/assets/bundle/app.55445db2fff8ddfed8c5.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.55445db2fff8ddfed8c5.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2022-09-15-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2022-09-15-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">IdPを介してMacにログインできるXCredsを検証してみた</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2022-09-15</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/system-administration">system-administration </a> </div> </section> <article class="post-content"> <p>IdPを介してMacにログインできるツールとしては、Jamf社が開発している<a href="https://www.jamf.com/ja/products/jamf-connect/" target="_blank" rel="noopener noreferrer">Jamf Connect</a>が有名です。 しかし、Jamf Connectは有償であり、追加でJamf Connect用のJumpStartの費用がかかり、最小スロットが25ライセンスからであるため、導入のハードルが高い場合があります。</p> <p>今回は、IdPを介してMacにログインできるXCredsを検証してみました。</p> <ul id="markdown-toc"> <li> <a href="#xcreds%E3%81%A8%E3%81%AF" id="markdown-toc-xcredsとは">XCredsとは</a> <ul> <li><a href="#xcreds-login" id="markdown-toc-xcreds-login">XCreds Login</a></li> <li><a href="#xcreds%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3" id="markdown-toc-xcredsアプリケーション">XCredsアプリケーション</a></li> </ul> </li> <li><a href="#%E4%BB%A3%E6%9B%BF%E3%83%84%E3%83%BC%E3%83%AB%E3%81%A8%E3%81%AE%E6%AF%94%E8%BC%83" id="markdown-toc-代替ツールとの比較">代替ツールとの比較</a></li> <li> <a href="#%E3%82%BC%E3%83%AD%E3%82%BF%E3%83%83%E3%83%81%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%ABxcreds%E3%82%92%E7%B5%B1%E5%90%88" id="markdown-toc-ゼロタッチデプロイにxcredsを統合">ゼロタッチデプロイにXCredsを統合</a> <ul> <li><a href="#%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83" id="markdown-toc-検証環境">検証環境</a></li> <li><a href="#azure-active-directory%E3%81%AE%E8%A8%AD%E5%AE%9A" id="markdown-toc-azure-active-directoryの設定">Azure Active Directoryの設定</a></li> <li><a href="#jamf-pro%E3%81%AE%E8%A8%AD%E5%AE%9A" id="markdown-toc-jamf-proの設定">Jamf Proの設定</a></li> <li><a href="#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D" id="markdown-toc-動作確認">動作確認</a></li> <li><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB" id="markdown-toc-終わりに">終わりに</a></li> </ul> </li> </ul> <h2 id="xcredsとは">XCredsとは</h2> <p><a href="https://twocanoes.com/products/mac/xcreds/" target="_blank" rel="noopener noreferrer">XCreds</a>とは<a href="https://twocanoes.com/" target="_blank" rel="noopener noreferrer">Twocanoes Software</a>社が<a href="https://github.com/twocanoes/xcreds" target="_blank" rel="noopener noreferrer">オープンソースソフトウェア（OSS）として開発</a>している、IdPを介してMacにログインできるツールです。 XCredsは、</p> <ul> <li>XCreds Login</li> <li>XCredsアプリケーション</li> </ul> <p>の2つのコンポーネントで構成されています。</p> <p>執筆現在、</p> <ul> <li>Azure Active Directory</li> <li>Google Workspace</li> <li>Okta</li> </ul> <p>および、任意のOIDCをサポートするIdPで使用可能です。</p> <p>また、IdP側の認証が、</p> <ul> <li>パスワード認証</li> <li>パスワード認証および多要素認証</li> </ul> <p>である場合のみサポートしています。セキュリティキーなどのパスワードレス認証はサポートしていません。</p> <h3 id="xcreds-login">XCreds Login</h3> <p>XCreds Loginは既存のmacOSのログインウィンドウを、IdPのWebViewを介した認証画面に切り替える、セキュリティエージェントです。</p> <p>認証が完了すると、OIDCのレスポンスから取得できる、</p> <ul> <li>アクセストークン</li> <li>IDトークン</li> <li>リフレッシュトークン</li> </ul> <p>および、IdPの認証に使用したパスワードをそれぞれKeychainに保存します。 XCredsでは、これらを合わせてXCredsトークンと呼びます。</p> <p>また、macOSのローカルパスワードとIdPのパスワードが異なっていた場合は、MacのローカルパスワードをIdPのパスワードに変更します。</p> <h3 id="xcredsアプリケーション">XCredsアプリケーション</h3> <p>XCredsアプリケーションは、IdPのパスワードとローカルパスワードを同期するためのアプリケーションです。</p> <p>アプリケーションは、Keychainに保存されているアクセストークンの有効期限を確認します。 アクセストークンの有効期限が切れていた場合は、リフレッシュトークンを使用して、新たなアクセストークンを取得します。</p> <p>もしIdP側でパスワードの変更などにより、トークンが無効になっていた場合は、WebViewを介しがIdPの認証画面が表示されます。</p> <p>認証に成功すると、XCreds Loginと同様にXCredsトークン、つまり、</p> <ul> <li>IdPのパスワード</li> <li>アクセストークン</li> <li>IDトークン</li> <li>リフレッシュトークン</li> </ul> <p>がKeychainに保存されます。</p> <p>また、macOSのローカルパスワードとIdPのパスワードが異なっていた場合は、MacのローカルパスワードをIdPのパスワードに変更します。</p> <p>XCredsアプリケーションはユーザーがログインウィンドウにログインした際に起動するように設定することが推奨されています。</p> <h2 id="代替ツールとの比較">代替ツールとの比較</h2> <p>XCredsとJamf Connectは、IdPを介してMacにログインする機能のみにフォーカスすると、ほぼ同じと言ってしまってよいと思います。</p> <p>その中で、特に選択において参考になる部分を比較してみました。</p> <table> <thead> <tr> <th style="text-align: left">項目</th> <th>XCreds</th> <th>Jamf Connect</th> </tr> </thead> <tbody> <tr> <td style="text-align: left"><strong>OSバージョン</strong></td> <td> <code class="language-plaintext highlighter-rouge">11.0</code> 以降<sup id="fnref:xcreds-support-os"><a href="#fn:xcreds-support-os" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> </td> <td> <code class="language-plaintext highlighter-rouge">10.15.4</code> 以降</td> </tr> <tr> <td style="text-align: left"><strong>IDプロバイダ</strong></td> <td>Azure Active Directory<br>Okta<br>Google ID<br>OneLogin<br>任意のOIDCプロバイダ</td> <td>Azure Active Directory<br>Google ID<br>IBM Security Verify<br>OneLogin<br>PingFederate<br>任意のOIDCプロバイダ</td> </tr> <tr> <td style="text-align: left"><strong>費用</strong></td> <td>無償（OSS）<br>オプションで<a href="https://twocanoes.com/xcreds-support-plans/" target="_blank" rel="noopener noreferrer">サポート</a>が$999/年または$4999/年</td> <td>$24/年<br>別途JumpStart（研修）代<br>25ライセンスから</td> </tr> <tr> <td style="text-align: left"><strong>sudoコマンド</strong></td> <td>-</td> <td> <a href="https://docs.jamf.com/jamf-connect/2.14.0/documentation/Pluggable_Authentication_Module.html" target="_blank" rel="noopener noreferrer">Pluggable Authentication Module</a>の提供</td> </tr> <tr> <td style="text-align: left"><strong>パスワード以外の手段</strong></td> <td>-</td> <td> <a href="https://docs.jamf.com/jamf-connect/2.14.0/documentation/Jamf_Unlock.html" target="_blank" rel="noopener noreferrer">Jamf Unlock</a>のiOSアプリケーション</td> </tr> </tbody> </table> <h2 id="ゼロタッチデプロイにxcredsを統合">ゼロタッチデプロイにXCredsを統合</h2> <p>ここで言うゼロタッチデプロイは、組織の管理者などがキッティングを行わずにデバイスをエンドユーザーに直接渡したとして、最低限のアカウント設定などのデバイスの設定が自動で行われることを想定しています。</p> <p>また、ディスク暗号化も有効にすることを想定しています。</p> <h3 id="検証環境">検証環境</h3> <ul> <li>Mac <ul> <li>MacBook Air (13-inch, 2018)</li> <li>macOS Monterey 12.5.1</li> <li>Apple Business ManagerにAutomated Device Enrollmentデバイスとして設定済み</li> </ul> </li> <li>XCreds <ul> <li>PreBeta (<a href="https://github.com/twocanoes/xcreds/releases/download/prebeta/PreBeta-XCreds_Build-3268_Version-2.1.pkg" target="_blank" rel="noopener noreferrer">PreBetaPreBeta-XCreds_Build-3268_Version-2.1</a>)</li> </ul> </li> <li>IdP <ul> <li>Azure Active Directory</li> </ul> </li> <li>MDM <ul> <li>Jamf Pro 10.40.1</li> </ul> </li> </ul> <h3 id="azure-active-directoryの設定">Azure Active Directoryの設定</h3> <p>Microsoft Azure Portalにアクセスして設定します。</p> <h4 id="xcredsとazure-adの統合">XCredsとAzure ADの統合</h4> <ol> <li> <p>[Azure サービス] &gt; [アプリの登録] &gt; [新規登録] をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/index_app_registration_at_azure_portal.png" data-fancybox="images" data-caption="Azure Portalのアプリの登録一覧"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure Portalのアプリの登録一覧" data-src="/assets/posts/post/2022-09-15-1/index_app_registration_at_azure_portal.png" class="lazyload"></a></p> </li> <li>リダイレクトURIと任意のアプリケーション名を設定し、[登録]をクリックします。 <ul> <li> <strong>名前</strong>: <code class="language-plaintext highlighter-rouge">XCreds</code> <ul> <li>名前は任意の文字列で可</li> </ul> </li> <li> <strong>サポートされているアカウントの種類</strong>: <code class="language-plaintext highlighter-rouge">この組織ディレクトリのみに含まれるアカウント（xxxxxのディレクトリのみ - シングルテナント）</code> <ul> <li>ユースケースに合わせて設定</li> </ul> </li> <li> <strong>リダイレクトURI</strong>: <code class="language-plaintext highlighter-rouge">xcreds://auth/</code> <ul> <li> <strong>パブリッククライアント/ネイティブ（モバイルとデスクトップ）</strong>として登録</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/app_creation_app_registration_at_azure_portal.png" data-fancybox="images" data-caption="Azure Portalのアプリの登録の新規登録"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure Portalのアプリの登録の新規登録" data-src="/assets/posts/post/2022-09-15-1/app_creation_app_registration_at_azure_portal.png" class="lazyload"></a></p> </li> <li>[概要]から以下の値を取得しておきます。 <ul> <li><strong>アプリケーション（クライアント）ID</strong></li> <li><strong>ディレクトリ（テナント）ID</strong></li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/overview_at_app.png" data-fancybox="images" data-caption="XCredsアプリの概要"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="XCredsアプリの概要" data-src="/assets/posts/post/2022-09-15-1/overview_at_app.png" class="lazyload"></a></p> </li> <li> <p>[証明書とシークレット] &gt; [新しいクライアントシークレット] から[説明]と[有効期限]を設定し、[追加]をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/secret_generation_certificate_and_secret_at_app.png" data-fancybox="images" data-caption="XCredsアプリの証明書とシークレットのクライアントシークレット発行"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="XCredsアプリの証明書とシークレットのクライアントシークレット発行" data-src="/assets/posts/post/2022-09-15-1/secret_generation_certificate_and_secret_at_app.png" class="lazyload"></a></p> </li> <li>発行したシークレットの[値]を取得しておきます。 <ul> <li>パブリッククライアント/ネイティブ（モバイルとデスクトップ）として登録しているため、この値は秘匿情報として扱う必要はない</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/generated_secret_certificate_and_secret_at_app.png" data-fancybox="images" data-caption="XCredsアプリの証明書とシークレットのクライアントシークレット発行"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="XCredsアプリの証明書とシークレットのクライアントシークレット発行" data-src="/assets/posts/post/2022-09-15-1/generated_secret_certificate_and_secret_at_app.png" class="lazyload"></a></p> </li> <li> <p>[APIのアクセス許可] &gt; [xxxxのディレクトリに管理者の同意を与えます]をクリックし、[はい]をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/admin_delegation_api_access_at_app.png" data-fancybox="images" data-caption="XCredsアプリのAPIのアクセス許可の管理者の同意"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="XCredsアプリのAPIのアクセス許可の管理者の同意" data-src="/assets/posts/post/2022-09-15-1/admin_delegation_api_access_at_app.png" class="lazyload"></a></p> </li> </ol> <h4 id="xcredsへのログイン許可">XCredsへのログイン許可</h4> <p>アプリケーションにログインできるように、ユーザーまたはまたはグループにアクセス権限を付与します。</p> <ol> <li> <p>[Azure サービス] &gt; [エンタープライズアプリケーション] &gt; [XCreds（アプリの登録で登録した名前）] をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/index_enterprise_application_at_azure_portal.png" data-fancybox="images" data-caption="Azure Portalのエンタープライズアプリケーションの一覧"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure Portalのエンタープライズアプリケーションの一覧" data-src="/assets/posts/post/2022-09-15-1/index_enterprise_application_at_azure_portal.png" class="lazyload"></a></p> </li> <li> <p>[ユーザーとグループ] &gt; [ユーザーまたはグループの追加] をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/user_and_group_at_app.png" data-fancybox="images" data-caption="エンタープライズアプリケーションのユーザーとグループ"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="エンタープライズアプリケーションのユーザーとグループ" data-src="/assets/posts/post/2022-09-15-1/user_and_group_at_app.png" class="lazyload"></a></p> </li> <li> <p>[ユーザー]または[グループ] &gt; [対象となるオブジェクト] &gt; [選択] &gt; [割り当て]をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/assign_user_or_group_at_app.png" data-fancybox="images" data-caption="エンタープライズアプリケーションのユーザーまたはグループのアサイン"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="エンタープライズアプリケーションのユーザーまたはグループのアサイン" data-src="/assets/posts/post/2022-09-15-1/assign_user_or_group_at_app.png" class="lazyload"></a></p> </li> </ol> <h3 id="jamf-proの設定">Jamf Proの設定</h3> <p>Jamf Proサーバーにアクセスして設定します。</p> <p>事前に、XCredsで使用したいバージョンの<code class="language-plaintext highlighter-rouge">pkg</code>を<a href="https://github.com/twocanoes/xcreds/releases" target="_blank" rel="noopener noreferrer">リリースページ</a>からダウンロードしておきます。</p> <h4 id="xcredsパッケージの登録">XCredsパッケージの登録</h4> <ol> <li>[設定] &gt; [コンピュータ管理] &gt; [パッケージ] &gt; [新規] をクリックします。</li> <li>[ファイル選択]から事前にダウンロードしておいたXCredsの<code class="language-plaintext highlighter-rouge">pkg</code>ファイルを選択して[保存]をクリックします。 <ul> <li>[カテゴリ]の設定は任意</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/xcreds_package_upload_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるXCredsパッケージのアップロード"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるXCredsパッケージのアップロード" data-src="/assets/posts/post/2022-09-15-1/xcreds_package_upload_at_jamf_pro.png" class="lazyload"></a></p> </li> </ol> <h4 id="xcredsのプロファイルの設定">XCredsのプロファイルの設定</h4> <ol> <li>[コンピュータ] &gt; [構成プロファイル] &gt; [新規] をクリックします。</li> <li>[一般]の項目を選択し、各項目を設定します。 <ul> <li> <strong>名前</strong>: <code class="language-plaintext highlighter-rouge">XCreds</code> <ul> <li>名前は任意の文字列で可</li> </ul> </li> <li> <strong>レベル</strong>: <code class="language-plaintext highlighter-rouge">Computer Level</code> </li> <li> <strong>配布方法</strong>: <code class="language-plaintext highlighter-rouge">Install Automatically</code> </li> <li>説明、サイト、カテゴリは任意</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_general_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるXCredsの構成プロファイルの一般設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるXCredsの構成プロファイルの一般設定" data-src="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_general_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[ログイン項目] &gt; [構成] &gt; [項目] &gt; [追加] から、Itemに <code class="language-plaintext highlighter-rouge">/Applications/XCreds.app/</code> を設定して[Save]をクリックします。 <ul> <li><strong>末尾に<code class="language-plaintext highlighter-rouge">/</code>がないと正しく動作しないので注意</strong></li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_login_items_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるXCredsの構成プロファイルのログイン項目設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるXCredsの構成プロファイルのログイン項目設定" data-src="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_login_items_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[アプリケーションとカスタム設定] &gt; [外部アプリケーション] &gt; [追加] から[ソース]と[環境設定ドメイン]を設定し、[スキーマ追加]をクリックします。 <ul> <li> <strong>ソース</strong>: <code class="language-plaintext highlighter-rouge">カスタムスキーマ</code> </li> <li> <strong>環境設定ドメイン</strong>: <code class="language-plaintext highlighter-rouge">com.twocanoes.xcreds</code> </li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_application_and_custom_settings_external_application_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるXCredsの構成プロファイルのアプリケーションとカスタム設定の外部アプリケーション設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるXCredsの構成プロファイルのアプリケーションとカスタム設定の外部アプリケーション設定" data-src="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_application_and_custom_settings_external_application_at_jamf_pro.png" class="lazyload"></a></p> </li> <li> <p><a href="/assets/posts/post/2022-09-15-1/com.twocanoes.xcreds.json">XCredsのJSON Schema</a>の内容を入力、またはアップロードし、[保存]をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_application_and_custom_settings_external_application_custom_schema_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるXCredsの構成プロファイルのアプリケーションとカスタム設定の外部アプリケーション設定におけるカスタムスキーマの追加"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるXCredsの構成プロファイルのアプリケーションとカスタム設定の外部アプリケーション設定におけるカスタムスキーマの追加" data-src="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_application_and_custom_settings_external_application_custom_schema_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[環境設定ドメインのプロパティ]の[Add/Remove properties]から必要およびカスタムしたい項目を選択し、値を設定します。 <ul> <li> <strong>Client ID</strong>: <code class="language-plaintext highlighter-rouge">Azure ADで取得した[アプリケーション（クライアント）ID]</code> </li> <li> <strong>Client Secret</strong>: <code class="language-plaintext highlighter-rouge">Azure ADで発行したシークレット</code> </li> <li> <strong>Discovery URL</strong>: <code class="language-plaintext highlighter-rouge">https://login.microsoftonline.com/&lt;Azure ADで取得した[ディレクトリ（テナント）ID]&gt;/.well-known/openid-configuration</code> </li> <li> <strong>Scopes</strong>: <code class="language-plaintext highlighter-rouge">profile openid offline_access</code> <ul> <li>OIDCの認証時に必要なクレームを設定できる</li> </ul> </li> <li> <strong>Show Support Status Message</strong>: <code class="language-plaintext highlighter-rouge">false</code> <ul> <li>設定は任意</li> <li>WebViewのログイン画面を表示する際にXCredsのサポートを訴求するメッセージを表示される</li> <li>今回は特に必要ないため非表示にしている</li> </ul> </li> <li> <strong>Enable Full Disk Encryption (FED)</strong>: <code class="language-plaintext highlighter-rouge">true</code> <ul> <li>設定は任意</li> <li>ユーザーが初めてログインしたタイミングで、FileVaultの暗号化が実行される</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_application_and_custom_settings_external_application_properties_settings_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるXCredsの構成プロファイルのアプリケーションとカスタム設定の外部アプリケーション設定におけるプロパティの設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるXCredsの構成プロファイルのアプリケーションとカスタム設定の外部アプリケーション設定におけるプロパティの設定" data-src="/assets/posts/post/2022-09-15-1/xcreds_configration_profile_application_and_custom_settings_external_application_properties_settings_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[Scope]をクリックして、配布したいスコープを設定します。 <ul> <li>検証のため[ターゲットコンピュータ]を<code class="language-plaintext highlighter-rouge">All Computers</code>として設定</li> </ul> </li> <li>[保存]をクリックします。</li> </ol> <p>特に環境設定は、例えば作成するユーザーに管理者権限を付与する<code class="language-plaintext highlighter-rouge">Create Admin User</code>など、お使いのワークロードに適する設定などもあるため、必要な場合は適宜設定を変更してください。一部記載されてないプロパティがありますが、詳しくは<a href="https://github.com/twocanoes/xcreds/wiki/AdminGuide" target="_blank" rel="noopener noreferrer">XCreds AdminGuide</a>を参照してください。</p> <h4 id="filevaultのプロファイルの設定">FileVaultのプロファイルの設定</h4> <p>今回、FileVaultの設定は別のプロファイルとして設定していますが、XCredsのプロファイルにまとめることも可能です。</p> <ol> <li>[コンピュータ] &gt; [構成プロファイル] &gt; [新規] をクリックします。</li> <li>[一般]の項目を選択し、各項目を設定します。 <ul> <li> <strong>名前</strong>: <code class="language-plaintext highlighter-rouge">FileVault</code> <ul> <li>名前は任意の文字列で可</li> </ul> </li> <li> <strong>レベル</strong>: <code class="language-plaintext highlighter-rouge">Computer Level</code> </li> <li> <strong>配布方法</strong>: <code class="language-plaintext highlighter-rouge">Install Automatically</code> </li> <li>説明、サイト、カテゴリは任意</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/file_vault_configration_profile_general_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるFileVaultの構成プロファイルの一般設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるFileVaultの構成プロファイルの一般設定" data-src="/assets/posts/post/2022-09-15-1/file_vault_configration_profile_general_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[セキュリティとプライバシー] &gt; [FileVault] をクリックして各項目を設定します。 <ul> <li> <strong>FileVault オプションのユーザによる変更</strong>: <code class="language-plaintext highlighter-rouge">[FileVaultの無効化を防止]としてトグルをON</code> <ul> <li>設定は任意</li> <li>特別な理由がない限りは、FileVaultを無効化させる必要はない</li> </ul> </li> <li> <strong>ユーザに休止状態からの復帰後 FileVault の解除を要求</strong>: <code class="language-plaintext highlighter-rouge">[有効]としてトグルをON</code> <ul> <li>設定は任意</li> </ul> </li> <li> <strong>個人所有のリカバリキーのエスクロー</strong>: <code class="language-plaintext highlighter-rouge">トグルをON</code> <ul> <li> <strong>暗号化の方法</strong>: <code class="language-plaintext highlighter-rouge">リカバリーキーを自動的に暗号化/復号</code> </li> <li> <strong>エスクローの場所の説明</strong>: <code class="language-plaintext highlighter-rouge">Jamf Pro</code> <ul> <li>任意の文字列</li> </ul> </li> </ul> </li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/file_vault_configration_profile_security_and_privacy_file_vault_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるFileVaultの構成プロファイルのセキュリティとプライバシーのFileVault設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるFileVaultの構成プロファイルのセキュリティとプライバシーのFileVault設定" data-src="/assets/posts/post/2022-09-15-1/file_vault_configration_profile_security_and_privacy_file_vault_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[Scope]をクリックして、配布したいスコープを設定します。 <ul> <li>検証のため[ターゲットコンピュータ]を<code class="language-plaintext highlighter-rouge">All Computers</code>として設定</li> </ul> </li> <li>[保存]をクリックします。</li> </ol> <p>XCredsのプロファイル側でもFileVaultを有効化しましたが、別途FileVaultのプロファイル設定が必要なのには2つの理由があります。</p> <ol> <li>XCredsの<code class="language-plaintext highlighter-rouge">Save PRK</code>とJamf Proとの相性が良くない <ul> <li> <code class="language-plaintext highlighter-rouge">Save PRK</code>はMDMのエクスローサービスがパーソナルリカバリーキーを収集できるように、デフォルトでは<code class="language-plaintext highlighter-rouge">/var/db/FDE/FDESetup.plist</code>に情報を保存するが、Jamfエージェントはそのファイルを読み込まないため、Jamf Proサーバーにパーソナルリカバリーが収集されない</li> </ul> </li> <li>MDMのAPI（構成プロファイル）でログイン時にFileVaultを有効化すると、XCredsの処理と競合してしまう <ul> <li>FileVaultの有効化のポップアップが表示されてしまい、XCredsがログインウィンドウへのログイン処理が実行できずにログインが失敗したと認識されてしまう</li> <li>FileVaultの有効化のポップアップをログアウト後にすることで、XCredsの設定側ではFileVaultの設定をしないことも可能だが、ログアウト後にFileVaultを有効化する場合、強制終了やエンドユーザーのライフサイクルを考慮しないといけないため、あまり推奨されない</li> </ul> </li> </ol> <h4 id="prestage-enrollmentsの設定">PreStage Enrollmentsの設定</h4> <ol> <li>[コンピュータ] &gt; [Prestage Enrollments] &gt; [新規] をクリックします。</li> <li>[一般]から各値を設定します。 <ul> <li> <strong>表示名</strong>: <code class="language-plaintext highlighter-rouge">kenchan0130 HQ</code> <ul> <li>任意の文字列</li> </ul> </li> <li> <strong>設定アシスタントオプション</strong>: <code class="language-plaintext highlighter-rouge">[プライバシー]をアンチェック</code> <ul> <li>[設定アシスタントによる自動アドバンス]や[設定アシスタントオプション]をすべてチェックしてしまうと、XCredsのパッケージがログインウィンドウに到達する前に展開されない可能性があるため、<strong>何かしら設定アシスタントの項目を残しておくことが推奨される</strong> </li> </ul> </li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_general_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるPreStage Enrollmentsの一般設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるPreStage Enrollmentsの一般設定" data-src="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_general_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[アカウント設定] &gt; [構成] をクリックして、各値を設定します。 <ul> <li> <strong>セットアップアシスタントの前にローカル管理者アカウントを作成する</strong>: <code class="language-plaintext highlighter-rouge">有効</code> <ul> <li> <strong>ユーザー名</strong>: <code class="language-plaintext highlighter-rouge">kenchan0130admin</code> <ul> <li>任意の文字列</li> </ul> </li> <li> <strong>パスワード</strong>、 <strong>パスワードの確認</strong>: <code class="language-plaintext highlighter-rouge">任意のパスワード</code> </li> <li> <strong>ローカルアカウントユーザータイプ</strong>: <code class="language-plaintext highlighter-rouge">アカウントの作成をスキップ</code> <ul> <li>XCredsがアカウントを作成するためスキップしておく必要がある</li> </ul> </li> </ul> </li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_account_settings_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるPreStage Enrollmentsのアカウント設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるPreStage Enrollmentsのアカウント設定" data-src="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_account_settings_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[構成プロファイル] &gt; [構成] をクリックして、有効化したいプロファイルを選択します。 <ul> <li>先程作成した構成プロファイルの<strong>XCreds</strong>と<strong>FileVault</strong>を選択</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_configration_profiles_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるPreStage Enrollmentsの構成プロファイル設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるPreStage Enrollmentsの構成プロファイル設定" data-src="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_configration_profiles_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[登録パッケージ] &gt; [構成] をクリックして、使用したいパッケージを選択します。 <ul> <li>先程登録した<strong>XCredsのパッケージ</strong>を選択</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_enrollment_packages_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf ProにおけるPreStage Enrollmentsの登録パッケージ設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf ProにおけるPreStage Enrollmentsの登録パッケージ設定" data-src="/assets/posts/post/2022-09-15-1/pre_stage_enrollments_enrollment_packages_at_jamf_pro.png" class="lazyload"></a></p> </li> <li>[Scope]をクリックして、配布したいスコープを設定します。</li> <li>[保存]をクリックします。</li> </ol> <h3 id="動作確認">動作確認</h3> <h4 id="初期化状態での挙動">初期化状態での挙動</h4> <p>初期化状態のMacを起動して確認していきます。</p> <p>最初は、</p> <ol> <li>言語</li> <li>国または地域</li> <li>文字入力および音声入力</li> <li>アクセシビリティ</li> <li>ネットワーク</li> </ol> <p>が順に表示されるため、指示に従い、設定します。</p> <ol> <li> <p>リモートマネジメントの表示を確認して[続ける]をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/remote_management_on_setup_assistant.png" data-fancybox="images" data-caption="セットアップアシスタントのリモートマネジメント画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="セットアップアシスタントのリモートマネジメント画面" data-src="/assets/posts/post/2022-09-15-1/remote_management_on_setup_assistant.png" class="lazyload"></a></p> </li> <li>データとプライバシーの表示を確認して[続ける]をクリックします。 <ul> <li>PreStage Enrollmentsで表示するように設定したため表示されている</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/data_and_privacy_on_setup_assistant.png" data-fancybox="images" data-caption="セットアップアシスタントのデータとプライバシー画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="セットアップアシスタントのデータとプライバシー画面" data-src="/assets/posts/post/2022-09-15-1/data_and_privacy_on_setup_assistant.png" class="lazyload"></a></p> </li> <li> <p>時間帯を適切に選択し、[続ける]をクリックします。</p> <p><a href="/assets/posts/post/2022-09-15-1/location_on_setup_assistant.png" data-fancybox="images" data-caption="セットアップアシスタントの時間帯の画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="セットアップアシスタントの時間帯の画面" data-src="/assets/posts/post/2022-09-15-1/location_on_setup_assistant.png" class="lazyload"></a></p> </li> <li>IdPのログイン画面が表示されるため、認証情報を入力します。 <ul> <li>今回はAzure ADのユーザーに対してパスワードリセットを施して、そこで提供されたワンタイムのパスワード入力</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/azure_ad_username_input_on_xcreds_login_window.png" data-fancybox="images" data-caption="XCredsのログインウィンドウにおけるAzure ADのユーザー名入力画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="XCredsのログインウィンドウにおけるAzure ADのユーザー名入力画面" data-src="/assets/posts/post/2022-09-15-1/azure_ad_username_input_on_xcreds_login_window.png" class="lazyload"></a> <a href="/assets/posts/post/2022-09-15-1/azure_ad_password_input_on_xcreds_login_window.png" data-fancybox="images" data-caption="XCredsのログインウィンドウにおけるAzure ADのパスワード入力画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="XCredsのログインウィンドウにおけるAzure ADのパスワード入力画面" data-src="/assets/posts/post/2022-09-15-1/azure_ad_password_input_on_xcreds_login_window.png" class="lazyload"></a> <a href="/assets/posts/post/2022-09-15-1/azure_ad_change_password_on_xcreds_login_window.png" data-fancybox="images" data-caption="XCredsのログインウィンドウにおけるAzure ADのパスワード変更画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="XCredsのログインウィンドウにおけるAzure ADのパスワード変更画面" data-src="/assets/posts/post/2022-09-15-1/azure_ad_change_password_on_xcreds_login_window.png" class="lazyload"></a></p> </li> <li>IdPの認証が成功すると、FileVaultの有効化を確認するポップアップが表示されるため、[OK]をクリックします。 <ul> <li>このポップアップで[Don’t Allow]を選択すると、再度IdPのログイン画面が表示される</li> </ul> <p><a href="/assets/posts/post/2022-09-15-1/start_file_vault_on_xcreds_login_window.png" data-fancybox="images" data-caption="IdPの認証が成功したあとのFileVaultの有効化確認画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="IdPの認証が成功したあとのFileVaultの有効化確認画面" data-src="/assets/posts/post/2022-09-15-1/start_file_vault_on_xcreds_login_window.png" class="lazyload"></a></p> </li> </ol> <p>ここまで完了すると、ユーザーが作成され、FileVaultも有効化されている状態になります。</p> <h4 id="idpの認証パスワードとmacのローカルパスワードが異なっている場合の挙動">IdPの認証パスワードとMacのローカルパスワードが異なっている場合の挙動</h4> <p>運用をしていると、IdPの認証パスワードとMacのローカルパスワードが異なるという事象は多く発生します。</p> <p>XCredsはMacのローカルパスワードをIdPの認証パスワードに更新しようとします。 また、XCerdsはKeyChainを引き継ごうとするため、以前のMacのローカルパスワードを要求します。</p> <p><a href="/assets/posts/post/2022-09-15-1/xcreds_idp_password_sync.png" data-fancybox="images" data-caption="IdPのパスワードとMacのローカルパスワードが異なっていた場合の以前のMacのローカルパスワードの確認ダイアログ"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="IdPのパスワードとMacのローカルパスワードが異なっていた場合の以前のMacのローカルパスワードの確認ダイアログ" data-src="/assets/posts/post/2022-09-15-1/xcreds_idp_password_sync.png" class="lazyload"></a></p> <p>さらに、ログインウィンドウでも同様に、以前のMacのローカルパスワードを要求します。</p> <p><a href="/assets/posts/post/2022-09-15-1/difference_password_before_password_input_on_xcreds_login_window.png" data-fancybox="images" data-caption="IdPのパスワードとMacのローカルパスワードが異なっていた場合の以前のMacのローカルパスワードの確認ダイアログ"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="IdPのパスワードとMacのローカルパスワードが異なっていた場合の以前のMacのローカルパスワードの確認ダイアログ" data-src="/assets/posts/post/2022-09-15-1/difference_password_before_password_input_on_xcreds_login_window.png" class="lazyload"></a> <a href="/assets/posts/post/2022-09-15-1/difference_password_update_keychain_on_xcreds_login_window.png" data-fancybox="images" data-caption="IdPのパスワードとMacのローカルパスワードが異なっていた場合のKeychainの更新"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="IdPのパスワードとMacのローカルパスワードが異なっていた場合のKeychainの更新" data-src="/assets/posts/post/2022-09-15-1/difference_password_update_keychain_on_xcreds_login_window.png" class="lazyload"></a></p> <p>しかし、以前のMacのローカルパスワードが分からない場合は、XCredsが以前のMacのローカルパスワードを要求するダイアログが出続けてしまいます。 FileVaultが解除されていない場合は、合わせてJamf Proに保存されているリカバリーキーで暗号化を解除します。</p> <p><a href="/assets/posts/post/2022-09-15-1/inventory_disk_encryption_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf Proにおけるインベントリのディスク暗号化項目"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf Proにおけるインベントリのディスク暗号化項目" data-src="/assets/posts/post/2022-09-15-1/inventory_disk_encryption_at_jamf_pro.png" class="lazyload"></a></p> <p>FileVaultの暗号化が解除されれば、Jamf Proなどのポリシーが動作するため、Jamf Proのローカルアカウントのポリシーを使用して、Macのローカルパスワードがリセットできます。<sup id="fnref:local-account-password-reset-proviso"><a href="#fn:local-account-password-reset-proviso" class="footnote" rel="footnote" role="doc-noteref">2</a></sup></p> <p><a href="/assets/posts/post/2022-09-15-1/policy_local_account_password_reset_at_jamf_pro.png" data-fancybox="images" data-caption="Jamf Proにおけるポリシーのローカルアカウント項目のローカルパスワードリセット設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf Proにおけるポリシーのローカルアカウント項目のローカルパスワードリセット設定" data-src="/assets/posts/post/2022-09-15-1/policy_local_account_password_reset_at_jamf_pro.png" class="lazyload"></a></p> <p>これらを組み合わせることで、以前のMacのローカルパスワードが分からない場合でも、復旧が可能です。</p> <h3 id="終わりに">終わりに</h3> <p>XCredsについて解説するとともに、ゼロタッチデプロイにおいてXCredsが機能するかを検証してみました。</p> <p>XCredsはIdPを介してMacにログインするための最低限の機能を有していることがわかりました。</p> <p>ただ、Jamf Connectは有償なだけあり、<a href="https://docs.jamf.com/jamf-connect/2.15.0/documentation/Release_History.html" target="_blank" rel="noopener noreferrer">リリースノート</a>などを見る限り、高機能かつ、UXも洗練されているように見受けられるという印象を受けます。</p> <p>また、macOS Venturaから導入予定のPlatform Single Sign-onとも競合する可能性があります。 お使いのIdPが<a href="/post/2022-08-18-1#platform-single-sign-on">Platform Single Sign-on</a>をサポートする場合は、そちらを使用するのが良い可能性があります。 ただ、もしIdPのサポートが実施されない、またはサポートに時間がかかる場合は、XCredsが引き続き有効な手段となると思いました。</p> <p>XCredsやJamf Connect（おそらくPlatform Single Sign-onも）すべてに言えることですが、これらを導入してもFileVaultの解除がパスワードおよびリカバリーキーのみしかサポートしていないため、パスワードレスになるわけではありません。 あくまで、複数のパスワードを覚える必要がなくなり、エンドユーザーの体験が向上するだけであることに注意が必要です。</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:xcreds-support-os"> <p>XCredsのVersion2.0を使用すると、macOS Big Sur環境ではアプリケーションが動作しません。未確認ですが、PreBeta版では修正されている模様です。 <a href="#fnref:xcreds-support-os" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:local-account-password-reset-proviso"> <p>ローカルパスワードをリセットすると、Keychainも再生成されるため、Keychainに保存されていた値にはアクセスできなくなります。 <a href="#fnref:local-account-password-reset-proviso" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </article> <section class="share"> <a href="//twitter.com/share?text=IdP%E3%82%92%E4%BB%8B%E3%81%97%E3%81%A6Mac%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7%E3%81%8D%E3%82%8BXCreds%E3%82%92%E6%A4%9C%E8%A8%BC%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2022-09-15-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=IdP%E3%82%92%E4%BB%8B%E3%81%97%E3%81%A6Mac%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7%E3%81%8D%E3%82%8BXCreds%E3%82%92%E6%A4%9C%E8%A8%BC%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2022-09-15-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=IdP%E3%82%92%E4%BB%8B%E3%81%97%E3%81%A6Mac%E3%81%AB%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7%E3%81%8D%E3%82%8BXCreds%E3%82%92%E6%A4%9C%E8%A8%BC%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2022-09-15-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2022-09-15-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents related-posts"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">あわせて読みたい</div> <div class="sub-contents-main"> <li> <a href="/post/2024-06-19-1">WWDC 2024で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- June 19, 2024</span> </li> <li> <a href="/post/2022-08-18-1">WWDC 2022で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- August 18, 2022</span> </li> <li> <a href="/post/2020-02-13-1">Jamf Pro ServerにSSOを設定</a> <span class="post-date">- February 13, 2020</span> </li> <li> <a href="/post/2025-06-19-1">WWDC 2025で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- June 19, 2025</span> </li> <li> <a href="/post/2021-06-24-1">WWDC 2021で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- June 24, 2021</span> </li> </div> </div> </section> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/apple">Apple</a> <a href="/tag/azure-active-directory">Azure Active Directory</a> <a href="/tag/jamf">Jamf</a> <a href="/tag/jamf-connect">Jamf Connect</a> <a href="/tag/idp">IdP</a> <a href="/tag/macos">macOS</a> <a href="/tag/mdm">MDM</a> <a href="/tag/sso">SSO</a> <a href="/tag/xcreds">XCreds</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.55445db2fff8ddfed8c5.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>