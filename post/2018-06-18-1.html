<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>Circle CIを使用したWebページのGitHub Pagesへのデプロイ</title> <meta name="description" content="GitHub PagesはGitHubを使用してWebページをホスティングしてくれるサービスです。 今回は、 継続的インテグレーションサービスであるCircle CIを使用してページの自動ビルドとGitHub Pagesへの自動デプロイを行う手法を紹介します。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="GitHub PagesはGitHubを使用してWebページをホスティングしてくれるサービスです。 今回は、 継続的インテグレーションサービスであるCircle CIを使用してページの自動ビルドとGitHub Pagesへの自動デプロイを行う手法を紹介します。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2018-06-18-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="Circle CIを使用したWebページのGitHub Pagesへのデプロイ"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Circle CIを使用したWebページのGitHub Pagesへのデプロイ"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="GitHub PagesはGitHubを使用してWebページをホスティングしてくれるサービスです。 今回は、 継続的インテグレーションサービスであるCircle CIを使用してページの自動ビルドとGitHub Pagesへの自動デプロイを行う手法を紹介します。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2018-06-18-1"> <link rel="preload" as="style" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2018-06-18-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2018-06-18-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">Circle CIを使用したWebページのGitHub Pagesへのデプロイ</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2018-06-18</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/development">development </a> </div> </section> <article class="post-content"> <p>Circle CIで挟まざまなビルドが可能となるため、 <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a> や <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> など静的なサイトジェネレータを使用してWebページを生成することが可能となります。 もちろん、サイトジェネレータを使用せずに静的ページがホスティング可能です。</p> <p>さらに、そのビルド結果をGitHub PagesでWebページを公開するための自動デプロイを行うことが可能となります。</p> <p>これらはすべて無料で行えるため、お財布にも優しいです。</p> <ul id="markdown-toc"> <li> <a href="#github-pages" id="markdown-toc-github-pages">GitHub Pages</a> <ul> <li><a href="#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%90%8D" id="markdown-toc-ドメイン名">ドメイン名</a></li> </ul> </li> <li><a href="#circle-ci" id="markdown-toc-circle-ci">Circle CI</a></li> <li><a href="#%E5%85%AC%E9%96%8B%E6%96%B9%E6%B3%95%E3%81%AE%E9%81%B8%E6%8A%9E" id="markdown-toc-公開方法の選択">公開方法の選択</a></li> <li> <a href="#%E5%85%AC%E9%96%8B%E3%82%BF%E3%82%A4%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AE%E9%81%B8%E6%8A%9E" id="markdown-toc-公開タイミングの選択">公開タイミングの選択</a> <ul> <li><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B31-%E9%81%B8%E6%8A%9E%E3%81%97%E3%81%9F%E5%85%AC%E9%96%8B%E6%96%B9%E6%B3%95%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%BE%E3%81%9F%E3%81%AF%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E7%9B%B4%E6%8E%A5%E6%88%90%E6%9E%9C%E7%89%A9%E3%82%92push%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95" id="markdown-toc-パターン1-選択した公開方法のブランチまたはディレクトリに直接成果物をpushする方法">パターン1: 選択した公開方法のブランチまたはディレクトリに、直接成果物をpushする方法</a></li> <li><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B32-github%E3%81%AE%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E6%88%90%E6%9E%9C%E7%89%A9%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6%E9%81%B8%E6%8A%9E%E3%81%97%E3%81%9F%E5%85%AC%E9%96%8B%E6%96%B9%E6%B3%95%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%BE%E3%81%9F%E3%81%AF%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%ABpush%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95" id="markdown-toc-パターン2-githubのイベントを利用し成果物をビルドして選択した公開方法のブランチまたはディレクトリにpushする方法">パターン2: GitHubのイベントを利用し、成果物をビルドして、選択した公開方法のブランチまたはディレクトリにpushする方法</a></li> <li><a href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B33-circle-ci%E3%81%AEapi%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E6%88%90%E6%9E%9C%E7%89%A9%E3%82%92%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6%E9%81%B8%E6%8A%9E%E3%81%97%E3%81%9F%E5%85%AC%E9%96%8B%E6%96%B9%E6%B3%95%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E3%81%BE%E3%81%9F%E3%81%AF%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%ABpush%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95" id="markdown-toc-パターン3-circle-ciのapiを呼び出し成果物をビルドして選択した公開方法のブランチまたはディレクトリにpushする方法">パターン3: Circle CIのAPIを呼び出し、成果物をビルドして、選択した公開方法のブランチまたはディレクトリにpushする方法</a></li> </ul> </li> <li> <a href="#%E5%85%AC%E9%96%8B%E3%81%AE%E6%BA%96%E5%82%99" id="markdown-toc-公開の準備">公開の準備</a> <ul> <li><a href="#vuepress%E3%81%AE%E6%88%90%E6%9E%9C%E7%89%A9%E3%81%AE%E7%94%9F%E6%88%90%E5%85%88%E3%81%AE%E5%A4%89%E6%9B%B4" id="markdown-toc-vuepressの成果物の生成先の変更">VuePressの成果物の生成先の変更</a></li> <li><a href="#circle-ci%E3%81%AE%E8%A8%AD%E5%AE%9A" id="markdown-toc-circle-ciの設定">Circle CIの設定</a></li> <li><a href="#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E7%94%A8%E6%84%8F" id="markdown-toc-デプロイスクリプトの用意">デプロイスクリプトの用意</a></li> <li><a href="#circle-ci%E3%81%AE%E9%80%A3%E6%90%BA" id="markdown-toc-circle-ciの連携">Circle CIの連携</a></li> <li><a href="#github-pages%E3%81%AE%E5%85%AC%E9%96%8B" id="markdown-toc-github-pagesの公開">GitHub Pagesの公開</a></li> </ul> </li> <li><a href="#%E3%81%BE%E3%81%A8%E3%82%81" id="markdown-toc-まとめ">まとめ</a></li> </ul> <h2 id="github-pages">GitHub Pages</h2> <p><a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a> は <a href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub</a> が提供している、GitHub上のリポジトリにアップされたコンテンツを利用してWebページとして公開できるホスティングサービスです。</p> <p>また、カスタムドメインも使用でき、さらには <a href="https://blog.github.com/2018-05-01-github-pages-custom-domains-https/" target="_blank" rel="noopener noreferrer">2018 年 5 月にカスタムドメインの HTTPS での配信がサポート</a>されました。</p> <p>privateリポジトリもGitHub Pagesが使用できますが、指定した配下以下はすべて公開されてしまうため、 くれぐれも公開の際にはご注意ください。</p> <p>このブログもGitHub Pagesを使用しています。</p> <h3 id="ドメイン名">ドメイン名</h3> <p>個人リポジトリは <code class="language-plaintext highlighter-rouge">[user name].github.io</code>、組織アカウントは <code class="language-plaintext highlighter-rouge">[organization name].github.io/リポジトリ名</code> となります。</p> <p>また、 <code class="language-plaintext highlighter-rouge">CNAME</code> ファイルを用意して中身に独自ドメインを記載すると独自ドメインの設定が可能となります。</p> <h2 id="circle-ci">Circle CI</h2> <p><a href="https://circleci.com/" target="_blank" rel="noopener noreferrer">Circle CI</a> は、継続的インテグレーションサービスです。 継続的な統合や配信が可能となり、ソフトウェア開発プロセスを自動化できます。</p> <p>1 Containerが無料で使用でき、1 Container増設毎に $50/月かかります。 また、GitHubやBitbuketと柔軟に連携が可能であり、 privateリポジトリの区別もありません。</p> <p>GitHub Pagesをデプロイする際には1 Containerで十分なため、無料で始めることが可能です。</p> <h2 id="公開方法の選択">公開方法の選択</h2> <p>GitHub Pagesは</p> <ul> <li> <code class="language-plaintext highlighter-rouge">master</code> ブランチ配下をすべて公開</li> <li> <code class="language-plaintext highlighter-rouge">master</code> ブランチの <code class="language-plaintext highlighter-rouge">docs</code> ディレクトリ以下をすべて公開</li> <li> <code class="language-plaintext highlighter-rouge">gh-pages</code> ブランチ配下をすべて公開</li> </ul> <p>のどれかを1つ選択可能です。</p> <p>つまり、公開する方法を選択したら、それに応じてブランチまたはディレクトリ配下にビルド成果物を入れて、 GitHubのリポジトリにpushすることでWebページを公開できます。</p> <p>ご自身のユースケースにマッチする方法を選択しましょう。</p> <p>リポジトリに <code class="language-plaintext highlighter-rouge">master</code> や <code class="language-plaintext highlighter-rouge">gh-pages</code> ブランチが存在しない場合は、該当する公開方法が選択できないようになっています。</p> <h2 id="公開タイミングの選択">公開タイミングの選択</h2> <p>公開タイミングも人それぞれですが、大きく分けて以下から選択することとなります。</p> <ol> <li>選択した公開方法のブランチまたはディレクトリに、直接成果物をpushする方法</li> <li>GitHubのイベントを利用し、成果物をビルドして、選択した公開方法のブランチまたはディレクトリにpushする方法</li> <li>Circle CIのAPIを呼び出し、成果物をビルドして、選択した公開方法のブランチまたはディレクトリにpushする方法</li> </ol> <h3 id="パターン1-選択した公開方法のブランチまたはディレクトリに直接成果物をpushする方法">パターン1: 選択した公開方法のブランチまたはディレクトリに、直接成果物をpushする方法</h3> <p>この方法はビルド環境がローカルにある必要がありますが、公開タイミングを自分で選択でき、かつCIを使用なくても実現できます。</p> <p>しかし、複数人でメンテナンスを行う場合は、全員が同じ環境でビルドを行う保証がなく、下書きなど公開前の管理が難しくあまり向いていません。</p> <h3 id="パターン2-githubのイベントを利用し成果物をビルドして選択した公開方法のブランチまたはディレクトリにpushする方法">パターン2: GitHubのイベントを利用し、成果物をビルドして、選択した公開方法のブランチまたはディレクトリにpushする方法</h3> <p>この方法はビルドをローカル環境で行わずよく、公開前にテストなどさまざまなビルドが可能となります。</p> <p>この中でも一般的に多く取られる方法は、 「とあるブランチにmergeされたら、選択した公開方法のブランチまたはディレクトリにpushする」です。</p> <h3 id="パターン3-circle-ciのapiを呼び出し成果物をビルドして選択した公開方法のブランチまたはディレクトリにpushする方法">パターン3: Circle CIのAPIを呼び出し、成果物をビルドして、選択した公開方法のブランチまたはディレクトリにpushする方法</h3> <p>この方法はGitHubのイベント以外を利用したい場合、たとえばチャットbotなどで取られることが多い方法です。</p> <p>もちろんビルドをローカル環境で行わずよく、公開前にテストなどさまざまなビルドが可能となります。 また、任意のタイミングで公開ができるのも大きな強みです。</p> <h2 id="公開の準備">公開の準備</h2> <p>例として以下の方法とタイミングで <a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer">VuePress</a> で作成した静的ページを公開するようにしてみます。</p> <p>今回使用しているサンプルは<a href="https://github.com/kenchan0130/github-pages-vuepress-example" target="_blank" rel="noopener noreferrer">こちら</a>です。</p> <table> <thead> <tr> <th>公開方法</th> <th>公開タイミング</th> </tr> </thead> <tbody> <tr> <td> <code class="language-plaintext highlighter-rouge">master</code> ブランチの <code class="language-plaintext highlighter-rouge">docs</code> ディレクトリ以下をすべて公開</td> <td>GitHubのイベントを利用し、成果物をビルドして、選択した公開方法のブランチまたはディレクトリにpushする方法</td> </tr> </tbody> </table> <h3 id="vuepressの成果物の生成先の変更">VuePressの成果物の生成先の変更</h3> <p>VuePressはデフォルトで <code class="language-plaintext highlighter-rouge">.vuepress/dist</code> にビルドされます。 しかし、 <code class="language-plaintext highlighter-rouge">config.js</code> に <code class="language-plaintext highlighter-rouge">dest</code> を設定することで、ビルド先を変更できます。</p> <p>今回はこの <code class="language-plaintext highlighter-rouge">dest</code> に <code class="language-plaintext highlighter-rouge">docs/</code> を指定することにします。</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/.vuepress/config.js</span>

<span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">GitHub Pages VuePress Sample!</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">description</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Just play VuePress for kenchan0130 blog.</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">title</span><span class="p">:</span> <span class="nx">title</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="nx">description</span><span class="p">,</span>
  <span class="na">dest</span><span class="p">:</span> <span class="dl">'</span><span class="s1">docs/</span><span class="dl">'</span>
<span class="p">};</span>
</code></pre></div></div> <p>これで <code class="language-plaintext highlighter-rouge">vuepress build</code> のビルド先が <code class="language-plaintext highlighter-rouge">docs/</code> になりました。</p> <h3 id="circle-ciの設定">Circle CIの設定</h3> <p>Circle CIでbuildを行うので、<code class="language-plaintext highlighter-rouge">.circleci/config.yml</code> にビルドの設定を記述していきます。</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="m">2</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">working_directory</span><span class="pi">:</span> <span class="s">~/github-pages-vuepress-example</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">node:9.11</span>
        <span class="na">environment</span><span class="pi">:</span>
          <span class="na">TZ</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/usr/share/zoneinfo/Asia/Tokyo"</span>
          <span class="na">LANG</span><span class="pi">:</span> <span class="s">ja_JP.UTF-8</span>
          <span class="na">LC_ALL</span><span class="pi">:</span> <span class="s">C.UTF-8</span>
          <span class="na">LANGUAGE</span><span class="pi">:</span> <span class="s">ja_JP.UTF-8</span>
          <span class="na">DEPLOY_BRANCH</span><span class="pi">:</span> <span class="s">master</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">checkout</span>

      <span class="c1">#### Node dependencies ####</span>
      <span class="pi">-</span> <span class="na">restore_cache</span><span class="pi">:</span>
          <span class="na">keys</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">yarn-packages-{{ .Branch }}-{{ checksum "yarn.lock" }}</span>
            <span class="pi">-</span> <span class="s">yarn-packages-{{ .Branch }}</span>
            <span class="pi">-</span> <span class="s">yarn-packages-master</span>
            <span class="pi">-</span> <span class="s">yarn-packages-</span>

      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Install Node dependencies</span>
          <span class="na">command</span><span class="pi">:</span> <span class="s">yarn install</span>

      <span class="pi">-</span> <span class="na">save_cache</span><span class="pi">:</span>
          <span class="na">paths</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">node_moduels</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">yarn-packages-{{ .Branch }}-{{ checksum "yarn.lock" }}</span>
      <span class="c1">#### Node dependencies end ####</span>

      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy development branch to master</span>
          <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">if [ "${CIRCLE_BRANCH}" = "${DEPLOY_BRANCH}" ]; then</span>
              <span class="s">chmod +x deploy.sh</span>
              <span class="s">./deploy.sh</span>
            <span class="s">fi</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">steps</code> が実際に行っている処理です。具体的には、</p> <ol> <li> <code class="language-plaintext highlighter-rouge">working_directory</code> に設定したディレクトリに対象のコミットをチェックアウト</li> <li>キャッシュの呼び出し</li> <li> <code class="language-plaintext highlighter-rouge">node</code> の依存をインストール</li> <li> <code class="language-plaintext highlighter-rouge">node_moduels</code> をキャッシュ</li> <li>今ビルドしているブランチが <code class="language-plaintext highlighter-rouge">master</code> だったらデプロイスクリプト（<code class="language-plaintext highlighter-rouge">deploy.sh</code>）を走らせる</li> </ol> <p>を行っています。</p> <p>今回のポイントは「今ビルドしているブランチが <code class="language-plaintext highlighter-rouge">master</code> だったらデプロイスクリプト（<code class="language-plaintext highlighter-rouge">deploy.sh</code>）を走らせる」です。 これにより、 <code class="language-plaintext highlighter-rouge">master</code> に変更があった時のみデプロイが行われます。</p> <h3 id="デプロイスクリプトの用意">デプロイスクリプトの用意</h3> <p>Circle CIのビルド設定で <code class="language-plaintext highlighter-rouge">deploy.sh</code> を走らせるようにしましたが、ここでは実際にその中身を用意します。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash -e</span>

<span class="c"># build</span>
yarn run <span class="nt">--silent</span> build

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="si">$(</span>git status <span class="nt">--porcelain</span> | <span class="nb">wc</span> <span class="nt">-l</span> | xargs<span class="si">)</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Not exist deploying contents."</span>
  <span class="nb">exit </span>0
<span class="k">fi

</span>git config <span class="nt">--global</span> user.name <span class="s2">"Circle CI"</span>
git config <span class="nt">--global</span> user.email <span class="s2">"&lt;&gt;"</span>
git add <span class="nt">-A</span>
git commit <span class="nt">-m</span> <span class="s2">"[ci skip] Deploy by CI"</span>

git push <span class="nt">-f</span> <span class="si">$(</span>git config <span class="nt">--get</span> remote.origin.url<span class="si">)</span> master:master <span class="o">&gt;</span> /dev/null/ 2&gt;&amp;1

<span class="nb">echo</span> <span class="s2">"Deploy a site!"</span>

<span class="nb">cd</span> -
</code></pre></div></div> <p>やっていることは単純で、</p> <ol> <li>VuePressのビルド</li> <li>デプロイ内容物かあるかの確認</li> <li>ビルド結果をコミット</li> <li>GitHubのリモート <code class="language-plaintext highlighter-rouge">master</code> ブランチにコミットをpush</li> </ol> <p>を順に行っています。</p> <p>重要なのはコミットメッセージに <strong>[ci skip]</strong> を含めていることです。</p> <p>このコミットがマージされた際のビルドではCIが走りません。 もしCIを走らせてしまうと、無限にデプロイ処理が行われてしまいます。</p> <p>ほかにもSlack通知など行うなど、ご自身で自在にカスタマイズが可能です。</p> <h3 id="circle-ciの連携">Circle CIの連携</h3> <p>Circle CIと連携されていないとGitHubのリポジトリにコミットをプッシュしてもビルドは走りません。 まずはCircle CIにログインをします。</p> <p>プロジェクトの追加を選択して、今回連携したいリポジトリを選択して <strong>Set Up Project</strong> をクリックします。</p> <p><a href="/assets/posts/post/2018-06-18-1/circle-ci-add-projects.png" data-fancybox="images" data-caption="Circle CI のプロジェクトの追加"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Circle CI のプロジェクトの追加" data-src="/assets/posts/post/2018-06-18-1/circle-ci-add-projects.png" class="lazyload"></a></p> <p>ビルドの設定方法などが記載されていますが、もうすでに設定済みなので <strong>Start building</strong> をクリックするだけです。</p> <p><a href="/assets/posts/post/2018-06-18-1/circle-ci-set-up-project.png" data-fancybox="images" data-caption="Circle CI のプロジェクトの設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Circle CI のプロジェクトの設定" data-src="/assets/posts/post/2018-06-18-1/circle-ci-set-up-project.png" class="lazyload"></a></p> <p>これで、リポジトリに変更があるたびにCircle CIのビルドが走ます。</p> <h3 id="github-pagesの公開">GitHub Pagesの公開</h3> <p><code class="language-plaintext highlighter-rouge">master</code> ブランチの <code class="language-plaintext highlighter-rouge">docs/</code> ディレクトリに成果物がプッシュされるようになったので、 Gitリポジトリの <strong>Settings</strong> より、 GitHub Pagesの公開方法を指定します。</p> <p><a href="/assets/posts/post/2018-06-18-1/github_pages_selection.png" data-fancybox="images" data-caption="GitHub Pages 公開方法選択"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="GitHub Pages 公開方法選択" data-src="/assets/posts/post/2018-06-18-1/github_pages_selection.png" class="lazyload"></a></p> <p>今回は関係しませんが、カスタムドメインを設定する場合、 「<code class="language-plaintext highlighter-rouge">master</code> ブランチの <code class="language-plaintext highlighter-rouge">docs</code> ディレクトリ以下を全て公開」を選択していると、 <code class="language-plaintext highlighter-rouge">CNAME</code> ファイルは <code class="language-plaintext highlighter-rouge">docs/CNAME</code> に設置する必要があります。</p> <p>ディレクトリルート直下に <code class="language-plaintext highlighter-rouge">CNAME</code> ファイルを設定しても反映されません。 意外とハマりどころなのでご注意ください。</p> <h2 id="まとめ">まとめ</h2> <p>GitHub PagesをCircle CIを使用してデプロイする方法を紹介しました。</p> <p>公開方法と公開タイミングをどう選択するかで、 若干Circle CIの設定やデプロイスクリプトの内容が変わりますが、 基本的にやることは変わりません。</p> <p>GitHub PagesとCircle CIでお手軽にかつ、お金をかけずに静的サイトホスティングしていきましょう！</p> </article> <section class="share"> <a href="//twitter.com/share?text=Circle+CI%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9FWeb%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AEGitHub+Pages%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2018-06-18-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=Circle+CI%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9FWeb%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AEGitHub+Pages%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2018-06-18-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=Circle+CI%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9FWeb%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AEGitHub+Pages%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2018-06-18-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2018-06-18-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/circle-ci">Circle CI</a> <a href="/tag/github-pages">GitHub Pages</a> <a href="/tag/vuepress">VuePress</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.6b4bd929e0a1773ddf90.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>