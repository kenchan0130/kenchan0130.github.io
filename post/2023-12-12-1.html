<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する</title> <meta name="description" content="Microsoft Intuneでエンロールされているデバイスは、デフォルトで8時間ごとにサーバーと同期を行います。 この同期時間をワークロードによっては変更したい場合があります。 今回は、Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する方法を紹介します。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="Microsoft Intuneでエンロールされているデバイスは、デフォルトで8時間ごとにサーバーと同期を行います。 この同期時間をワークロードによっては変更したい場合があります。 今回は、Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する方法を紹介します。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2023-12-12-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="Microsoft Intuneでエンロールされているデバイスは、デフォルトで8時間ごとにサーバーと同期を行います。 この同期時間をワークロードによっては変更したい場合があります。 今回は、Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する方法を紹介します。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2023-12-12-1"> <link rel="preload" as="style" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2023-12-12-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2023-12-12-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2023-12-12</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/system-administration">system-administration </a> </div> </section> <article class="post-content"> <p>この記事は<a href="https://adventar.org/calendars/8868" target="_blank" rel="noopener noreferrer">corp-engr 情シスSlack（コーポレートエンジニア x 情シス）#1 Advent Calendar 2023</a>の12/2分の記事です。ずいぶん遅れてやってきてしまいました。</p> <p>Microsoft Intuneでエンロールされているデバイスは、デフォルトで8時間ごとにサーバーと同期を行います。 この同期時間をワークロードによっては変更したい場合があります。</p> <p>今回は、Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する方法を紹介します。</p> <ul id="markdown-toc"> <li><a href="#windows%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A8%E3%81%AE%E5%AE%9A%E6%9C%9F%E7%9A%84%E3%81%AA%E5%90%8C%E6%9C%9F%E3%81%AE%E4%BB%95%E6%A7%98" id="markdown-toc-windowsデバイスのサーバーとの定期的な同期の仕様">Windowsデバイスのサーバーとの定期的な同期の仕様</a></li> <li><a href="#%E5%90%8C%E6%9C%9F%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B" id="markdown-toc-同期サイクルを変更する">同期サイクルを変更する</a></li> <li> <a href="#%E5%90%8C%E6%9C%9F%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%99%E3%82%8B" id="markdown-toc-同期サイクルの変更を自動化する">同期サイクルの変更を自動化する</a> <ul> <li><a href="#%E5%90%8C%E6%9C%9F%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88" id="markdown-toc-同期サイクルを変更するスクリプト">同期サイクルを変更するスクリプト</a></li> <li><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E9%85%8D%E5%B8%83" id="markdown-toc-スクリプトの配布">スクリプトの配布</a></li> </ul> </li> <li><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB" id="markdown-toc-終わりに">終わりに</a></li> </ul> <h2 id="windowsデバイスのサーバーとの定期的な同期の仕様">Windowsデバイスのサーバーとの定期的な同期の仕様</h2> <p><a href="https://learn.microsoft.com/ja-jp/mem/intune/configuration/device-profile-troubleshoot#policy-refresh-intervals" target="_blank" rel="noopener noreferrer">Microsoft Intuneのポリシーとプロファイルに関する質問 | Microsoft Learn</a>によると、Windowsデバイスのサーバーとの定期的な同期は約8時間ごとに実行されます。</p> <table> <thead> <tr> <th>プラットフォーム</th> <th>更新サイクル</th> </tr> </thead> <tbody> <tr> <td>Android</td> <td>約8時間ごと</td> </tr> <tr> <td>iOS/iPadOS</td> <td>約8時間ごと</td> </tr> <tr> <td>macOS</td> <td>約8時間ごと</td> </tr> <tr> <td><strong>Windows 10/11のPCをデバイスとして登録</strong></td> <td><strong>約8時間ごと</strong></td> </tr> <tr> <td><strong>Windows 8.1</strong></td> <td><strong>約8時間ごと</strong></td> </tr> </tbody> </table> <p>実際にデバイス上の設定を確認してみると、タスクスケジューラの <code class="language-plaintext highlighter-rouge">\Microsoft\Windows\EnterpriseMgmt\エンロールID</code> のタスクパスに登録されている <code class="language-plaintext highlighter-rouge">Schedule #3 created by enrollment client</code> タスクに、該当のトリガーが設定されていることが分かります。</p> <p><a href="/assets/posts/post/2023-12-12-1/intune_sync_task_per_8hours_on_task_scheduler.png" data-fancybox="images" data-caption="タスクスケジューラにおける、8時間ごとにMicrosoft Intuneと同期するタスク"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="タスクスケジューラにおける、8時間ごとにMicrosoft Intuneと同期するタスク" data-src="/assets/posts/post/2023-12-12-1/intune_sync_task_per_8hours_on_task_scheduler.png" class="lazyload"></a></p> <p>また、ドキュメントには以下のように、条件によっては同期時間が変わることが記載されています。</p> <blockquote> <p>デバイスを最近登録した場合は、コンプライアンス、コンプライアンス違反、構成のチェックインの実行頻度が高くなります。 チェックインは、次のように推定されます。</p> </blockquote> <table> <thead> <tr> <th>プラットフォーム</th> <th>頻度</th> </tr> </thead> <tbody> <tr> <td>Android</td> <td>15分まで3分ごと、その後の2時間は1分ごと、その後は約8時間ごと</td> </tr> <tr> <td>iOS/iPadOS</td> <td>1時間まで15分ごと、その後は約8時間ごと</td> </tr> <tr> <td>macOS</td> <td>1時間まで15分ごと、その後は約8時間ごと</td> </tr> <tr> <td><strong>Windows 10/11のPCをデバイスとして登録</strong></td> <td><strong>15分まで3分ごと、その後の2時間は15分ごと、その後は約8時間ごと</strong></td> </tr> <tr> <td><strong>Windows 8.1</strong></td> <td><strong>15分まで5分ごと、その後の2時間は15分ごと、その後は約8時間ごと</strong></td> </tr> </tbody> </table> <p>こちらも、タスクスケジューラの <code class="language-plaintext highlighter-rouge">\Microsoft\Windows\EnterpriseMgmt\エンロールID</code> のタスクパスに登録されている、</p> <ul> <li><code class="language-plaintext highlighter-rouge">Schedule #1 created by enrollment client</code></li> <li><code class="language-plaintext highlighter-rouge">Schedule #2 created by enrollment client</code></li> </ul> <p>のタスクに、該当のトリガーが設定されていることが分かります。</p> <p><a href="/assets/posts/post/2023-12-12-1/intune_sync_task_some_conditions_on_task_scheduler.png" data-fancybox="images" data-caption="タスクスケジューラにおける、いつくかの条件においてMicrosoft Intuneと同期するタスク"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="タスクスケジューラにおける、いつくかの条件においてMicrosoft Intuneと同期するタスク" data-src="/assets/posts/post/2023-12-12-1/intune_sync_task_some_conditions_on_task_scheduler.png" class="lazyload"></a></p> <h2 id="同期サイクルを変更する">同期サイクルを変更する</h2> <p>前述の通り、8時間ごとにMicrosoft Intuneと同期するタスクは <code class="language-plaintext highlighter-rouge">Schedule #3 created by enrollment client</code> でした。 このサイクルを変更したい場合は、トリガーの「繰り返し間隔」を変更することで実現できます。</p> <p>このタスクは管理者権限で作成されているため、以下の操作も管理者権限で行う必要があります。</p> <ol> <li> <code class="language-plaintext highlighter-rouge">Schedule #3 created by enrollment client</code> &gt; [プロパティ] &gt; [トリガー] を選択 <a href="/assets/posts/post/2023-12-12-1/properties_of_schedule_3_created_by_enrollment_client_task.png" data-fancybox="images" data-caption=""><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="" data-src="/assets/posts/post/2023-12-12-1/properties_of_schedule_3_created_by_enrollment_client_task.png" class="lazyload"></a> </li> <li>[編集] &gt; [繰り返し間隔] から時間を変更 <a href="/assets/posts/post/2023-12-12-1/trigger_interval_of_schedule_3_created_by_enrollment_client_task.png" data-fancybox="images" data-caption=""><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="" data-src="/assets/posts/post/2023-12-12-1/trigger_interval_of_schedule_3_created_by_enrollment_client_task.png" class="lazyload"></a> </li> </ol> <p>エンロールされた際のこのタスクが作成されるため、以降タスクの設定が上書きされることは基本的にはありません。 ただ、今後Microsoft Intuneの仕様が変わって、Windows Updateなどの後にタスクが作り直される可能性はあります。</p> <h2 id="同期サイクルの変更を自動化する">同期サイクルの変更を自動化する</h2> <p>上記の手順を行えば同期サイクルを変更できますが、キッティング時に1台1台手動で設定するのはたいへんです。 そこで、1台1台手動で設定するのではなく、手順をスクリプト化したものMicrosoft Intuneで配布することで、この作業を自動化できます。</p> <h3 id="同期サイクルを変更するスクリプト">同期サイクルを変更するスクリプト</h3> <p>以下は、例として同期サイクルを<strong>1時間</strong>に変更するスクリプトです。 <code class="language-plaintext highlighter-rouge">$repetitionInterval</code>に変更したい同期サイクルを設定しています。必要に応じて変更してください。</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 同期サイクルとして設定したい時間を指定</span><span class="w">
</span><span class="c"># ISO 8601で定義されている、継続時間が指定可能</span><span class="w">
</span><span class="nv">$repetitionInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PT1H"</span><span class="w">

</span><span class="c"># オブジェクトをDeep Cloneするための関数</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">Copy-Object</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="kr">Param</span><span class="w"> </span><span class="p">(</span><span class="w">
    </span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$false</span><span class="p">)]</span><span class="w">
    </span><span class="nv">$Original</span><span class="p">,</span><span class="w">

    </span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">Mandatory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$true</span><span class="p">)]</span><span class="w">
    </span><span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="w"> </span><span class="nv">$DeepClone</span><span class="w">
  </span><span class="p">)</span><span class="w">

  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$null</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$Original</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$DeepClone</span><span class="o">.</span><span class="nf">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nv">$memStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new-object</span><span class="w"> </span><span class="nx">IO.MemoryStream</span><span class="w">
    </span><span class="nv">$formatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new-object</span><span class="w"> </span><span class="nx">Runtime.Serialization.Formatters.Binary.BinaryFormatter</span><span class="w">
    </span><span class="nv">$formatter</span><span class="o">.</span><span class="nf">Serialize</span><span class="p">(</span><span class="nv">$memStream</span><span class="p">,</span><span class="w"> </span><span class="nv">$Original</span><span class="p">)</span><span class="w">
    </span><span class="nv">$memStream</span><span class="o">.</span><span class="nf">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="nv">$DeepClone</span><span class="o">.</span><span class="nf">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$formatter</span><span class="o">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="nv">$memStream</span><span class="p">)</span><span class="w">
    </span><span class="nv">$memStream</span><span class="o">.</span><span class="nf">Close</span><span class="p">()</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="c"># Intuneに関係するスケジュールタスクを取得</span><span class="w">
  </span><span class="nv">$scheduledTasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ScheduledTask</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">TaskPath</span><span class="p">)</span><span class="w"> </span><span class="o">-Match</span><span class="w"> </span><span class="s2">"\\Microsoft\\Windows\\EnterpriseMgmt\\[0-9A-Z]"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nv">$scheduledTasks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"This device is not enrolled"</span><span class="w">
    </span><span class="kr">exit</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="c"># 「Schedule #3 created by enrollment client」のタスクを取得</span><span class="w">
  </span><span class="nv">$intuneSyncTaskCandidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$scheduledTasks</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">TaskName</span><span class="p">)</span><span class="w"> </span><span class="o">-Match</span><span class="w"> </span><span class="s2">"^Schedule #3 created by enrollment client$"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nv">$intuneSyncTaskCandidate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Not found intune sync tasks, please check task name on device"</span><span class="w">
    </span><span class="kr">exit</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="nv">$intuneSyncTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$intuneSyncTaskCandidate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nv">$intuneSyncTask</span><span class="o">.</span><span class="nf">Triggers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Not found triggers at '</span><span class="si">$(</span><span class="nv">$intuneSyncTask</span><span class="o">.</span><span class="nf">TaskName</span><span class="si">)</span><span class="s2">' task"</span><span class="w">
    </span><span class="kr">exit</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="c"># すでに同期サイクルが設定されている場合は処理を止める</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$intuneSyncTask</span><span class="o">.</span><span class="n">Triggers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nf">Repetition</span><span class="o">.</span><span class="nf">Interval</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$repetitionInterval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Repetition interval of task is already set as </span><span class="nv">$repetitionInterval</span><span class="s2">"</span><span class="w">
    </span><span class="kr">exit</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="c"># 同期サイクルを設定するために、すでに設定されいてる'MSFT_TaskTimeTrigger'インスタンスを複製して、Intervalを上書きしている</span><span class="w">
  </span><span class="c"># Deep Cloneまでする必要はないかもしれないが、ミュータブルは副作用があるかもしれないため、イミュータブルなインスタンスを作成している</span><span class="w">
  </span><span class="nv">$trigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$null</span><span class="w">
  </span><span class="n">Copy-Object</span><span class="w"> </span><span class="nt">-Original</span><span class="w"> </span><span class="nv">$intuneSyncTask</span><span class="o">.</span><span class="n">Triggers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="nt">-DeepClone</span><span class="w"> </span><span class="p">([</span><span class="n">ref</span><span class="p">]</span><span class="nv">$trigger</span><span class="p">)</span><span class="w">
  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nv">$trigger</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kr">throw</span><span class="w"> </span><span class="s2">"The instance could not be copied and became null by Copy-Object function"</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="nv">$trigger</span><span class="o">.</span><span class="nf">Repetition</span><span class="o">.</span><span class="nf">Interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$repetitionInterval</span><span class="w">

  </span><span class="c"># 編集したトリガーを該当タスクに設定</span><span class="w">
  </span><span class="n">Set-ScheduledTask</span><span class="w"> </span><span class="nt">-TaskPath</span><span class="w"> </span><span class="nv">$intuneSyncTask</span><span class="o">.</span><span class="nf">TaskPath</span><span class="w"> </span><span class="nt">-TaskName</span><span class="w"> </span><span class="nv">$intuneSyncTask</span><span class="o">.</span><span class="nf">TaskName</span><span class="w"> </span><span class="nt">-Trigger</span><span class="w"> </span><span class="nv">$trigger</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">catch</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"An unexpected error has occurred"</span><span class="w">
  </span><span class="kr">throw</span><span class="w"> </span><span class="bp">$_</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="kr">exit</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></code></pre></div></div> <h3 id="スクリプトの配布">スクリプトの配布</h3> <p>Microsoft IntuneでPowerShellを配布する場合、選択肢としては大きく以下の3通りがあります。</p> <ul> <li>スクリプト機能で配布</li> <li>Win32アプリ（<code class="language-plaintext highlighter-rouge">.intunewin</code>）として配布</li> <li>プロアクティブな修復のスクリプトパッケージとして配布</li> </ul> <p>今回は<strong>「プロアクティブな修復のスクリプトパッケージとして配布」</strong>を使用して、上記のスクリプトを配布してみます。 これにより、もしWindows Updateなどで設定値がデフォルトに戻る場合でも、自動的に設定値を期待通りに設定し直せます。</p> <ol> <li> <p>Microsoft Intune管理センター &gt; [デバイス] &gt; [修復] から、スクリプトパッケージの作成を選択</p> <p><a href="/assets/posts/post/2023-12-12-1/proactive_remediation.png" data-fancybox="images" data-caption="プロアクティブな修復"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="プロアクティブな修復" data-src="/assets/posts/post/2023-12-12-1/proactive_remediation.png" class="lazyload"></a></p> </li> <li> <p>任意の名前を入力</p> <p><a href="/assets/posts/post/2023-12-12-1/create_script_package_basics_proactive_remediation.png" data-fancybox="images" data-caption="カスタムスクリプトの作成 - 基本"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="カスタムスクリプトの作成 - 基本" data-src="/assets/posts/post/2023-12-12-1/create_script_package_basics_proactive_remediation.png" class="lazyload"></a></p> </li> <li> <p>作成したスクリプトを「検出スクリプト」としてアップロード、「64 ビットの PowerShell でスクリプトを実行する」を<strong>はい</strong>に設定</p> <p><a href="/assets/posts/post/2023-12-12-1/create_script_package_settings_proactive_remediation.png" data-fancybox="images" data-caption="カスタムスクリプトの作成 - 設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="カスタムスクリプトの作成 - 設定" data-src="/assets/posts/post/2023-12-12-1/create_script_package_settings_proactive_remediation.png" class="lazyload"></a></p> </li> <li> <p>任意でスコープタグを設定</p> <p><a href="/assets/posts/post/2023-12-12-1/create_script_package_scope_tags_proactive_remediation.png" data-fancybox="images" data-caption="カスタムスクリプトの作成 - スコープタグ"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="カスタムスクリプトの作成 - スコープタグ" data-src="/assets/posts/post/2023-12-12-1/create_script_package_scope_tags_proactive_remediation.png" class="lazyload"></a></p> </li> <li>割り当て先を設定 <ul> <li>割り当てのポリシーは自由に選択できるが、ここでは、すべてのデバイスに対して、毎日実行するように設定</li> </ul> <p><a href="/assets/posts/post/2023-12-12-1/create_script_package_assignments_proactive_remediation.png" data-fancybox="images" data-caption="カスタムスクリプトの作成 - 割り当て"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="カスタムスクリプトの作成 - 割り当て" data-src="/assets/posts/post/2023-12-12-1/create_script_package_assignments_proactive_remediation.png" class="lazyload"></a></p> </li> <li> <p>内容を確認して作成</p> <p><a href="/assets/posts/post/2023-12-12-1/create_script_package_review_proactive_remediation.png" data-fancybox="images" data-caption="カスタムスクリプトの作成 - 確認および作成"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="カスタムスクリプトの作成 - 確認および作成" data-src="/assets/posts/post/2023-12-12-1/create_script_package_review_proactive_remediation.png" class="lazyload"></a></p> </li> </ol> <h2 id="終わりに">終わりに</h2> <p>Microsoft Intune管理下のWindowsデバイスの同期サイクルを変更する方法を紹介しました。</p> <p>Microsoft Intuneの場合、ポリシーを適用してもすぐには反映されず、該当デバイスの設定画面から同期を行ったり、インベントリの「同期」コマンドを実行したりするような運用となることが多いと思います。</p> <p>今回の方法を使用することで、たとえば、組織のデバイスに対して一律で同期サイクルを短くすることで、よりすばやくポリシーが適用でき、迅速なデバイスの保護や情報の収集ができ、運用の効率化ができるかもしれません。</p> </article> <section class="share"> <a href="//twitter.com/share?text=Microsoft+Intune%E7%AE%A1%E7%90%86%E4%B8%8B%E3%81%AEWindows%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%90%8C%E6%9C%9F%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2023-12-12-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=Microsoft+Intune%E7%AE%A1%E7%90%86%E4%B8%8B%E3%81%AEWindows%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%90%8C%E6%9C%9F%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2023-12-12-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=Microsoft+Intune%E7%AE%A1%E7%90%86%E4%B8%8B%E3%81%AEWindows%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%90%8C%E6%9C%9F%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%E3%82%92%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2023-12-12-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2023-12-12-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents related-posts"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">あわせて読みたい</div> <div class="sub-contents-main"> <li> <a href="/post/2021-02-24-1">GitHub ActionsのRunner OSの情報を取得できるアクションを作った</a> <span class="post-date">- February 24, 2021</span> </li> </div> </div> </section> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/microsoft-intune">Microsoft Intune</a> <a href="/tag/powershell">PowerShell</a> <a href="/tag/windows">Windows</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.6b4bd929e0a1773ddf90.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>