<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>Jamf Pro ServerにSSOを設定</title> <meta name="description" content="業務でSaaSを当たり前に使うようになってきた現在、使用するサービスごとにパスワードを覚えるのはたいへんです。 また、パスワード使い回しによる不正アクセスのリスクにさらされる可能性があります。 今回はこの問題を解決できるSSO（Single Sign On）をJamf Pro Serverに設定する方法を解説します。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="業務でSaaSを当たり前に使うようになってきた現在、使用するサービスごとにパスワードを覚えるのはたいへんです。 また、パスワード使い回しによる不正アクセスのリスクにさらされる可能性があります。 今回はこの問題を解決できるSSO（Single Sign On）をJamf Pro Serverに設定する方法を解説します。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2020-02-13-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="Jamf Pro ServerにSSOを設定"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Jamf Pro ServerにSSOを設定"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="業務でSaaSを当たり前に使うようになってきた現在、使用するサービスごとにパスワードを覚えるのはたいへんです。 また、パスワード使い回しによる不正アクセスのリスクにさらされる可能性があります。 今回はこの問題を解決できるSSO（Single Sign On）をJamf Pro Serverに設定する方法を解説します。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2020-02-13-1"> <link rel="preload" as="style" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2020-02-13-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2020-02-13-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">Jamf Pro ServerにSSOを設定</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2020-02-13</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/system-administration">system-administration </a> </div> </section> <article class="post-content"> <p><a href="/post/2020-02-05-1">前回</a>はJamf Pro Serverにログインするところまでを解説しました。</p> <p>業務でSaaSを当たり前に使うようになってきた現在、使用するサービスごとにパスワードを覚えるのはたいへんです。 また、パスワード使い回しによる不正アクセスのリスクにさらされる可能性があります。</p> <p>今回はこの問題を解決できるSSO（Single Sign On）をJamf Pro Serverに設定する方法を解説します。</p> <ul id="markdown-toc"> <li><a href="#ssosingle-sign-on%E3%81%A8%E3%81%AF" id="markdown-toc-ssosingle-sign-onとは">SSO（Single Sign On）とは</a></li> <li><a href="#jamf-pro-server%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Bsso" id="markdown-toc-jamf-pro-serverにおけるsso">Jamf Pro ServerにおけるSSO</a></li> <li> <a href="#jmaf-pro-server%E3%81%ABsso%E3%82%92%E8%A8%AD%E5%AE%9A" id="markdown-toc-jmaf-pro-serverにssoを設定">Jmaf Pro ServerにSSOを設定</a> <ul> <li><a href="#okta%E3%82%92idp%E3%81%A8%E3%81%99%E3%82%8Bsso%E3%81%AE%E8%A8%AD%E5%AE%9A" id="markdown-toc-oktaをidpとするssoの設定">OktaをIdPとするSSOの設定</a></li> <li><a href="#azure-active-directory%E3%82%92idp%E3%81%A8%E3%81%99%E3%82%8Bsso%E3%81%AE%E8%A8%AD%E5%AE%9A" id="markdown-toc-azure-active-directoryをidpとするssoの設定">Azure Active DirectoryをIdPとするSSOの設定</a></li> </ul> </li> <li> <a href="#jamf-pro-server%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E4%BD%9C%E6%88%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" id="markdown-toc-jamf-pro-serverのユーザー作成について">Jamf Pro Serverのユーザー作成について</a> <ul> <li><a href="#ldap%E3%81%A8%E3%81%AE%E7%B5%B1%E5%90%88%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AA%E8%A6%8B%E8%A7%A3" id="markdown-toc-ldapとの統合についての個人的な見解">LDAPとの統合についての個人的な見解</a></li> </ul> </li> <li><a href="#jmaf-pro-server%E3%81%AEsso%E8%A8%AD%E5%AE%9A%E5%BE%8C%E3%81%AE%E3%81%8A%E5%8B%A7%E3%82%81%E4%BD%9C%E6%A5%AD" id="markdown-toc-jmaf-pro-serverのsso設定後のお勧め作業">Jmaf Pro ServerのSSO設定後のお勧め作業</a></li> <li><a href="#%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%AB" id="markdown-toc-終わりに">終わりに</a></li> </ul> <h2 id="ssosingle-sign-onとは">SSO（Single Sign On）とは</h2> <p>SSOとは、複数の関連するが独立したソフトウェアシステムのアクセスを制御する特性のことを指します。多くの場合、ユーザーは単一のIDとパスワードなどを使用してIdP（Identity Provider）の認証するのみでよく、そのIdPと連携済みのシステムはIdPに認証を委譲することでシステムにアクセスを可能とします。</p> <h2 id="jamf-pro-serverにおけるsso">Jamf Pro ServerにおけるSSO</h2> <p>Jamf Pro ServerでSSOを有効にすると、以下のケースにおいて指定したIdPに認証を委譲されます。</p> <ul> <li>Jamf Pro Serverへのログインの認証</li> <li>macOS用のSelf Serviceを使用する際の認証</li> <li>User-Initiated Enrollment時のプロファイル、インストーラをダウンロードするための認証</li> </ul> <p>Jamf Pro Serverは<strong>SAML 2.0</strong>をサポートしているIdPであれば、ほとんどすべてのIdPが使用できるはずです。</p> <h2 id="jmaf-pro-serverにssoを設定">Jmaf Pro ServerにSSOを設定</h2> <p>それでは実際にJamf Pro ServerにSSOを設定していきます。 ここではIdPとしてシェアが大きい<a href="https://www.okta.com/" target="_blank" rel="noopener noreferrer">Okta</a>と<a href="https://azure.microsoft.com/ja-jp/services/active-directory/" target="_blank" rel="noopener noreferrer">Azure Active Directory</a>を例にして統合方法を解説します。</p> <h3 id="oktaをidpとするssoの設定">OktaをIdPとするSSOの設定</h3> <p>まずは、OktaをIdPとしてJamf Pro Serverと統合する方法を紹介します。</p> <h4 id="oktaをidpとするssoの設定---okta側">OktaをIdPとするSSOの設定 - Okta側</h4> <ol> <li>Oktaの管理ページにログインします。</li> <li> <p>アプリケーションの追加ページに遷移します。</p> <p><a href="/assets/posts/post/2020-02-13-1/okta_add_applications.png" data-fancybox="images" data-caption="Oktaのアプリケーションの追加ページ"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Oktaのアプリケーションの追加ページ" data-src="/assets/posts/post/2020-02-13-1/okta_add_applications.png" class="lazyload"></a></p> </li> <li> <p>Jamf Proのアプリケーションを検索します。</p> <p><a href="/assets/posts/post/2020-02-13-1/okta_search_jamf_application.png" data-fancybox="images" data-caption="OktaのJamf Proのアプリケーション検索"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OktaのJamf Proのアプリケーション検索" data-src="/assets/posts/post/2020-02-13-1/okta_search_jamf_application.png" class="lazyload"></a></p> </li> <li>追加するJamf Proアプリケーションの構成情報を指定します。 <ul> <li> <strong>Application label</strong>にはJamfのアプリケーションであることがわかるような任意の名前を付けます。</li> <li> <strong>Domain</strong>にはJamf Pro Serverのドメイン名を指定します。 <ul> <li>この値を使用してOktaの内部では、エンティティIDが<code class="language-plaintext highlighter-rouge">https://ドメイン名/saml/metadata</code>、ACS（Assertion Consumer Service）が<code class="language-plaintext highlighter-rouge">https://ドメイン名/saml/SSO</code>として振る舞います。</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/okta_add_jamf_application.png" data-fancybox="images" data-caption="OktaのJamf Proのアプリケーションの追加"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OktaのJamf Proのアプリケーションの追加" data-src="/assets/posts/post/2020-02-13-1/okta_add_jamf_application.png" class="lazyload"></a></p> </li> <li> <p>Jamfアプリケーションにアクセスを許可するユーザーをアサインします。</p> <p><a href="/assets/posts/post/2020-02-13-1/okta_assign_user_to_jamf_application.png" data-fancybox="images" data-caption="OktaのJamf Proアプリケーションにユーザーをアサイン"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OktaのJamf Proアプリケーションにユーザーをアサイン" data-src="/assets/posts/post/2020-02-13-1/okta_assign_user_to_jamf_application.png" class="lazyload"></a></p> </li> <li>「Sign On」タブに遷移して、<strong>Identity Provider metadata</strong>のURLをメモしておきます。 <ul> <li>のちほどこのURLをJamf Pro Server側に設定します。</li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/okta_sign_on_of_jamf_application.png" data-fancybox="images" data-caption="OktaのJamf ProアプリケーションのSign On設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OktaのJamf ProアプリケーションのSign On設定" data-src="/assets/posts/post/2020-02-13-1/okta_sign_on_of_jamf_application.png" class="lazyload"></a></p> </li> <li>Jamf Pro Serverへのログインを許可するユーザーおよびグループをアサインします。 <ul> <li>ここで指定されたNameIDの値を使用して、Jamf Pro Server側のどのユーザー名とマッピングするかが決まります。 <ul> <li> <strong>User Profile Mappings</strong>を使用することで渡す値をカスタマイズできます。</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/okta_assign_user_to_jamf_application.png" data-fancybox="images" data-caption="OktaのJamf Proアプリケーションのアサイン"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="OktaのJamf Proアプリケーションのアサイン" data-src="/assets/posts/post/2020-02-13-1/okta_assign_user_to_jamf_application.png" class="lazyload"></a></p> </li> <li> <p>次に、セキュリティの認証ページに遷移します。</p> <p><a href="/assets/posts/post/2020-02-13-1/okta_security_authentication.png" data-fancybox="images" data-caption="Oktaのセキュリティの認証ページへの遷移"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Oktaのセキュリティの認証ページへの遷移" data-src="/assets/posts/post/2020-02-13-1/okta_security_authentication.png" class="lazyload"></a></p> </li> <li>「Sign On」タブに遷移して、Jamf Pro Serverにログイン可能なポリシーが一つまたは複数あり、すべての「Session Lifetime」の時間が同一の場合、その時間をメモします。 <ul> <li>のちほど、この時間をJamf Pro Server側に設定します。</li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/okta_authentication_sign_on.png" data-fancybox="images" data-caption="Oktaの認証のSing On設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Oktaの認証のSing On設定" data-src="/assets/posts/post/2020-02-13-1/okta_authentication_sign_on.png" class="lazyload"></a></p> </li> </ol> <h4 id="oktaをidpとするssoの設定---jamf-pro-server側">OktaをIdPとするSSOの設定 - Jamf Pro Server側</h4> <ol> <li>Jamf Pro Serverにログインします。</li> <li> <p>左上の歯車から設定ページに遷移し、シングルサインオン設定ページに遷移します。</p> <p><a href="/assets/posts/post/2020-02-13-1/jamf_settings.png" data-fancybox="images" data-caption="Jamf Pro Serverの設定ページ"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf Pro Serverの設定ページ" data-src="/assets/posts/post/2020-02-13-1/jamf_settings.png" class="lazyload"></a></p> </li> <li>「Single Sign-On 認証を有効化」にチェックを付けます。</li> <li>各種値を設定し、保存します。 <ul> <li> <strong>アイデンティティプロバイダ</strong>のセクション <ul> <li> <strong>アイデンティティプロバイダ</strong>には「Okta」を指定します。</li> <li> <strong>エンティティID</strong>には「<code class="language-plaintext highlighter-rouge">https://サブドメイン名.jamfcloud.com/saml/metadata</code>」を指定します。</li> <li> <strong>アイデンティティプロバイダのメタデータソース</strong>には「メタデータ URL」を指定し、Okta側の設定で取得した「Identity Provider metadata」のURLを指定します。 <ul> <li>「メタデータファイル」と「メタデータ URL」はどちらを選択しても構いませんが、視認性や設定の容易さから「メタデータ URL」を選択しました。</li> </ul> </li> <li> <strong>トークン有効期限（分）</strong>にはOkta側の設定で取得した「Session Lifetime」を分単位に変換した値を指定します。 <ul> <li>Okta側の認証のサインインポリシーが複数あり、「Session Lifetime」が異なる場合は、<strong>SAML トークンの有効期限を無効化</strong>にチェックを入れることを推奨します。</li> </ul> </li> </ul> </li> <li> <strong>セキュリティ</strong>のセクション <ul> <li> <strong>アイデンティティプロバイダのユーザマッピング</strong>には「NameID」を指定します。</li> <li> <strong>JAMF PROのユーザマッピング</strong>には「ユーザ名」を指定します。</li> <li> <strong>アイデンティティプロバイダグループ属性名</strong>には何も指定しません。 <ul> <li> <code class="language-plaintext highlighter-rouge">http://schemas.xmlsoap.org/claims/Group</code>を指定し、Okta側で該当の設定するとアサーションにグループを追加できるらしいですが、試したところ特に追加されているようには見受けられずこの機能が使用できることを確認できませんでした。</li> </ul> </li> <li> <strong>LDAP グループ用の RDN キー</strong>には何も設定しません。</li> </ul> </li> <li> <strong>Jamf Pro の Single Sign-On オプション</strong>のセクション <ul> <li> <strong>JAMF PRO 署名証明書</strong>には「証明書なし」を指定します。</li> </ul> </li> <li> <strong>Jamf Pro のSingle Sign-On オプション</strong>のセクション <ul> <li> <strong>Single Sign-On 認証のバイパスをユーザに許可します</strong>は特段理由がない限りはチェックを外します。</li> <li> <strong>macOS 用 Self Service の Single Sign-On を有効化</strong>は特段理由がない限りはチェックを外します。 <ul> <li>Self Serviceがインストールされているということはその端末は（完全ではないですが）信頼できると考えられるため、わざわざ認証を付ける必要がないと考えています。</li> </ul> </li> <li> <strong>User-Initiated Enrollment の Single Sign-On を有効化</strong>は運用に合わせてチェックを付けます。 <ul> <li>今回は例であるため、チェックを外しています。</li> </ul> </li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/jamf_okta_single_sign_on.png" data-fancybox="images" data-caption="Jamf Pro ServerのSingle Sing-On設定 Oktaの内容"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf Pro ServerのSingle Sing-On設定 Oktaの内容" data-src="/assets/posts/post/2020-02-13-1/jamf_okta_single_sign_on.png" class="lazyload"></a></p> </li> </ol> <h3 id="azure-active-directoryをidpとするssoの設定">Azure Active DirectoryをIdPとするSSOの設定</h3> <p>次に、Azure Active DirectoryをIdPとしてJamf Pro Serverと統合する方法を紹介します。 <a href="https://docs.jamf.com/ja/10.19.0/jamf-pro/release-notes/%E6%96%B0%E6%A9%9F%E8%83%BD.html" target="_blank" rel="noopener noreferrer">10.19.0から公式にサポート</a>されましたが、それ以前のバーションでもSSOは可能です。</p> <h4 id="azure-active-directoryをidpとするssoの設定---azure-active-directory側">Azure Active DirectoryをIdPとするSSOの設定 - Azure Active Directory側</h4> <ol> <li>Microsoft Azure Potalにログインします。</li> <li> <p>エンタープライズアプリケーションのページに遷移し、新しいアプリケーションを追加するページに遷移します。</p> <p><a href="/assets/posts/post/2020-02-13-1/azure_ad_add_enterprise_application.png" data-fancybox="images" data-caption="Azure ADのエンタープライズアプリケーションの追加"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ADのエンタープライズアプリケーションの追加" data-src="/assets/posts/post/2020-02-13-1/azure_ad_add_enterprise_application.png" class="lazyload"></a></p> </li> <li> <p>Jamf Proアプリケーションを検索し、アプリケーションを作成します。</p> <p><a href="/assets/posts/post/2020-02-13-1/azure_ad_create_jamf_application.png" data-fancybox="images" data-caption="Azure ADのJamf Proアプリケーションの作成"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ADのJamf Proアプリケーションの作成" data-src="/assets/posts/post/2020-02-13-1/azure_ad_create_jamf_application.png" class="lazyload"></a></p> </li> <li> <p>シングルサインオン方式として「SAML」を選択します。</p> <p><a href="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_single_sign_on_mode.png" data-fancybox="images" data-caption="Azure ADのJamf Proアプリケーションのシングルサインオンモード選択"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ADのJamf Proアプリケーションのシングルサインオンモード選択" data-src="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_single_sign_on_mode.png" class="lazyload"></a></p> </li> <li> <p>シングルサインオンの設定に遷移して、「基本的なSAML構成」の編集ページに遷移します。</p> <p><a href="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_saml_single_sign_on.png" data-fancybox="images" data-caption="Azure ADのJamf Proアプリケーションのシングルサインオン画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ADのJamf Proアプリケーションのシングルサインオン画面" data-src="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_saml_single_sign_on.png" class="lazyload"></a></p> </li> <li>追加するJamf Proアプリケーションの構成情報を指定します。 <ul> <li> <strong>識別子（エンティティID）</strong>には「<code class="language-plaintext highlighter-rouge">https://サブドメイン名.jamfcloud.com/saml/metadata</code>」を指定します。</li> <li> <strong>応答URL（Assertion Consumer Service URL）</strong>には「<code class="language-plaintext highlighter-rouge">https://サブドメイン名.jamfcloud.com/saml/SSO</code>」を指定します。</li> <li> <strong>サインオンURL</strong>には「<code class="language-plaintext highlighter-rouge">https://サブドメイン名.jamfcloud.com</code>」を指定します。</li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_saml_single_sign_on_base_configuration.png" data-fancybox="images" data-caption="Azure ADのJamf Proアプリケーションのシングルサインオンの基本的なSAML構成画面"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ADのJamf Proアプリケーションのシングルサインオンの基本的なSAML構成画面" data-src="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_saml_single_sign_on_base_configuration.png" class="lazyload"></a></p> </li> <li>デフォルトで<code class="language-plaintext highlighter-rouge">NameID</code>に<strong>User Principal Name</strong>が使われているため、必要な場合は使用する属性を変更します。 <ul> <li>ここで指定された属性の値を使用して、Jamf Pro Server側のどのユーザー名とマッピングするかが決まります。</li> </ul> </li> <li>「SAML署名証明書」の項目から<strong>アプリのフェデレーションメタデータURL</strong>をメモしておきます。 <ul> <li>のちほど、このURLをJamf Pro Server側に設定します。</li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_saml_single_sign_on_metadata.png" data-fancybox="images" data-caption="Azure ADのJamf ProアプリケーションのシングルサインオンのアプリのフェデレーションメタデータURL取得"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ADのJamf ProアプリケーションのシングルサインオンのアプリのフェデレーションメタデータURL取得" data-src="/assets/posts/post/2020-02-13-1/azure_ad_jamf_application_settings_saml_single_sign_on_metadata.png" class="lazyload"></a></p> </li> <li> <p>Jamf Pro Serverへのログインを許可するユーザーおよびグループをアサインします。</p> <p><a href="/assets/posts/post/2020-02-13-1/azure_ad_assign_user_to_jamf_application.png" data-fancybox="images" data-caption="Azure ADのJamf Proアプリケーションへのユーザーアサイン"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Azure ADのJamf Proアプリケーションへのユーザーアサイン" data-src="/assets/posts/post/2020-02-13-1/azure_ad_assign_user_to_jamf_application.png" class="lazyload"></a></p> </li> </ol> <h4 id="azure-active-directoryをidpとするssoの設定---jamf-pro-server側">Azure Active DirectoryをIdPとするSSOの設定 - Jamf Pro Server側</h4> <ol> <li>Jamf Pro Serverにログインします。</li> <li> <p>左上の歯車から設定ページに遷移し、シングルサインオン設定ページに遷移します。</p> <p><a href="/assets/posts/post/2020-02-13-1/jamf_settings.png" data-fancybox="images" data-caption="Jamf Pro Serverの設定ページ"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf Pro Serverの設定ページ" data-src="/assets/posts/post/2020-02-13-1/jamf_settings.png" class="lazyload"></a></p> </li> <li>「Single Sign-On 認証を有効化」にチェックを付けます。</li> <li>各種値を設定し、保存します。 <ul> <li> <strong>アイデンティティプロバイダ</strong>のセクション <ul> <li> <strong>アイデンティティプロバイダ</strong>には「Azure」を指定します。</li> <li> <strong>エンティティID</strong>には「<code class="language-plaintext highlighter-rouge">https://サブドメイン名.jamfcloud.com/saml/metadata</code>」を指定します。</li> <li> <strong>アイデンティティプロバイダのメタデータソース</strong>には「メタデータ URL」を指定し、Azure AD側の設定で取得した「アプリのフェデレーションメタデータ」のURLを指定します。</li> <li> <strong>トークン有効期限（分）</strong>にはなにも指定せずに<strong>SAML トークンの有効期限を無効化</strong>にチェックを入れます。 <ul> <li>Azure ADを使用するとセッションの関係でいくつかのエラーが発生する可能性があるため、有効期限を無効化しています。</li> </ul> </li> </ul> </li> <li> <strong>セキュリティ</strong>のセクション <ul> <li> <strong>アイデンティティプロバイダのユーザマッピング</strong>には「NameID」を指定します。</li> <li> <strong>JAMF PROのユーザマッピング</strong>には「ユーザ名」を指定します。 <ul> <li> <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/jamfprosamlconnector-tutorial" target="_blank" rel="noopener noreferrer">公式ドキュメント</a>には、<strong>Eメール</strong>を指定するように記載されていますが、Jamf Pro側でEmailは一意な属性ではないため、<strong>ユーザ名</strong>を指定することをお勧めします。</li> </ul> </li> <li> <strong>アイデンティティプロバイダグループ属性名</strong>には何も指定しません。 <ul> <li> <code class="language-plaintext highlighter-rouge">http://schemas.microsoft.com/ws/2008/06/identity/claims/groups</code>を指定し、Azure AD側で設定するとアサーションにグループを追加できるらしいですが、試したところ特に追加されているようには見受けられずこの機能が使用できることを確認できませんでした。</li> </ul> </li> <li> <strong>LDAP グループ用の RDN キー</strong>には何も設定しません。</li> </ul> </li> <li> <strong>Jamf Pro の Single Sign-On オプション</strong>のセクション <ul> <li> <strong>JAMF PRO 署名証明書</strong>には「証明書なし」を指定します。</li> </ul> </li> <li> <strong>Jamf Pro のSingle Sign-On オプション</strong>のセクション <ul> <li> <strong>Single Sign-On 認証のバイパスをユーザに許可します</strong>は特段理由がない限りはチェックを外します。</li> <li> <strong>macOS 用 Self Service の Single Sign-On を有効化</strong>は特段理由がない限りはチェックを外します。 <ul> <li>Self Serviceがインストールされているということはその端末は（完全ではないですが）信頼できると考えられるため、わざわざ認証を付ける必要がないと考えています。</li> </ul> </li> <li> <strong>User-Initiated Enrollment の Single Sign-On を有効化</strong>は運用に合わせてチェックを付けます。 <ul> <li>今回は例であるため、チェックを外しています。</li> </ul> </li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-02-13-1/jamf_azure_ad_single_sign_on.png" data-fancybox="images" data-caption="Jamf Pro ServerのSingle Sing-On設定 Azure ADの内容"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Jamf Pro ServerのSingle Sing-On設定 Azure ADの内容" data-src="/assets/posts/post/2020-02-13-1/jamf_azure_ad_single_sign_on.png" class="lazyload"></a></p> </li> </ol> <h2 id="jamf-pro-serverのユーザー作成について">Jamf Pro Serverのユーザー作成について</h2> <p>Jamf Pro Serverはユーザーおよびグループのプロビジョニングをサポートしていません。 そのため、新しいユーザーを追加したい場合はLDAPと統合してユーザー情報を取得するか、マニュアルで作成する必要があります。</p> <p>上記で設定した<strong>アイデンティティプロバイダのユーザマッピング</strong>および<strong>JAMF PROのユーザマッピング</strong>の設定を元に、Jamf Pro Serverのユーザーを統合または作成してください。</p> <h3 id="ldapとの統合についての個人的な見解">LDAPとの統合についての個人的な見解</h3> <p>少々話がそれますが、LDAPについて個人的な見解を述べます。</p> <p>LDAPを使用してのユーザーアカウントとグループの統合は、個人的にはお勧めしません。 なぜなら、以下のような理由です。</p> <ul> <li>LDAPをそもそも外部公開することは少ない <ul> <li>外部公開したときの攻撃に対する防御または検知がたいへん</li> </ul> </li> <li>LDAPの運用はかなり運用コストがかかる</li> <li>SAMLやOIDCに置き換わる流れがきている</li> </ul> <p>このためだけではなく、macOSのバインドなどにも使ったりするのでLDAPあるので、それなら使っても良いという意見もあるかもしれません。 しかし、macOSではLDAPに不安を抱えている関係もあり<sup id="fnref:macos-in-to-the-azuread"><a href="#fn:macos-in-to-the-azuread" class="footnote" rel="footnote" role="doc-noteref">1</a></sup>、macOSの認証に関しては<a href="https://www.jamf.com/ja/products" target="_blank" rel="noopener noreferrer">Jamf Connect</a>など、LDAPがそもそも必要ない流れがきており、IdPサービスと連携する方に投資したほうが良いと考えています。</p> <p>また、誰がどの端末をつかっているのか、個別にポリシーを当てたいなどの用途で使いたいたので、LDAPでユーザー一覧がないと面倒であるという意見もあるかもしれません。 この部分に関しては、誰がどの端末を使っているかはMicrosoft Intuneとの統合でカバーできます。 個別のポリシーに関しては、結局は個別の端末ベースの話になることがほとんどであるため、スマートコンピュータグループなどを使って適用する方法をお勧めしています。</p> <p>本当であればJamf Pro Server側にSCIM（System for Cross-Domains Identity Management）があればよいのですが、まだ実装されていません。 <a href="https://ideas.jamf.com/ideas/JN-I-15788" target="_blank" rel="noopener noreferrer">Feature Request</a>が出ているので、ぜひVoteしてみてください。</p> <h2 id="jmaf-pro-serverのsso設定後のお勧め作業">Jmaf Pro ServerのSSO設定後のお勧め作業</h2> <p>SSO設定完了後は、現在存在しているすべてのユーザーのパスワードを強固なものに変更しておくことをお勧めします。</p> <p>管理者に関しては、<code class="language-plaintext highlighter-rouge">https://サブドメイン名.jamfcloud.com/?failover</code>を使用することでログインが可能です。 SSO設定やIdPに何かあったときにログインできる口があることは重要ですが、強度が弱いパスワードを設定していると、ここから突破されてしまいます。</p> <p>また、管理者以外でもユーザー名とパスワードを使用することでAPI呼び出しが可能です。</p> <p>そのため、以下のような設定および作業をお勧めします。</p> <ul> <li>管理者ユーザー、APIユーザー <ul> <li>パスワードジェネレータなどで作成した強固なパスワードを設定</li> <li>対象パスワードをパスワードマネージャーなどで管理</li> </ul> </li> <li>その他ユーザー <ul> <li>パスワードジェネレータなどで作成した強固なパスワードを設定</li> <li>対象パスワードは管理せず対象ユーザーにも伝えない</li> </ul> </li> </ul> <h2 id="終わりに">終わりに</h2> <p>今回は、OktaとAzure Active DirectoryをIdPとして、Jamf Pro ServerとSSOで統合する方法を解説しました。</p> <p>次回はApple Business ManagerおよびApple School Managerとの統合について紹介しようと思います。</p> <p>この記事の作成には、OktaとAzure Active Directory、Jamf Pro Serverはすべて無料ライセンスおよび開発者ライセンスを使用させていただきました。</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:macos-in-to-the-azuread"> <p><a href="https://blog.animereview.jp/macos_in_to_the_azuread/" target="_blank" rel="noopener noreferrer">macOSとAzureADでMacのユーザーアカウントを掌握 - ロードバランスすだちくん</a> <a href="#fnref:macos-in-to-the-azuread" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </article> <section class="share"> <a href="//twitter.com/share?text=Jamf+Pro+Server%E3%81%ABSSO%E3%82%92%E8%A8%AD%E5%AE%9A&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-02-13-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=Jamf+Pro+Server%E3%81%ABSSO%E3%82%92%E8%A8%AD%E5%AE%9A&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-02-13-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=Jamf+Pro+Server%E3%81%ABSSO%E3%82%92%E8%A8%AD%E5%AE%9A&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-02-13-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2020-02-13-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents related-posts"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">あわせて読みたい</div> <div class="sub-contents-main"> <li> <a href="/post/2024-06-19-1">WWDC 2024で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- June 19, 2024</span> </li> <li> <a href="/post/2022-08-18-1">WWDC 2022で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- August 18, 2022</span> </li> <li> <a href="/post/2020-02-05-1">Jamf Pro Serverの初期設定</a> <span class="post-date">- February 5, 2020</span> </li> <li> <a href="/post/2025-06-19-1">WWDC 2025で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- June 19, 2025</span> </li> <li> <a href="/post/2021-06-24-1">WWDC 2021で発表されたエンタープライズ関連の新機能</a> <span class="post-date">- June 24, 2021</span> </li> </div> </div> </section> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/jamf">Jamf</a> <a href="/tag/jamf-pro">Jamf Pro</a> <a href="/tag/macos">macOS</a> <a href="/tag/ios">iOS</a> <a href="/tag/ipados">iPadOS</a> <a href="/tag/apple">Apple</a> <a href="/tag/mdm">MDM</a> <a href="/tag/sso">SSO</a> <a href="/tag/azure-ad">Azure AD</a> <a href="/tag/okta">Okta</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.6b4bd929e0a1773ddf90.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>