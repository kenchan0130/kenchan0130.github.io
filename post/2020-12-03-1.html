<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>PPPCで付与できないmacOSのプライバシー保護機能にアクセス権を付与する</title> <meta name="description" content="COVID-19の影響により、テレワーク/リモートワーク化が加速し、Web会議サービスを使用することが増えてきました。 エンドユーザーが意図せずにこれらのアクセスを拒否してしまい、目当てのアプリケーションを使用するのに混乱したり、手間どったりすることがあります。組織において管理下にあるデバイスであれば、プロファイルやスクリプトなどで強制的にアクセス権を付与したいと考えますが、システムの制約上、エンドユーザーのみが操作可能です。今回は、Jamf Proを使用してこの制約の中で対応する方法を紹介します。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="COVID-19の影響により、テレワーク/リモートワーク化が加速し、Web会議サービスを使用することが増えてきました。 エンドユーザーが意図せずにこれらのアクセスを拒否してしまい、目当てのアプリケーションを使用するのに混乱したり、手間どったりすることがあります。組織において管理下にあるデバイスであれば、プロファイルやスクリプトなどで強制的にアクセス権を付与したいと考えますが、システムの制約上、エンドユーザーのみが操作可能です。今回は、Jamf Proを使用してこの制約の中で対応する方法を紹介します。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2020-12-03-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="PPPCで付与できないmacOSのプライバシー保護機能にアクセス権を付与する"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="PPPCで付与できないmacOSのプライバシー保護機能にアクセス権を付与する"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="COVID-19の影響により、テレワーク/リモートワーク化が加速し、Web会議サービスを使用することが増えてきました。 エンドユーザーが意図せずにこれらのアクセスを拒否してしまい、目当てのアプリケーションを使用するのに混乱したり、手間どったりすることがあります。組織において管理下にあるデバイスであれば、プロファイルやスクリプトなどで強制的にアクセス権を付与したいと考えますが、システムの制約上、エンドユーザーのみが操作可能です。今回は、Jamf Proを使用してこの制約の中で対応する方法を紹介します。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2020-12-03-1"> <link rel="preload" as="style" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.6b4bd929e0a1773ddf90.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2020-12-03-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2020-12-03-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">PPPCで付与できないmacOSのプライバシー保護機能にアクセス権を付与する</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2020-12-03</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/system-administration">system-administration </a> </div> </section> <article class="post-content"> <p>COVID-19の影響により、テレワーク/リモートワーク化が加速し、Web会議サービスを使用することが増えてきました。 Web会議サービスの場合、往々にしてカメラやマイクを使用することとなります。</p> <p>エンドユーザーが意図せずにこれらのアクセスを拒否してしまい、目当てのアプリケーションを使用するのに混乱したり、手間どったりすることがあります。</p> <p>組織において管理下にあるデバイスであれば、プロファイルやスクリプトなどで強制的にアクセス権を付与したいと考えますが、カメラなど一部の項目に関しては、エンドユーザーのみが操作可能です。</p> <p>今回は、Jamf Proを使用してこの制約の中で対応する方法を紹介します。</p> <p>また、この記事は<a href="https://adventar.org/calendars/5553" target="_blank" rel="noopener noreferrer">FOLIO Advent calendar 2020</a>の3日目の記事でもあります。</p> <ul id="markdown-toc"> <li><a href="#user-consent%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" id="markdown-toc-user-consentについて">User Consentについて</a></li> <li><a href="#pppc-privacy-preferences-policy-control%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" id="markdown-toc-pppc-privacy-preferences-policy-controlについて">PPPC (Privacy Preferences Policy Control)について</a></li> <li> <a href="#pppc%E3%81%A7%E8%A8%B1%E5%8F%AF%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84user-consent%E3%81%AE%E9%A0%85%E7%9B%AE%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B" id="markdown-toc-pppcで許可できないuser-consentの項目を許可してみる">PPPCで許可できないUser Consentの項目を許可してみる</a> <ul> <li><a href="#%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97" id="markdown-toc-スクリプトの取得">スクリプトの取得</a></li> <li><a href="#jamf-pro%E3%81%ABtcc-permitter%E3%82%92%E8%A8%AD%E5%AE%9A" id="markdown-toc-jamf-proにtcc-permitterを設定">Jamf ProにTCC-Permitterを設定</a></li> <li><a href="#tcc-permitter%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97%E6%96%B9%E6%B3%95" id="markdown-toc-tcc-permitterで使用するパラメータの取得方法">TCC-Permitterで使用するパラメータの取得方法</a></li> <li><a href="#%E6%B3%A8%E6%84%8F%E7%82%B9" id="markdown-toc-注意点">注意点</a></li> </ul> </li> <li><a href="#%E3%81%BE%E3%81%A8%E3%82%81" id="markdown-toc-まとめ">まとめ</a></li> <li><a href="#%E5%AE%A3%E4%BC%9D" id="markdown-toc-宣伝">宣伝</a></li> </ul> <h2 id="user-consentについて">User Consentについて</h2> <p>macOSでは、High Sierra（10.13）からUser Consentと呼ばれるプライバシー保護機能が搭載されました。 アプリケーションがカメラやマイクなどにアクセスする場合は、エンドユーザーの許可が必要です。</p> <p>アプリケーションが初めてUser Consentの対象となる項目にアクセスする際には、ダイアログでエンドユーザーに対してアクセス権の確認がされます。</p> <p><a href="/assets/posts/post/2020-12-03-1/access_to_camera_dialog_with_zoom.png" data-fancybox="images" data-caption="カメラへのアクセス確認ダイアログ Zoomアプリケーションでの例"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="カメラへのアクセス確認ダイアログ Zoomアプリケーションでの例" data-src="/assets/posts/post/2020-12-03-1/access_to_camera_dialog_with_zoom.png" class="lazyload"></a> <a href="/assets/posts/post/2020-12-03-1/access_to_microphone_dialog_with_zoom.png" data-fancybox="images" data-caption="マイクへのアクセス確認ダイアログ Zoomアプリケーションでの例"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="マイクへのアクセス確認ダイアログ Zoomアプリケーションでの例" data-src="/assets/posts/post/2020-12-03-1/access_to_microphone_dialog_with_zoom.png" class="lazyload"></a></p> <p>以降は、 [システム環境設定] &gt; [セキュリティとプライバシー] &gt; [プライバシー] からであれば個別にアクセス権を変更できます。</p> <h2 id="pppc-privacy-preferences-policy-controlについて">PPPC (Privacy Preferences Policy Control)について</h2> <p>PPPCは、デバイスのUser ConsentをMDMのポリシーで制御するためのしくみです。 これにより、指定したアプリケーションの対するUser Consentを制御できますが、以下の表に示すとおり、一部許可ができない項目が存在します。</p> <table> <thead> <tr> <th>項目</th> <th>制御</th> <th>役割</th> </tr> </thead> <tbody> <tr> <td>Accessibility</td> <td>許可 / 拒否</td> <td>アクセシビリティ（たとえば、マウス操作）に関するシステムの制御</td> </tr> <tr> <td>AddressBook</td> <td>許可 / 拒否</td> <td>連絡先アプリケーションで管理されている連絡先情報へのアクセス</td> </tr> <tr> <td>Admin Files</td> <td>許可 / 拒否</td> <td>管理者用の一部のファイルへのアクセス</td> </tr> <tr> <td>All Files</td> <td>許可 / 拒否</td> <td>すべてのユーザーのメール、メッセージ、Safari、ホーム、Time Machineバックアップ、および特定の管理設定などのデータへのアクセス</td> </tr> <tr> <td>Calendar</td> <td>許可 / 拒否</td> <td>カレンダーアプリケーションで管理されているイベント情報へのアクセス</td> </tr> <tr> <td>Camera</td> <td>拒否</td> <td>カメラへのアクセス</td> </tr> <tr> <td>Desktop Folder</td> <td>許可 / 拒否</td> <td>「デスクトップ」フォルダ（<code class="language-plaintext highlighter-rouge">/Users/username/Desktop</code>）へのアクセス</td> </tr> <tr> <td>Document Folder</td> <td>許可 / 拒否</td> <td>「書類」フォルダ（<code class="language-plaintext highlighter-rouge">/Users/username/Documents</code>）へのアクセス</td> </tr> <tr> <td>Download Folder</td> <td>許可 / 拒否</td> <td>「ダウンロード」フォルダ（<code class="language-plaintext highlighter-rouge">/Users/username/Downloads</code>）へのアクセス</td> </tr> <tr> <td>File Provider Presence</td> <td>許可 / 拒否</td> <td>ファイルプロバイダで管理されているファイルをユーザーが使用している状況の取得</td> </tr> <tr> <td>Listen Event</td> <td>システム環境設定で許可<sup id="fnref:allow-standard-user-to-set-system-service"><a href="#fn:allow-standard-user-to-set-system-service" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> / 拒否</td> <td>アプリケーションがCoreGraphicsおよびHIDAPIを使用して、すべてのプロセスからのCGEventおよびHIDイベントのリッスン（受信）</td> </tr> <tr> <td>Media Library</td> <td>許可 / 拒否</td> <td>Apple Music、ミュージックとビデオのアクティビティ、およびメディアライブラリへのアクセス</td> </tr> <tr> <td>Microphone</td> <td>拒否</td> <td>マイクへのアクセス</td> </tr> <tr> <td>Network Volumes</td> <td>許可 / 拒否</td> <td>SMBなど、ネットワークボリューム上のファイルへのアクセス</td> </tr> <tr> <td>Photos</td> <td>許可 / 拒否</td> <td>写真アプリケーションで管理されている画像（<code class="language-plaintext highlighter-rouge">/Users/username/Pictures/Photos Library.photoslibrary</code>）へのアクセス</td> </tr> <tr> <td>Post Events</td> <td>許可 / 拒否</td> <td>CoreGraphics APIを使用してCGEventsをシステムイベントストリームに送信</td> </tr> <tr> <td>Reminders</td> <td>許可 / 拒否</td> <td>リマインダーアプリケーションで管理されているリマインダー情報へのアクセス</td> </tr> <tr> <td>Removable Volumes</td> <td>許可 / 拒否</td> <td>リムーバブルボリュームへのアクセス</td> </tr> <tr> <td>Screen Capture</td> <td>システム環境設定で許可<sup id="fnref:allow-standard-user-to-set-system-service:1"><a href="#fn:allow-standard-user-to-set-system-service" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> / 拒否</td> <td>画面キャプチャの許可</td> </tr> <tr> <td>Speech Recognition</td> <td>許可 / 拒否</td> <td>音声認識機能を介した音声データのAppleへの送信</td> </tr> </tbody> </table> <p>ポリシーが矛盾する場合は、より厳しいほうが優先されるようになっています。 また、この機能は、Mojave（10.14）から追加された機能であるため、それ以前のバーションでは使用できません。</p> <h2 id="pppcで許可できないuser-consentの項目を許可してみる">PPPCで許可できないUser Consentの項目を許可してみる</h2> <p>今回はZoomアプリケーションを例に、PPPCつまり、MDMの機能では許可できないUser Consentの項目を、Jamf Proを使用して許可する方法を紹介します。</p> <p>ZoomアプリケーションはPPPCでは許可できない、カメラ、マイクおよび画面キャプチャへのアクセス権を要求するため、これらを強制的に許可するようにしてみます。</p> <h3 id="スクリプトの取得">スクリプトの取得</h3> <p>今回は<a href="https://github.com/kenchan0130/TCC-Permitter" target="_blank" rel="noopener noreferrer">TCC-Permitter</a>を使用します。 このスクリプトは、許可したいBundle IDまたはバイナリパスとTCCサービス名を指定すると、拒否されているUser Consentの項目を許可できます。</p> <p>デフォルトが<code class="language-plaintext highlighter-rouge">dev</code>ブランチ、つまり開発中のブランチであるため、安定版が必要な場合は<a href="https://github.com/kenchan0130/TCC-Permitter/releases" target="_blank" rel="noopener noreferrer">リリース一覧</a>より、任意のリリースバーションのソースコードから<code class="language-plaintext highlighter-rouge">TCC-Permitter.sh</code>を取得してください。</p> <h3 id="jamf-proにtcc-permitterを設定">Jamf ProにTCC-Permitterを設定</h3> <p>ここからはJamf Proにログインをして作業します。</p> <h4 id="スクリプトの登録">スクリプトの登録</h4> <ol> <li> <p>[設定] &gt; [コンピュータの管理] &gt; [スクリプト]から新規作成に進みます。</p> <ul> <li>カテゴリの設定は必須ではありませんが、このスクリプトを分類するのに使用できます。以下の画像では例として<strong>Security</strong>を指定しています。</li> </ul> <p><a href="/assets/posts/post/2020-12-03-1/create_script_general_ttc_permitter.png" data-fancybox="images" data-caption="TCC-Permitterの新規スクリプト作成の一般セクションの設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="TCC-Permitterの新規スクリプト作成の一般セクションの設定" data-src="/assets/posts/post/2020-12-03-1/create_script_general_ttc_permitter.png" class="lazyload"></a></p> </li> <li> <p>次に、ScriptセクションにGitHubからコピーしてきた<code class="language-plaintext highlighter-rouge">TCC-Permitter.sh</code>を貼り付けます。</p> <p><a href="/assets/posts/post/2020-12-03-1/create_script_script_ttc_permitter.png" data-fancybox="images" data-caption="TCC-Permitterの新規スクリプト作成のスクリプトセクションの設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="TCC-Permitterの新規スクリプト作成のスクリプトセクションの設定" data-src="/assets/posts/post/2020-12-03-1/create_script_script_ttc_permitter.png" class="lazyload"></a></p> </li> <li> <p>Optionsセクションの<strong>パラメータ4</strong>にバンドルIDまたはバイナリパス、<strong>パラメータ5</strong>にTTCのサービス名を指定することがわかるような名前を入力してください。</p> <ul> <li>これは設定しなくても動作しますが、ポリシー側で使用する際にわかりやすくなるので設定しています。</li> <li>以下の画像では例として<strong>Bundle ID or Binary Path</strong>、<strong>TTC Service Name</strong>という名前を設定しています。</li> </ul> <p><a href="/assets/posts/post/2020-12-03-1/create_script_options_ttc_permitter.png" data-fancybox="images" data-caption="TCC-Permitterの新規スクリプト作成のオプションセクションの設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="TCC-Permitterの新規スクリプト作成のオプションセクションの設定" data-src="/assets/posts/post/2020-12-03-1/create_script_options_ttc_permitter.png" class="lazyload"></a></p> </li> <li> <p>[保存]してスクリプトの登録は完了です。</p> </li> </ol> <h4 id="拡張属性の登録">拡張属性の登録</h4> <ol> <li>[設定] &gt; [コンピュータの管理 - 管理用フレームワーク] &gt; [拡張属性]から新規作成に進みます。</li> <li>各値を設定します。 <ul> <li> <strong>表示名</strong>: <code class="language-plaintext highlighter-rouge">Zoom disabled TCC service values</code> </li> <li> <strong>データタイプ</strong>: <code class="language-plaintext highlighter-rouge">String</code> </li> <li> <strong>インベントリの表示</strong>: <code class="language-plaintext highlighter-rouge">Extension Attributes</code> <ul> <li>コンピュータのインベントリ情報のどのセクションで表示するかの設定であるため、任意のものを指定してかまいません。</li> </ul> </li> <li> <strong>入力タイプ</strong>: <code class="language-plaintext highlighter-rouge">Script</code> <ul> <li> <p>スクリプト入力欄に以下のスクリプトの<code class="language-plaintext highlighter-rouge">BUNDLE_ID_OR_BINARY_PATH</code>を<strong>us.zoom.xos</strong>に変更して貼り付けます。</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/zsh</span>

<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/usr/bin:/bin:/usr/sbin:/sbin

<span class="nv">CURRENT_USER</span><span class="o">=</span><span class="si">$(</span><span class="nb">stat</span> <span class="nt">-f</span>%Su /dev/console<span class="si">)</span>
<span class="nv">BUNDLE_ID_OR_BINARY_PATH</span><span class="o">=</span><span class="s2">"!!SET BUNDLE ID OR BINARY PATH YOU WANT!!"</span>

<span class="k">if</span> <span class="o">[[</span> <span class="o">!</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CURRENT_USER</span><span class="k">}</span><span class="s2">"</span> <span class="o">]]</span> <span class="o">||</span> <span class="o">[[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">CURRENT_USER</span><span class="k">}</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"root"</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
  </span><span class="nb">exit </span>0
<span class="k">fi

</span><span class="nv">CURRENT_USER_HOME_DIRECTORY</span><span class="o">=</span><span class="si">$(</span>dscl /Local/Default <span class="nb">read</span> <span class="s2">"/Users/</span><span class="k">${</span><span class="nv">CURRENT_USER</span><span class="k">}</span><span class="s2">"</span> NFSHomeDirectory | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="si">)</span>

<span class="nv">DIABLED_VALUES</span><span class="o">=</span><span class="si">$(</span>sqlite3 <span class="s2">"</span><span class="k">${</span><span class="nv">CURRENT_USER_HOME_DIRECTORY</span><span class="k">}</span><span class="s2">/Library/Application Support/com.apple.TCC/TCC.db"</span> <span class="s2">"SELECT service FROM access WHERE client = '</span><span class="k">${</span><span class="nv">BUNDLE_ID_OR_BINARY_PATH</span><span class="k">}</span><span class="s2">' AND allowed = '0'"</span><span class="si">)</span>

<span class="nb">echo</span> <span class="s2">"&lt;result&gt;</span><span class="k">${</span><span class="nv">DIABLED_VALUES</span><span class="k">}</span><span class="s2">&lt;/result&gt;"</span>
</code></pre></div> </div> </li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-12-03-1/create_extension_attributes_with_zoom.png" data-fancybox="images" data-caption="Zoomの拒否となっているTCC Service名を取得する拡張属性の作成"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Zoomの拒否となっているTCC Service名を取得する拡張属性の作成" data-src="/assets/posts/post/2020-12-03-1/create_extension_attributes_with_zoom.png" class="lazyload"></a></p> </li> <li>[保存]して拡張属性の登録は完了です。</li> </ol> <h4 id="スマートコンピュータグループの設定">スマートコンピュータグループの設定</h4> <ol> <li>[コンピュータ] &gt; [Smart Computer Groups]から新規作成に進みます。</li> <li>コンピュータグループセクションの表示名に認識しやすい名前を設定します。 <ul> <li>以下の画像では例として<strong>Zoom Camera or Microphone or ScreenCapture</strong>を指定しています。</li> </ul> <p><a href="/assets/posts/post/2020-12-03-1/create_smart_computer_groups_computer_group_with_zoom.png" data-fancybox="images" data-caption="Zoomのカメラ、マイクおよび画面キャプチャが拒否されているスマートコンピュータグループの作成"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Zoomのカメラ、マイクおよび画面キャプチャが拒否されているスマートコンピュータグループの作成" data-src="/assets/posts/post/2020-12-03-1/create_smart_computer_groups_computer_group_with_zoom.png" class="lazyload"></a></p> </li> <li>Criteriaセクションに先程作成した拡張属性「<strong>Zoom disabled TCC service values</strong>」の値の条件を指定します。 <ul> <li>カメラ、マイクおよび画面キャプチャのいずれかが拒否されているスマートコンピュータグループを作成するので、以下の画像のようにそれぞれを<strong>or</strong>条件でつなぎます。</li> </ul> <p><a href="/assets/posts/post/2020-12-03-1/create_smart_computer_groups_criteria_with_zoom.png" data-fancybox="images" data-caption="Zoomのカメラ、マイクおよび画面キャプチャが拒否されているスマートコンピュータグループのCriteriaの設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Zoomのカメラ、マイクおよび画面キャプチャが拒否されているスマートコンピュータグループのCriteriaの設定" data-src="/assets/posts/post/2020-12-03-1/create_smart_computer_groups_criteria_with_zoom.png" class="lazyload"></a></p> </li> <li>[保存]してスマートコンピュータグループの設定は完了です。</li> </ol> <h4 id="ポリシーの設定">ポリシーの設定</h4> <ol> <li>[コンピュータ] &gt; [ポリシー]から新規作成に進みます。</li> <li>Generalセクションで各値を設定します。 <ul> <li> <strong>表示名</strong>: <code class="language-plaintext highlighter-rouge">Allow Camera or Microphone or ScreenCapture to Zoom</code> </li> <li> <strong>カテゴリ</strong>: <code class="language-plaintext highlighter-rouge">Security</code> <ul> <li>カテゴリの設定は任意です。</li> </ul> </li> <li> <strong>トリガー</strong>: <code class="language-plaintext highlighter-rouge">Recurring Check-in</code> </li> <li> <strong>実行頻度</strong>: <code class="language-plaintext highlighter-rouge">Ongoing</code> <ul> <li>ScopeにSmart Computer Groupを使用するため、Ongoingで問題ないです。</li> </ul> </li> </ul> <p><a href="/assets/posts/post/2020-12-03-1/create_policy_to_allow_access_for_zoom_optipons_general_using_ttc_permitter.png" data-fancybox="images" data-caption="Installomatorを使用したZoomポリシーのオプションセクションのGeneral設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Installomatorを使用したZoomポリシーのオプションセクションのGeneral設定" data-src="/assets/posts/post/2020-12-03-1/create_policy_to_allow_access_for_zoom_optipons_general_using_ttc_permitter.png" class="lazyload"></a></p> </li> <li>次に、スクリプトの項目を選択し、登録したTCC-Permitterのスクリプトを追加します。</li> <li>パラメータ4とパラメータ5に値を設定します。 <ul> <li> <strong>パラメータ4</strong>: <code class="language-plaintext highlighter-rouge">us.zoom.xos</code> </li> <li> <strong>パラメータ5</strong>: <code class="language-plaintext highlighter-rouge">Camera,Microphone,ScreenCapture</code> </li> </ul> <p><a href="/assets/posts/post/2020-12-03-1/create_policy_to_allow_access_for_zoom_optipons_scripts_using_ttc_permitter.png" data-fancybox="images" data-caption="Installomatorを使用したZoomポリシーのオプションセクションのスクリプト設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Installomatorを使用したZoomポリシーのオプションセクションのスクリプト設定" data-src="/assets/posts/post/2020-12-03-1/create_policy_to_allow_access_for_zoom_optipons_scripts_using_ttc_permitter.png" class="lazyload"></a></p> </li> <li> <p>次に、Scopeセクションからターゲットコンピュータを先程作成したスマートコンピュータグループ「<strong>Zoom Camera or Microphone or ScreenCapture</strong>」を設定します。</p> <p><a href="/assets/posts/post/2020-12-03-1/create_policy_to_allow_access_for_zoom_scope_smart_computer_group_using_ttc_permitter.png" data-fancybox="images" data-caption="Installomatorを使用したZoomポリシーのオプションセクションのスクリプトのパラメータ設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Installomatorを使用したZoomポリシーのオプションセクションのスクリプトのパラメータ設定" data-src="/assets/posts/post/2020-12-03-1/create_policy_to_allow_access_for_zoom_scope_smart_computer_group_using_ttc_permitter.png" class="lazyload"></a></p> </li> <li>[保存]してポリシーの登録は完了です。</li> </ol> <h3 id="tcc-permitterで使用するパラメータの取得方法">TCC-Permitterで使用するパラメータの取得方法</h3> <p>TCC-Permitterスクリプトの「パラメータ4」で使用するパラメータは、Bundle IDまたはバイナリパスを指定する必要があります。 バイナリパスはすぐわかると思いますが、アプリケーションの場合は以下のようなコマンドを実行すると簡単に取得できます。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mdls <span class="nt">-name</span> kMDItemCFBundleIdentifier <span class="nt">-r</span> &lt;アプリケーション名&gt;
<span class="c"># 例えばZoomだったら</span>
<span class="c"># mdls -name kMDItemCFBundleIdentifier -r /Applications/zoom.us.app</span>
</code></pre></div></div> <p>また、もし現在のデバイスの許可の状態を見て判断したい場合は、</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlite3 <span class="nt">-header</span> <span class="nt">-csv</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/Library/Application Support/com.apple.TCC/TCC.db"</span> <span class="s2">"SELECT service, client, allowed FROM access"</span>
</code></pre></div></div> <p>で確認できます。</p> <h3 id="注意点">注意点</h3> <p>一度、エンドユーザーがUser Consentのアクセス権に関するダイアログでアクションを行ってからでないと、このスクリプトは期待どおりには動作しません。 エンドユーザーがアプリケーションを起動しておらず、アクションを何もしていない場合には許可させることはできません。</p> <p>ただ、間違ってエンドユーザーがアクセスを拒否してしまい、対象のアプリケーションが使えないという状況は改善できるため、ほとんど問題にはならないと思います。</p> <h2 id="まとめ">まとめ</h2> <p>今回は<a href="https://github.com/kenchan0130/TCC-Permitter" target="_blank" rel="noopener noreferrer">TCC-Permitter</a>を使用して、Jamf ProでmacOSのプライバシー保護機能のアクセス権を付与する方法を紹介しました。</p> <p>さらに、スマートコンピュータグループを使用してより柔軟にポリシーを適用できるようにしてみました。</p> <h2 id="宣伝">宣伝</h2> <p>現在、<a href="https://corp.folio-sec.com" target="_blank" rel="noopener noreferrer">FOLIO</a> ではコーポレートITの人材を募集しています。 もし興味がありましたら、<a href="https://twitter.com/kenchan0130" target="_blank" rel="noopener noreferrer">@kenchan0130のTwitter</a>までお声がけください。</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:allow-standard-user-to-set-system-service"> <p>[システム環境設定] &gt; [セキュリティとプライバシー] &gt; [プライバシー] から管理者権限がなくても許可および拒否が切り替えられる。Big Sur（11.0）より古いバージョンのデバイスに配布するとエラーになるので注意が必要。 <a href="#fnref:allow-standard-user-to-set-system-service" class="reversefootnote" role="doc-backlink">↩</a> <a href="#fnref:allow-standard-user-to-set-system-service:1" class="reversefootnote" role="doc-backlink">↩<sup>2</sup></a></p> </li> </ol> </div> </article> <section class="share"> <a href="//twitter.com/share?text=PPPC%E3%81%A7%E4%BB%98%E4%B8%8E%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84macOS%E3%81%AE%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E4%BF%9D%E8%AD%B7%E6%A9%9F%E8%83%BD%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%A8%A9%E3%82%92%E4%BB%98%E4%B8%8E%E3%81%99%E3%82%8B&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-12-03-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=PPPC%E3%81%A7%E4%BB%98%E4%B8%8E%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84macOS%E3%81%AE%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E4%BF%9D%E8%AD%B7%E6%A9%9F%E8%83%BD%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%A8%A9%E3%82%92%E4%BB%98%E4%B8%8E%E3%81%99%E3%82%8B&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-12-03-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=PPPC%E3%81%A7%E4%BB%98%E4%B8%8E%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84macOS%E3%81%AE%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E4%BF%9D%E8%AD%B7%E6%A9%9F%E8%83%BD%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E6%A8%A9%E3%82%92%E4%BB%98%E4%B8%8E%E3%81%99%E3%82%8B&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2020-12-03-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2020-12-03-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents related-posts"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">あわせて読みたい</div> <div class="sub-contents-main"> <li> <a href="/post/2024-12-16-1">Installomatorでアプリケーションのインストールの進捗を表示する</a> <span class="post-date">- December 16, 2024</span> </li> <li> <a href="/post/2024-12-09-2">Installomatorでサポートされていないアプリケーションをインストールする</a> <span class="post-date">- December 9, 2024</span> </li> <li> <a href="/post/2022-02-26-1">管理視点におけるmacOSのSystem Extensionについて</a> <span class="post-date">- February 26, 2022</span> </li> <li> <a href="/post/2020-12-15-1">erase-installを使ってmacOSの初期化、OS再インストール、OSアップグレードを行う</a> <span class="post-date">- December 15, 2020</span> </li> <li> <a href="/post/2020-11-04-1">macOSアプリケーションのアイコンを取得する</a> <span class="post-date">- November 4, 2020</span> </li> </div> </div> </section> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/jamf-pro">Jamf Pro</a> <a href="/tag/macos">macOS</a> <a href="/tag/pppc">PPPC</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.6b4bd929e0a1773ddf90.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>