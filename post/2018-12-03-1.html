<!DOCTYPE html> <html> <!-- This page is used centrarium Jekyll theme Copyright (c) 2015 Ben Centra Released under the MIT license https://github.com/bencentra/centrarium/blob/daa0d16ba9156ad43f9980e2075023a0d48859a5/LICENSE.md --> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"> <title>Google Apps Scriptのモダンな開発環境を求めて</title> <meta name="description" content="Google Apps Script (GAS) はGoogle SpreadsheetやGmailなどのGoogleアプリの拡張または、 単体でサーバーのプロビジョニングや管理なしでスクリプト実行が可能な JavaScriptライクな言語または軽量アプリケーションです。 今回はGoogle Apps Scriptのモダンな開発方法を調査・検討を行ったため、その記録を備忘として残します。"> <meta name="author" content="Tadayuki Onishi"> <meta name="copyright" content="© Tadayuki Onishi 2025"> <link rel="shortcut icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/assets/icons/favicon.ico" type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/manifest.json"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144x144.png"> <meta name="theme-color" content="#ffffff"> <meta property="fb:app_id" content="376889769419405"> <meta property="og:description" content="Google Apps Script (GAS) はGoogle SpreadsheetやGmailなどのGoogleアプリの拡張または、 単体でサーバーのプロビジョニングや管理なしでスクリプト実行が可能な JavaScriptライクな言語または軽量アプリケーションです。 今回はGoogle Apps Scriptのモダンな開発方法を調査・検討を行ったため、その記録を備忘として残します。"> <meta property="og:url" content="https://kenchan0130.github.io/post/2018-12-03-1"> <meta property="og:site_name" content="kenchan0130 blog"> <meta property="og:title" content="Google Apps Scriptのモダンな開発環境を求めて"> <meta property="og:type" content="website"> <meta property="og:author" content="Tadayuki Onishi"> <meta property="og:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta property="og:image:width" content="760"> <meta property="og:image:height" content="760"> <meta property="og:image:type" content="image/png"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Google Apps Scriptのモダンな開発環境を求めて"> <meta name="twitter:site" content="@kenchan0130"> <meta name="twitter:description" content="Google Apps Script (GAS) はGoogle SpreadsheetやGmailなどのGoogleアプリの拡張または、 単体でサーバーのプロビジョニングや管理なしでスクリプト実行が可能な JavaScriptライクな言語または軽量アプリケーションです。 今回はGoogle Apps Scriptのモダンな開発方法を調査・検討を行ったため、その記録を備忘として残します。"> <meta name="twitter:image" content="https://kenchan0130.github.io/assets/logo.png"> <meta name="twitter:url" content="https://kenchan0130.github.io/post/2018-12-03-1"> <link rel="preload" as="style" href="/assets/bundle/app.55445db2fff8ddfed8c5.css" onload="this.onload=null;this.rel='stylesheet'"> <noscript> <link rel="stylesheet" href="/assets/bundle/app.55445db2fff8ddfed8c5.css"> </noscript> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="https://kenchan0130.github.io/post/2018-12-03-1"> <link rel="alternate" type="application/atom+xml" title="kenchan0130 blog" href="https://kenchan0130.github.io/feed.xml"> <meta name="google-site-verification" content="ZxlKORgZZwZ4TTmaQJFFEXLF3jmd6P_NVU9TEVW1bSg"> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> </head> <body> <header class="navigation" role="banner"> <div class="navigation-wrapper"> <a href="/" class="logo"> <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="kenchan0130 blog" data-src="/assets/logo.png" class="lazyload"> </a> <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu"> <i class="fas fa-bars"></i> </a> <nav role="navigation"> <ul id="js-navigation-menu" class="navigation-menu"> <li class="nav-search-box"> <div class="search-input-container"> <input type="search" class="search-input" id="js-search-input" placeholder="Search" autocomplete="off" onfocus="gtag('event', 'search', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: '/post/2018-12-03-1' });"> <i class="fa fa-search search-input-icon"></i> <template id="suggestion-template"> <a href="" onclick="gtag('event', 'click', { event_category: 'www.algolia.com/apps/DEFR5IK9E2/explorer/browse/kenchan0130_blog', event_label: this.href });"> <p class="suggestion-title js-suggestion-title"></p> <p class="suggestion-content js-suggestion-content"></p> </a> </template> </div> </li> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> </ul> </nav> </div> </header> <div class="page-content"> <div class="post"> <div class="post-header-container "> <div class="scrim "> <header class="post-header"> <h1 class="title">Google Apps Scriptのモダンな開発環境を求めて</h1> </header> </div> </div> <div class="wrapper"> <span class="page-divider"> <span class="one"></span> <span class="two"></span> </span> <section class="post-meta"> <div class="post-date">2018-12-03</div> <div class="post-categories"> <i class="fas fa-fw fa-book"></i> <a href="/category/development">development </a> </div> </section> <article class="post-content"> <p>これは <a href="https://adventar.org/calendars/3424" target="_blank" rel="noopener noreferrer">FOLIO Advent Calendar 2018</a> の12/3の投稿でもあります。前日は <a href="https://adventar.org/users/2268" target="_blank" rel="noopener noreferrer">Mura-Mi</a> さんで「<a href="http://t-and-p.hatenablog.com/entry/ceo-radio" target="_blank" rel="noopener noreferrer">社員数が100人に迫っても社員と社長との距離を保つ「CEO Radio」の取り組み</a>」でした。</p> <p>Google Apps Script (GAS) はGoogle SpreadsheetやGmailなどのGoogleアプリの拡張または、 単体でサーバーのプロビジョニングや管理なしでスクリプト実行が可能なJavaScriptライクな言語または軽量アプリケーションです。</p> <p>今回はこのGoogle Apps Scriptをモダンに開発するためにいろいろ模索したため、その内容を備忘として書き残しておきます。</p> <ul id="markdown-toc"> <li> <a href="#google-apps-script%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" id="markdown-toc-google-apps-scriptについて">Google Apps Scriptについて</a> <ul> <li><a href="#google-apps-script%E3%81%AE%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E9%96%8B%E7%99%BA%E6%96%B9%E6%B3%95" id="markdown-toc-google-apps-scriptの一般的な開発方法">Google Apps Scriptの一般的な開発方法</a></li> <li><a href="#google-apps-script%E3%81%AE%E5%AE%9F%E8%A1%8C" id="markdown-toc-google-apps-scriptの実行">Google Apps Scriptの実行</a></li> <li><a href="#%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9" id="markdown-toc-ユーティリティサービス">ユーティリティサービス</a></li> <li><a href="#%E3%82%B5%E3%83%BC%E3%83%89%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA" id="markdown-toc-サードパーティライブラリ">サードパーティライブラリ</a></li> <li><a href="#%E3%83%9E%E3%83%8B%E3%83%95%E3%82%A7%E3%82%B9%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB" id="markdown-toc-マニフェストファイル">マニフェストファイル</a></li> </ul> </li> <li> <a href="#google-apps-script%E3%81%AE%E4%BE%BF%E5%88%A9%E3%81%AA%E3%83%A6%E3%83%BC%E3%82%B9%E3%82%B1%E3%83%BC%E3%82%B9" id="markdown-toc-google-apps-scriptの便利なユースケース">Google Apps Scriptの便利なユースケース</a> <ul> <li><a href="#http-post%E3%81%AEweb%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B" id="markdown-toc-http-postのwebアプリケーションの使用例">HTTP POSTのWebアプリケーションの使用例</a></li> <li><a href="#http-get%E3%81%AEweb%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E4%BD%BF%E7%94%A8%E4%BE%8B" id="markdown-toc-http-getのwebアプリケーションの使用例">HTTP GETのWebアプリケーションの使用例</a></li> </ul> </li> <li> <a href="#google-apps-script%E3%81%AE%E3%83%A2%E3%83%80%E3%83%B3%E3%81%AA%E9%96%8B%E7%99%BA%E6%96%B9%E6%B3%95" id="markdown-toc-google-apps-scriptのモダンな開発方法">Google Apps Scriptのモダンな開発方法</a> <ul> <li><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%92%B0%E5%A2%83%E3%81%A7%E3%81%AE%E9%96%8B%E7%99%BA" id="markdown-toc-ローカル環境での開発">ローカル環境での開発</a></li> <li><a href="#clasp%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6" id="markdown-toc-claspについて">claspについて</a></li> <li><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E9%96%8B%E7%99%BA%E3%81%AE%E5%AE%9F%E7%8F%BE%E8%AA%BF%E6%9F%BB" id="markdown-toc-ローカル開発の実現調査">ローカル開発の実現調査</a></li> <li><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E9%96%8B%E7%99%BA%E3%81%AE%E5%AE%9F%E8%B7%B5" id="markdown-toc-ローカル開発の実践">ローカル開発の実践</a></li> </ul> </li> <li><a href="#%E3%81%BE%E3%81%A8%E3%82%81" id="markdown-toc-まとめ">まとめ</a></li> <li><a href="#%E5%AE%A3%E4%BC%9D" id="markdown-toc-宣伝">宣伝</a></li> </ul> <h2 id="google-apps-scriptについて">Google Apps Scriptについて</h2> <p>Google Apps Scriptについて従来の開発および使用方法について紹介します。</p> <h3 id="google-apps-scriptの一般的な開発方法">Google Apps Scriptの一般的な開発方法</h3> <p>Google Apps Scriptは、各Googleアプリのツールバーの <strong>ツール &gt; スクリプトエディタ</strong> またはGoogle DriveにGoogle Apps Scriptのアプリケーションを追加することで作成できます。</p> <p><a href="/assets/posts/post/2018-12-03-1/script_editor_from_toolbar.png" data-fancybox="images" data-caption="Script Editor from ToolBar"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Script Editor from ToolBar" data-src="/assets/posts/post/2018-12-03-1/script_editor_from_toolbar.png" class="lazyload"></a> <a href="/assets/posts/post/2018-12-03-1/google_drive_add_app.png" data-fancybox="images" data-caption="Google Drive Add App"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Google Drive Add App" data-src="/assets/posts/post/2018-12-03-1/google_drive_add_app.png" class="lazyload"></a></p> <p>Google Apps ScriptはJavaScript 1.6をベースに、 1.7および1.8の一部とECMAScript 5 APIのサブセットを提供しています。</p> <h3 id="google-apps-scriptの実行">Google Apps Scriptの実行</h3> <p>Google Apps Scriptはグローバルな関数をエントリポイントとして実行されます。 無名関数はエントリポイントとして利用できません。</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// This function can use as entry point.</span>
<span class="kd">function</span> <span class="nf">myGlobalFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Ran myGlobalFunction.</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// This function cannot use as entry point.</span>
<span class="kd">var</span> <span class="nx">myGlobalAnonymousFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Ran myGlobalAnonymousFunction.</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div> <h4 id="エディタから実行">エディタから実行</h4> <p>Google Apps Scriptはエディタから実行できます。 デバッグなど動作確認を行う際や、手動で実行したい場合などで有効です。</p> <p><a href="/assets/posts/post/2018-12-03-1/run_script_from_manual.png" data-fancybox="images" data-caption="エディタから実行の例"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="エディタから実行の例" data-src="/assets/posts/post/2018-12-03-1/run_script_from_manual.png" class="lazyload"></a></p> <h4 id="イベントトリガでの実行">イベントトリガでの実行</h4> <p>Google Apps Scriptはいくつかのイベントトリガを用いて実行できます。 実行可能なトリガは以下の3つです。</p> <ul> <li>GoogleアプリのSimple Triggerでの実行</li> <li>時間での実行</li> <li>Googleカレンダーの予定更新での実行</li> </ul> <h5 id="googleアプリのsimple-triggerでの実行">GoogleアプリのSimple Triggerでの実行</h5> <p>Simple Triggerを使用するには、予約されている関数名の関数を作成することで実行可能となります。 予約されている関数は、</p> <ul> <li> <code class="language-plaintext highlighter-rouge">onOpen(e)</code> <ul> <li>ユーザーが編集権限を持つスプレッドシート、ドキュメント、プレゼンテーション、またはフォームを開いた際に実行</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">onEdit(e)</code> <ul> <li>ユーザーがスプレッドシート内の値を変更した際に実行</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">onInstall(e)</code> <ul> <li>ユーザーがアドオンをインストールした際に実行</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">doGet(e)</code> <ul> <li>HTTP GETリクエストをWebアプリケーションに送信した際に実行</li> <li>「Webアプリケーションとして導入」を実行することで、プロジェクトに一意なエンドポイントを発行</li> </ul> </li> <li> <code class="language-plaintext highlighter-rouge">doPost(e)</code> <ul> <li>HTTP POSTリクエストをWebアプリケーションに送信した際に実行</li> <li>「Webアプリケーションとして導入」を実行することで、プロジェクトに一意なエンドポイントを発行</li> </ul> </li> </ul> <p>の全部で4つです。 <code class="language-plaintext highlighter-rouge">onOpen(e)</code>、<code class="language-plaintext highlighter-rouge">onEdit(e)</code>、<code class="language-plaintext highlighter-rouge">onInstall(e)</code> を使用するにあたっては、</p> <ul> <li>Googleスプレッドシート、スライド、ドキュメント、またはフォームとスクリプトのバインドが必要</li> <li>読み取り専用モードで開かれている場合は実行されない</li> <li>スクリプトやAPIなどユーザーがUI上で操作をしないと実行されない</li> <li>認可が必要なスクリプトは実行されない</li> <li>30秒以上かかると、スクリプト実行がkillされる</li> </ul> <p>などの制約があります。 詳しくは <a href="https://developers.google.com/apps-script/guides/triggers/" target="_blank" rel="noopener noreferrer">Google Developers のサイト</a>を参照してください。</p> <h5 id="時間での実行">時間での実行</h5> <p>時間ベースでの実行は、</p> <ul> <li>特定の日時</li> <li>分毎</li> <li>時毎</li> <li>日毎</li> <li>週毎</li> <li>月毎</li> </ul> <p>が選択できます。</p> <p><a href="/assets/posts/post/2018-12-03-1/time_base_trigger_type_selection.png" data-fancybox="images" data-caption="時間トリガーの選択"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="時間トリガーの選択" data-src="/assets/posts/post/2018-12-03-1/time_base_trigger_type_selection.png" class="lazyload"></a></p> <h5 id="googleカレンダーの予定更新での実行">Googleカレンダーの予定更新での実行</h5> <p>Simple Triggerや時間でのトリガと比べると少し浮いてしまっていますが、 Googleカレンダーの予定更新をトリガとしてスクリプトの実行が可能です。</p> <p><a href="/assets/posts/post/2018-12-03-1/calendar_trigger_settings.png" data-fancybox="images" data-caption="Google カレンダーの予定更新トリガーの設定"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Google カレンダーの予定更新トリガーの設定" data-src="/assets/posts/post/2018-12-03-1/calendar_trigger_settings.png" class="lazyload"></a></p> <h3 id="ユーティリティサービス">ユーティリティサービス</h3> <p>Google Apps Scriptにはグローバル関数として、あらかじめ <strong>Utilities</strong> が提供されています。 主に「文字列のエンコード/デコード」、「日付の書式設定」、「JSON操作」などの機能を提供しているユーティリティ郡です。</p> <p>詳しくは <a href="https://developers.google.com/apps-script/reference/utilities/" target="_blank" rel="noopener noreferrer">Google Developers のサイト</a>を参照してください。</p> <h3 id="サードパーティライブラリ">サードパーティライブラリ</h3> <p>Google Apps Scriptではサードパーティが用意したライブラリを使用できます。 使用するにはライブラリを一意に特定するプロジェクトキーが必要になります。</p> <p>公開されているライブラリの検索機能などはないため、探すのがたいへんなのですが、<a href="https://github.com/oshliaer/google-apps-script-awesome-list" target="_blank" rel="noopener noreferrer">Google Apps Script List</a> のように、有志の方が一覧を公開しています。このような情報からプロジェクトキーを特定するのが近道であると思われます。</p> <p>もしほかに良い検索方法などをご存じでしたらご教示ください。</p> <h3 id="マニフェストファイル">マニフェストファイル</h3> <p>マニフェストファイルとは、 Google Apps Scriptを期待通りに実行するための設定ファイルです。 <code class="language-plaintext highlighter-rouge">appsscript.json</code> という名前のファイルであり、</p> <ul> <li>実行するタイムゾーン</li> <li>OAuthの権限のスコープ</li> <li>依存ライブラリ</li> <li>Webアプリケーションの権限スコープ</li> </ul> <p>などが設定できます。</p> <p>詳しくは <a href="https://developers.google.com/apps-script/concepts/manifests" target="_blank" rel="noopener noreferrer">Google Developers のサイト</a>を参照してください。</p> <h2 id="google-apps-scriptの便利なユースケース">Google Apps Scriptの便利なユースケース</h2> <p>Google Apps ScriptではWebアプリケーションとして公開すると、<strong>無料</strong> でHTTP GETやHTTP POSTのエンドポイントを実現できることがわかりました。</p> <h3 id="http-postのwebアプリケーションの使用例">HTTP POSTのWebアプリケーションの使用例</h3> <p>HTTP POSTのWebアプリケーションを用意できるため、</p> <ul> <li>Slack Botアプリケーション用のサーバー</li> </ul> <p>などのユースが考えられます。 フォームの代替などとして使用する場合は、しばしばCSRFの実装が必要となるため、技術的には可能ですが、少々実現のハードルが高くなるため、あまりオススメできません。</p> <h3 id="http-getのwebアプリケーションの使用例">HTTP GETのWebアプリケーションの使用例</h3> <p>HTTP POSTのWebアプリケーションを用意できるため、</p> <ul> <li>定期的に更新されるHTMLやJSON APIなどをRSSとして配信 <ul> <li>SlackのRSS Appを使用してFeed登録すると通知を得ることが可能</li> </ul> </li> <li>外部リソースなどをモックアップして、新たなJSON APIの提供</li> </ul> <p>などのユースが考えられます。 もちろんクエリパラメータも受け付けられるため、実現できる幅が広がると思います。</p> <h2 id="google-apps-scriptのモダンな開発方法">Google Apps Scriptのモダンな開発方法</h2> <p>ここまで、 Google Apps Scriptの基本的な開発方法などについて紹介してきました。</p> <p>さて、ここからが本題です。 今までの開発方法ですと、 Web上でのみの開発や、存在しないライブラリに関しては自分で追加するなどの対応が必要でした。</p> <p>ここからは、上記の問題を解決するためにいろいろ調べて実践してみた内容を紹介します。</p> <h3 id="ローカル環境での開発">ローカル環境での開発</h3> <p>先程も述べたとおり、 Web上のスクリプトエディタのみでの開発が主流でした。 そのため先人たちは、</p> <ul> <li><a href="https://www.npmjs.com/package/google-apps-script" target="_blank" rel="noopener noreferrer">google-apps-script</a></li> <li><a href="https://www.npmjs.com/package/node-google-apps-script" target="_blank" rel="noopener noreferrer">node-google-apps-script</a></li> </ul> <p>などのNPMライブラリを開発してきました。</p> <p>そんな中、 2018年1月に満を持してGoogle社がGoogle Apps Scriptをローカル環境で開発するための <code class="language-plaintext highlighter-rouge">clasp</code> というCLIを<a href="https://www.npmjs.com/package/@google/clasp" target="_blank" rel="noopener noreferrer">NPMライブラリ</a>としてかつ<a href="https://github.com/google/clasp" target="_blank" rel="noopener noreferrer">GitHub上</a> でOSSとして提供を開始しました。</p> <p>2018年12月現在、この <code class="language-plaintext highlighter-rouge">clasp</code> がローカル環境での開発におけるデファクトスタンダードとなっています。</p> <h3 id="claspについて">claspについて</h3> <p><code class="language-plaintext highlighter-rouge">clasp</code> は主にGoogle Apps Script APIを介して、</p> <ul> <li>Google Apps Scriptプロジェクトの作成</li> <li>Google Apps Scriptプロジェクトのコードのpull/push</li> <li>Google Apps ScriptプロジェクトのWebアプリケーションのdeploy/undeploy</li> </ul> <p>を行うことができるCLIです。</p> <p><code class="language-plaintext highlighter-rouge">clasp</code> はNPMライブラリで提供されているため、Node.jsおよび <code class="language-plaintext highlighter-rouge">npm</code> コマンドを事前にインストールしておく必要があります。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">-g</span> @google/clasp
<span class="nv">$ </span>clasp <span class="nt">-h</span>
Usage: clasp &lt;<span class="nb">command</span><span class="o">&gt;</span> <span class="o">[</span>options]

clasp - The Apps Script CLI

Options:
  <span class="nt">-v</span>, <span class="nt">--version</span>
  <span class="nt">-h</span>, <span class="nt">--help</span>              output usage information

Commands:
  login <span class="o">[</span>options]     Log <span class="k">in </span>to script.google.com
  <span class="o">(</span>略<span class="o">)</span>
  <span class="k">*</span>                            Any other <span class="nb">command </span>is not supported
</code></pre></div></div> <h4 id="typescriptのサポート">TypeScriptのサポート</h4> <p>claspは <a href="https://github.com/google/clasp/releases/tag/1.5" target="_blank" rel="noopener noreferrer">1.5</a> からTypeScriptをサポートしました。 <code class="language-plaintext highlighter-rouge">tsc</code> コマンドなどによる事前のビルドを必要とせず、 push時に自動で <code class="language-plaintext highlighter-rouge">gs</code> 形式にトランスパイルが可能となりました。</p> <h4 id="claspで使用される設定ファイル">claspで使用される設定ファイル</h4> <p>claspには、</p> <ul> <li><code class="language-plaintext highlighter-rouge">.clasprc.json</code></li> <li><code class="language-plaintext highlighter-rouge">.clasp.json</code></li> <li><code class="language-plaintext highlighter-rouge">.claspignore</code></li> </ul> <p>の3つの設定ファイルがあります。</p> <h5 id="clasprcjson">.clasprc.json</h5> <p><code class="language-plaintext highlighter-rouge">.clasprc.json</code> はGoogle Apps Scriptを操作するためのAPIの認証情報が保存されています。 これは <code class="language-plaintext highlighter-rouge">clasp login</code> コマンドを実行すると自動で生成されるため、あまり意識する必要はありません。</p> <h5 id="claspjson">.clasp.json</h5> <p><code class="language-plaintext highlighter-rouge">.clasp.json</code> は各プロジェクトごとの設定を定義するファイルです。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"scriptId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxxxxxxxxxxxxxx"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dist/"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fileExtension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ts"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"filePushOrder"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"file1.ts"</span><span class="p">,</span><span class="w"> </span><span class="s2">"file2.ts"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">scriptId</code> は、Google Apps ScriptプロジェクトのURL <code class="language-plaintext highlighter-rouge">https://script.google.com/d/&lt;SCRIPT_ID&gt;/edit</code> の <code class="language-plaintext highlighter-rouge">d</code> と <code class="language-plaintext highlighter-rouge">edit</code> の間の文字列であり、必須項目です。 それ以外の属性は任意項目です。</p> <p>詳しくはclaspの<a href="https://github.com/google/clasp/blob/master/README.md" target="_blank" rel="noopener noreferrer">README</a>を参照してください。</p> <h5 id="claspignore">.claspignore</h5> <p><code class="language-plaintext highlighter-rouge">.claspignore</code> は <code class="language-plaintext highlighter-rouge">clasp push</code> 時に、pushする内容を制限を設定するためのファイルです。 記法は <code class="language-plaintext highlighter-rouge">.gitignore</code> と同じです。</p> <h3 id="ローカル開発の実現調査">ローカル開発の実現調査</h3> <p>claspを使用していくのがデファクトスタンダードであり、型のあるTypeScriptで開発を行えることが分かったため、これらを使用して開発を進めていくことにしました。</p> <h4 id="claspとtypescriptを使用するための初期設定">claspとTypeScriptを使用するための初期設定</h4> <p><code class="language-plaintext highlighter-rouge">modern-gas-sample</code> という作業ディレクトリでの作業を想定して、以下のコマンドで初期設定します。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>modern-gas-sample
<span class="nv">$ </span><span class="nb">cd </span>modern-gas-sample
<span class="c"># yarnが好みなのでyarnを使用している</span>
<span class="nv">$ </span>yarn init
<span class="nv">$ </span>yarn add @google/clasp @types/google-apps-script tslint <span class="nt">--dev</span>
<span class="nv">$ </span>yarn run tslint <span class="nt">--init</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">tslint</code> は必須ではないですが、開発効率向上のためTypeScriptを書く際は導入を推奨しています。 これで最低限の開発環境設定は終わったため、次にGoogle Apps Scriptとリポジトリを連携します。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yarn run clasp create modern-gas-sample <span class="nt">--rootDir</span> ./src
<span class="nv">$ </span>yarn run clasp pull
<span class="nv">$ </span><span class="nb">mv </span>src/Code.gs src/Code.ts
</code></pre></div></div> <p>これにより、 <code class="language-plaintext highlighter-rouge">src/</code> 以下がGoogle Apps Scriptプロジェクトとsyncするようになりました。</p> <p>動作確認のため、 <code class="language-plaintext highlighter-rouge">Code.ts</code> を、</p> <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Code.ts</span>
<span class="kd">function</span> <span class="nf">myGlobalFunction</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">This is myGlobalFunction.</span><span class="dl">'</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>上記のように編集してみて、Google Apps Scriptのプロジェクトにpushしてみます。</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yarn run clasp push <span class="nt">--watch</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">--watch</code> オプションを付けることで、 <code class="language-plaintext highlighter-rouge">rootDir</code> のディレクトリのファイルに変更があった場合、自動でpushを行うことができます。</p> <p>Google Apps ScriptのプロジェクトURLにアクセスしてみると、無事 <code class="language-plaintext highlighter-rouge">.gs</code> ファイルとしてトランスパイルされたコードがGoogle Apps Scriptのプロジェクトにpushされていることが確認できます。</p> <p><a href="/assets/posts/post/2018-12-03-1/clasp_push_with_typescript.png" data-fancybox="images" data-caption="claspとTypeScriptを使用してGoogle Apps Scriptのプロジェクトにpushした例"><img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="claspとTypeScriptを使用してGoogle Apps Scriptのプロジェクトにpushした例" data-src="/assets/posts/post/2018-12-03-1/clasp_push_with_typescript.png" class="lazyload"></a></p> <p>ここで注意することは、このタイミングで <code class="language-plaintext highlighter-rouge">clasp pull</code> をしてしまうと、ビルドされた <code class="language-plaintext highlighter-rouge">.gs</code> ファイルがpullされてしまうということです。 そのため、TypeScriptで記述したソースコードは必ずGit管理し、Google Apps Scriptプロジェクトには常にpushだけを行うようにすることをお勧めします。</p> <h4 id="npmパッケージの使用欲求">NPMパッケージの使用欲求</h4> <p>先程挙げましたユースケースの中にRSSフィードを配信するというものがありました。 このユースケースを実現するとした場合、自作でRSSフィードを生成するコードを書いても良いのですが、やはりテストされているNPMパッケージを使いたくなります。</p> <p>しかし2018年12月現在、 claspは <a href="https://github.com/google/clasp/issues/325" target="_blank" rel="noopener noreferrer">ES Modules をサポートしていない</a>ため、claspのみではNPMパッケージを使用できません。</p> <p>もし、Node.jsの標準ライブラリやNPMパッケージを使用したい場合は、残念ながら</p> <ul> <li><a href="https://babeljs.io/" target="_blank" rel="noopener noreferrer">webpack</a></li> <li><a href="https://webpack.js.org/" target="_blank" rel="noopener noreferrer">Babel</a></li> </ul> <p>の力を借りなければいけません。</p> <p>どうしてもNPMパッケージが譲れない場合、執筆現在、私がたどり着いた答えは、</p> <ul> <li>愚直にwebpackを使用して、 <a href="https://www.npmjs.com/package/ts-loader" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">ts-loader</code></a> および <a href="https://www.npmjs.com/package/babel-loader" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">babel-loader</code></a> をかます</li> </ul> <p>という方法です。</p> <p>NPMパッケージ、つまり <code class="language-plaintext highlighter-rouge">node_modules</code> に存在するファイルがES2015で記述されていた場合、 webpackでバンドルした際にES2015のファイルが存在してしまい、 Google Apps Scriptで実行できません。そのため、 Babelを用いてES5に変換する必要があります。</p> <h3 id="ローカル開発の実践">ローカル開発の実践</h3> <p>今回は「愚直にwebpackを使用して、 <a href="https://www.npmjs.com/package/ts-loader" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">ts-loader</code></a> および <a href="https://www.npmjs.com/package/babel-loader" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">babel-loader</code></a> をかます」の手法を使用して、ニュースが配信されているJSON APIを呼び出し、RSSとして配信するためのアプリケーションをローカル開発で行ってみました。</p> <p>コードは<a href="https://github.com/kenchan0130/jamf-nation-rss-gas" target="_blank" rel="noopener noreferrer">こちら</a>で公開しています。</p> <p>最低限の動作は確認できていますが絶賛拡張中のため、詳しい内容に関しては、また後日ブログがかけたらと思っています。</p> <h2 id="まとめ">まとめ</h2> <p>Google Apps Scriptの基本的な機能について紹介しました。 また、 現在はローカルでの開発がclaspを使用して行われるのが主流であり、一通りのことができることを紹介しました。</p> <p>まだまだclasp含めGoole Apps Scriptは発展途上であるため、より便利に開発したい場合は、引き続きwebpackとBabelを使用し続ける必要があります。 しかしclaspは開発速度が速いため、今後の対応に目が離せません。</p> <h2 id="宣伝">宣伝</h2> <p>FOLIOでは<a href="https://www.wantedly.com/companies/folio/projects" target="_blank" rel="noopener noreferrer">絶賛採用強化中</a>です。 ご興味ある方はぜひご連絡ください！</p> <p>明日は <a href="https://adventar.org/users/22353" target="_blank" rel="noopener noreferrer">KeitaMoromizato</a> さんによる「Node.js x thrift in FOLIO」です。 引き続きFOLIO Advent Calendar 2018をお楽しみに！</p> </article> <section class="share"> <a href="//twitter.com/share?text=Google+Apps+Script%E3%81%AE%E3%83%A2%E3%83%80%E3%83%B3%E3%81%AA%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%B1%82%E3%82%81%E3%81%A6&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2018-12-03-1%3Futm_source%3Dtwitter%26utm_medium%3Dsocial&amp;via=kenchan0130" onclick="window.open(this.href, 'twitter-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-twitter fa-lg"></i> </a> <a href="//www.facebook.com/sharer.php?t=Google+Apps+Script%E3%81%AE%E3%83%A2%E3%83%80%E3%83%B3%E3%81%AA%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%B1%82%E3%82%81%E3%81%A6&amp;u=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2018-12-03-1%3Futm_source%3Dfacebook%26utm_medium%3Dsocial" onclick="window.open(this.href, 'facebook-share', 'width=550,height=255,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-facebook fa-lg"></i> </a> <a href="//b.hatena.ne.jp/entry/panel/?btitle=Google+Apps+Script%E3%81%AE%E3%83%A2%E3%83%80%E3%83%B3%E3%81%AA%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E6%B1%82%E3%82%81%E3%81%A6&amp;url=https%3A%2F%2Fkenchan0130.github.io%2Fpost%2F2018-12-03-1" onclick="window.open(this.href, 'hatena-share', 'width=550,height=600,menubar=no,toolbar=no,resizable=yes');return false;"> <i class="fab fa-hatena fa-lg"></i> </a> </section> <section class="post-donation"> <div class="post-donation-panel"> <p class="post-donation-description"> 参考になった・面白かったと感じていただけましたら、サポートいただけると励みになります。 </p> <a class="post-donation-button" href="https://www.buymeacoffee.com/kenchan0130" onclick="gtag('event', 'click-buymeacoffee', { event_category: 'www.buymeacoffee.com/kenchan0130', event_label: '/post/2018-12-03-1' });" target="_blank" rel="noopener noreferrer"> <p class="post-donation-button-body"> <img class="icon lazyload" alt="buymeacoffee" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="https://www.buymeacoffee.com/assets/img/BMC-btn-logo.svg"> <span class="label">サポートする</span> </p> </a> </div> </section> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2444060431947599" data-ad-slot="7319689305" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <section class="sub-contents related-posts"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">あわせて読みたい</div> <div class="sub-contents-main"> <li> <a href="/post/2019-12-25-1">Google Apps Scriptのモダンな開発環境は理想だった</a> <span class="post-date">- December 25, 2019</span> </li> <li> <a href="/post/2021-02-24-1">GitHub ActionsのRunner OSの情報を取得できるアクションを作った</a> <span class="post-date">- February 24, 2021</span> </li> <li> <a href="/post/2021-10-29-1">Designship 2021のライブ配信サイトの開発周りについて</a> <span class="post-date">- October 29, 2021</span> </li> <li> <a href="/post/2018-05-21-1">UserScriptで業務改善</a> <span class="post-date">- May 21, 2018</span> </li> <li> <a href="/post/2021-12-09-1">Next.jsでStatic GenerationしたサイトをAWSでホスティングする</a> <span class="post-date">- December 9, 2021</span> </li> </div> </div> </section> <section class="sub-contents tags"> <div class="sub-contents-wrapper"> <div class="sub-contents-title">Tags</div> <div class="sub-contents-main"> <a href="/tag/google-apps-script">Google Apps Script</a> <a href="/tag/javascript">JavaScript</a> <a href="/tag/typescript">TypeScript</a> <a href="/tag/clasp">clasp</a> <a href="/tag/webpack">webpack</a> <a href="/tag/babel">Babel</a> <a href="/tag/node-js">Node.js</a> </div> </div> </section> </div> </div> </div> <footer class="site-footer"> <div class="wrapper"> <h3 class="footer-heading">kenchan0130 blog</h3> <div class="site-navigation"> <p><strong>Site Map</strong></p> <ul class="pages"> <li class="nav-link"> <a href="/archives">Archives</a> </li> <li class="nav-link"> <a href="/privacy">Privacy Policy</a> </li> <li class="nav-link"> <a href="/profile">Profile</a> </li> <li class="nav-link"> <a href="/profile/resume">Resume</a> </li> </ul> </div> <div class="site-contact"> <p><strong>Contact</strong></p> <ul class="social-media-list"> <li> <a href="https://twitter.com/kenchan0130" title="Follow me on Twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> <span class="username">kenchan0130</span> </a> </li> <li> <a href="https://github.com/kenchan0130" title="Fork me on GitHub" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> <span class="username">kenchan0130</span> </a> </li> </ul> </div> <div class="site-signature"> <p class="rss-subscribe text"><strong>Subscribe <a href="/feed.xml">via RSS</a></strong></p> <p class="text">ソフトウェアエンジニア。記録に残したいことを雑に備忘するブログ。 投稿内容は個人の見解であり所属する組織の公式見解ではありません。 </p> </div> </div> <div class="licence">このサイトのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank" rel="noopener noreferrer">Creative Commons Attribution 4.0 International (CC-BY-4.0) License</a>の下でライセンスされています。</div> <div class="copyright">Copyright © 2017-2025 Tadayuki Onishi All Rights Reserved.</div> </footer> <script src="/assets/bundle/app.55445db2fff8ddfed8c5.js" async></script> <script async src="//www.googletagmanager.com/gtag/js?id=G-B7RX34Q5PL"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B7RX34Q5PL");</script> <script async src="//www.googletagmanager.com/gtag/js?id=UA-79827366-2"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-79827366-2");</script> </body> </html>